{"version":3,"sources":["db/core.cljs"],"mappings":"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","names":["db.core/debug?","js/goog.DEBUG","db.core/database-set","db.rtdb/ref-set","db.core/database-update","db.rtdb/ref-update","db.core/database-push","db.rtdb/ref-push","db.core/database-get","db.rtdb/ref-get","db.core/on-value-reaction","db.rtdb/on-value-reaction","db.core/on-snapshot-docs-reaction","db.fsdb/on-snapshot-docs-reaction","db.core/on-snapshot-doc-reaction","db.fsdb/on-snapshot-doc-reaction","db.core/sign-out","db.auth/sign-out","db.core/firestore-set","db.fsdb/firestore-set","db.core/firestore-add","db.fsdb/firestore-add","p__70005","map__70006","cljs.core/--destructure-map","cljs.core.get","db.core/init!","config","js/console","cljs.core/reset!","db.state/app","js/module$node_modules$firebase$app$dist$index_esm.initializeApp","cljs.core/clj->js","js/module$node_modules$firebase$database$dist$index_esm.connectDatabaseEmulator","js/module$node_modules$firebase$database$dist$index_esm.getDatabase","js/module$node_modules$firebase$storage$dist$index_esm.connectStorageEmulator","js/module$node_modules$firebase$storage$dist$index_esm.getStorage","js/module$node_modules$firebase$firestore$dist$index_esm.connectFirestoreEmulator","js/module$node_modules$firebase$firestore$dist$index_esm.getFirestore","re_frame.core.reg_sub","_","G__70007","input","data","p__70008","vec__70009","cljs.core.nth","a","k","v","temp__5751__auto__","c","cljs.core.assoc","cljs.core/count","cljs.core/val","cljs.core/first","cljs-time.coerce/from-long","cljs.core.reduce","cljs.core/seq","cljs.core/filterv","cljs.core.comp","re_frame.core.reg_event_db","p__70012","vec__70013","js/Error","db","arg","cljs.core/map?","db.auth/user-info","user","cljs.core/not","p__70016","p__70017","vec__70018","vec__70021","ua","fu","field","u","or__4253__auto__","G__70024","cljs.core/Keyword"],"sourcesContent":["(ns db.core\n  (:require [re-frame.core :as rf]\n            [db.rtdb]\n            [db.auth]\n            [db.state]\n            [db.fsdb]\n            [cljs-time.core :as t]\n            [cljs-time.coerce]\n            [\"firebase/app\" :refer [initializeApp]]\n            [\"firebase/firestore\" :refer [getFirestore connectFirestoreEmulator]]\n            [\"firebase/storage\" :refer [getStorage connectStorageEmulator]]\n            [\"firebase/database\" :refer [getDatabase connectDatabaseEmulator]]\n            [reagent.core :as r]))\n\n\n(def debug? ^boolean js/goog.DEBUG)\n\n(def database-set db.rtdb/ref-set)\n(def database-update db.rtdb/ref-update)\n(def database-push db.rtdb/ref-push)\n(def database-get db.rtdb/ref-get)\n(def on-value-reaction db.rtdb/on-value-reaction)\n(def on-snapshot-docs-reaction db.fsdb/on-snapshot-docs-reaction)\n(def on-snapshot-doc-reaction db.fsdb/on-snapshot-doc-reaction)\n(def sign-out db.auth/sign-out)\n(def firestore-set db.fsdb/firestore-set)\n(def firestore-add db.fsdb/firestore-add)\n\n(defn init! [{:keys [config]}]\n  (.log js/console \"db/init!\")\n  (reset! db.state/app (initializeApp (clj->js config)))\n  (when debug?\n    (connectDatabaseEmulator (getDatabase) \"localhost\" 9009)\n    (connectStorageEmulator (getStorage) \"localhost\" 9199)\n    (connectFirestoreEmulator (getFirestore) \"localhost\" 8080)))\n\n(rf/reg-sub ::presence-status\n            (fn [_]\n              (on-value-reaction {:path [\"presence\"]}))\n            (fn [input _]\n              (let [data (-> (fn [a [k v]]\n                               (if-let [c (:connections v)]\n                                 (assoc a k\n                                          {:connections (count c)\n                                           :ugh         (val (first c)) #_(cljs-time.coerce/from-long (val (last c)))})\n\n                                 (assoc a k {:lastOnline (cljs-time.coerce/from-long (:lastOnline v))})))\n                             (reduce {} (seq input)))]\n                {:offline (filterv (comp :lastOnline val) data)\n                 :online  (filterv (comp :connections val) data)})))\n\n(rf/reg-event-db ::set-fake-user (fn [db [_ arg]]\n                                   {:pre [(or (nil? arg) (map? arg))]}\n                                   (assoc db ::fake-user arg)))\n\n(rf/reg-sub ::fake-user (fn [db] (get db ::fake-user)))\n\n(rf/reg-sub ::user-auth\n            db.auth/user-info\n            (fn [user _]\n              (if (or (not user)\n                      (instance? js/Error user))\n                nil\n                user)))\n\n(rf/reg-sub ::root-auth\n            :<- [::user-auth]\n            :<- [::fake-user]\n            (fn [[ua fu] [_ field]]\n              (let [u (or fu ua)]\n                (case field\n                  :uid (:uid u)\n                  u))))\n"]}