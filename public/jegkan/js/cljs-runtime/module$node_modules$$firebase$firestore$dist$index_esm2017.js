shadow$provide.module$node_modules$$firebase$firestore$dist$index_esm2017=function(global,require,module,exports){function O(t,...e){k.logLevel<=_logger.LogLevel.DEBUG&&(e=e.map(L),k.debug(`Firestore (${N}): ${t}`,...e))}function M(t,...e){k.logLevel<=_logger.LogLevel.ERROR&&(e=e.map(L),k.error(`Firestore (${N}): ${t}`,...e))}function F(t,...e){k.logLevel<=_logger.LogLevel.WARN&&(e=e.map(L),k.warn(`Firestore (${N}): ${t}`,...e))}function L(t){if("string"==typeof t)return t;try{return e$jscomp$0=t,
JSON.stringify(e$jscomp$0)}catch(e){return t}var e$jscomp$0}function B(t="Unexpected state"){t=`FIRESTORE (${N}) INTERNAL ASSERTION FAILED: `+t;throw M(t),Error(t);}function U(t,e){t||B()}function rt(t,e){return t<e?-1:t>e?1:0}function ot(t$jscomp$0,e,n){return t$jscomp$0.length===e.length&&t$jscomp$0.every((t,s)=>n(t,e[s]))}function ht(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function lt(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,
t[n])}function ft(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Et(t){t||B();if("string"==typeof t){var e=0;const n=Tt.exec(t);n||B();n[1]&&(e=n[1],e=(e+"000000000").substr(0,9),e=Number(e));return{seconds:Math.floor((new Date(t)).getTime()/1E3),nanos:e}}return{seconds:It(t.seconds),nanos:It(t.nanos)}}function It(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function At(t){return"string"==typeof t?pt.fromBase64String(t):pt.fromUint8Array(t)}
function Rt(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function bt(t){t=t.mapValue.fields.__previous_value__;return Rt(t)?bt(t):t}function Pt(t){t=Et(t.mapValue.fields.__local_write_time__.timestampValue);return new at(t.seconds,t.nanos)}function Vt(t){return 0===t&&1/t==-1/0}function St(t){return"number"==typeof t&&Number.isInteger(t)&&!Vt(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=
Number.MIN_SAFE_INTEGER}function Ct(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Rt(t)?4:10:B()}function Nt(t$jscomp$1,e$jscomp$0){if(t$jscomp$1===e$jscomp$0)return!0;const n=Ct(t$jscomp$1);if(n!==Ct(e$jscomp$0))return!1;switch(n){case 0:return!0;case 1:return t$jscomp$1.booleanValue===e$jscomp$0.booleanValue;case 4:return Pt(t$jscomp$1).isEqual(Pt(e$jscomp$0));
case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;t=Et(t.timestampValue);e=Et(e.timestampValue);return t.seconds===e.seconds&&t.nanos===e.nanos}(t$jscomp$1,e$jscomp$0);case 5:return t$jscomp$1.stringValue===e$jscomp$0.stringValue;case 6:return function(t,e){return At(t.bytesValue).isEqual(At(e.bytesValue))}(t$jscomp$1,e$jscomp$0);case 7:return t$jscomp$1.referenceValue===
e$jscomp$0.referenceValue;case 8:return function(t,e){return It(t.geoPointValue.latitude)===It(e.geoPointValue.latitude)&&It(t.geoPointValue.longitude)===It(e.geoPointValue.longitude)}(t$jscomp$1,e$jscomp$0);case 2:return function(t,e){return"integerValue"in t&&"integerValue"in e?It(t.integerValue)===It(e.integerValue):"doubleValue"in t&&"doubleValue"in e?(t=It(t.doubleValue),e=It(e.doubleValue),t===e?Vt(t)===Vt(e):isNaN(t)&&isNaN(e)):!1}(t$jscomp$1,e$jscomp$0);case 9:return ot(t$jscomp$1.arrayValue.values||
[],e$jscomp$0.arrayValue.values||[],Nt);case 10:return function(t$jscomp$0,e){t$jscomp$0=t$jscomp$0.mapValue.fields||{};e=e.mapValue.fields||{};if(ht(t$jscomp$0)!==ht(e))return!1;for(const t in t$jscomp$0)if(t$jscomp$0.hasOwnProperty(t)&&(void 0===e[t]||!Nt(t$jscomp$0[t],e[t])))return!1;return!0}(t$jscomp$1,e$jscomp$0);default:return B()}}function kt(t$jscomp$0,e){return void 0!==(t$jscomp$0.values||[]).find(t=>Nt(t,e))}function xt(t$jscomp$1,e$jscomp$1){if(t$jscomp$1===e$jscomp$1)return 0;const n$jscomp$0=
Ct(t$jscomp$1),s$jscomp$0=Ct(e$jscomp$1);if(n$jscomp$0!==s$jscomp$0)return rt(n$jscomp$0,s$jscomp$0);switch(n$jscomp$0){case 0:return 0;case 1:return rt(t$jscomp$1.booleanValue,e$jscomp$1.booleanValue);case 2:return function(t,e){t=It(t.integerValue||t.doubleValue);e=It(e.integerValue||e.doubleValue);return t<e?-1:t>e?1:t===e?0:isNaN(t)?isNaN(e)?0:-1:1}(t$jscomp$1,e$jscomp$1);case 3:return $t(t$jscomp$1.timestampValue,e$jscomp$1.timestampValue);case 4:return $t(Pt(t$jscomp$1),Pt(e$jscomp$1));case 5:return rt(t$jscomp$1.stringValue,
e$jscomp$1.stringValue);case 6:return function(t,e){t=At(t);e=At(e);return t.compareTo(e)}(t$jscomp$1.bytesValue,e$jscomp$1.bytesValue);case 7:return function(t$jscomp$0,e$jscomp$0){t$jscomp$0=t$jscomp$0.split("/");e$jscomp$0=e$jscomp$0.split("/");for(let t=0;t<t$jscomp$0.length&&t<e$jscomp$0.length;t++){const e=rt(t$jscomp$0[t],e$jscomp$0[t]);if(0!==e)return e}return rt(t$jscomp$0.length,e$jscomp$0.length)}(t$jscomp$1.referenceValue,e$jscomp$1.referenceValue);case 8:return function(t,e){const n=
rt(It(t.latitude),It(e.latitude));return 0!==n?n:rt(It(t.longitude),It(e.longitude))}(t$jscomp$1.geoPointValue,e$jscomp$1.geoPointValue);case 9:return function(t$jscomp$0,e$jscomp$0){t$jscomp$0=t$jscomp$0.values||[];e$jscomp$0=e$jscomp$0.values||[];for(let t=0;t<t$jscomp$0.length&&t<e$jscomp$0.length;++t){const e=xt(t$jscomp$0[t],e$jscomp$0[t]);if(e)return e}return rt(t$jscomp$0.length,e$jscomp$0.length)}(t$jscomp$1.arrayValue,e$jscomp$1.arrayValue);case 10:return function(t$jscomp$0,e$jscomp$0){t$jscomp$0=
t$jscomp$0.fields||{};const s=Object.keys(t$jscomp$0);e$jscomp$0=e$jscomp$0.fields||{};const r=Object.keys(e$jscomp$0);s.sort();r.sort();for(let t=0;t<s.length&&t<r.length;++t){var e=rt(s[t],r[t]);if(0!==e)return e;e=xt(t$jscomp$0[s[t]],e$jscomp$0[r[t]]);if(0!==e)return e}return rt(s.length,r.length)}(t$jscomp$1.mapValue,e$jscomp$1.mapValue);default:throw B();}}function $t(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return rt(t,e);t=Et(t);e=Et(e);const i=rt(t.seconds,e.seconds);
return 0!==i?i:rt(t.nanos,e.nanos)}function Mt(t$jscomp$0){return"nullValue"in t$jscomp$0?"null":"booleanValue"in t$jscomp$0?""+t$jscomp$0.booleanValue:"integerValue"in t$jscomp$0?""+t$jscomp$0.integerValue:"doubleValue"in t$jscomp$0?""+t$jscomp$0.doubleValue:"timestampValue"in t$jscomp$0?function(t){t=Et(t);return`time(${t.seconds},${t.nanos})`}(t$jscomp$0.timestampValue):"stringValue"in t$jscomp$0?t$jscomp$0.stringValue:"bytesValue"in t$jscomp$0?At(t$jscomp$0.bytesValue).toBase64():"referenceValue"in
t$jscomp$0?(n$jscomp$0=t$jscomp$0.referenceValue,Dt.fromName(n$jscomp$0).toString()):"geoPointValue"in t$jscomp$0?`geo(${(e$jscomp$0=t$jscomp$0.geoPointValue).latitude},${e$jscomp$0.longitude})`:"arrayValue"in t$jscomp$0?function(t){let e="[",n=!0;for(const s of t.values||[])n?n=!1:e+=",",e+=Mt(s);return e+"]"}(t$jscomp$0.arrayValue):"mapValue"in t$jscomp$0?function(t){const e=Object.keys(t.fields||{}).sort();let n="{",s=!0;for(const i of e)s?s=!1:n+=",",n+=`${i}:${Mt(t.fields[i])}`;return n+"}"}(t$jscomp$0.mapValue):
B();var e$jscomp$0,n$jscomp$0}function Ft(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function Lt(t){return!!t&&"integerValue"in t}function Bt(t){return!!t&&"arrayValue"in t}function Ut(t){return!!t&&"nullValue"in t}function qt(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Kt(t){return!!t&&"mapValue"in t}function jt(t$jscomp$0){if(t$jscomp$0.geoPointValue)return{geoPointValue:Object.assign({},t$jscomp$0.geoPointValue)};
if(t$jscomp$0.timestampValue&&"object"==typeof t$jscomp$0.timestampValue)return{timestampValue:Object.assign({},t$jscomp$0.timestampValue)};if(t$jscomp$0.mapValue){const e={mapValue:{fields:{}}};return lt(t$jscomp$0.mapValue.fields,(t,n)=>e.mapValue.fields[t]=jt(n)),e}if(t$jscomp$0.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t$jscomp$0.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=jt(t$jscomp$0.arrayValue.values[n]);return e}return Object.assign({},t$jscomp$0)}function Wt(t$jscomp$0){const e=
[];return lt(t$jscomp$0.fields,(t,n$jscomp$0)=>{t=new mt([t]);if(Kt(n$jscomp$0))if(n$jscomp$0=Wt(n$jscomp$0.mapValue).fields,0===n$jscomp$0.length)e.push(t);else for(const n of n$jscomp$0)e.push(t.child(n));else e.push(t)}),new gt(e)}function Ht(t,e=null,n=[],s=[],i=null,r=null,o=null){return new zt(t,e,n,s,i,r,o)}function Jt(t$jscomp$1){if(null===t$jscomp$1.R){let t$jscomp$0=t$jscomp$1.path.canonicalString();null!==t$jscomp$1.collectionGroup&&(t$jscomp$0+="|cg:"+t$jscomp$1.collectionGroup);t$jscomp$0+=
"|f:";t$jscomp$0+=t$jscomp$1.filters.map(t=>t.field.canonicalString()+t.op.toString()+Mt(t.value)).join(",");t$jscomp$0+="|ob:";t$jscomp$0+=t$jscomp$1.orderBy.map(t=>t.field.canonicalString()+t.dir).join(",");null==t$jscomp$1.limit||(t$jscomp$0+="|l:",t$jscomp$0+=t$jscomp$1.limit);t$jscomp$1.startAt&&(t$jscomp$0+="|lb:",t$jscomp$0+=le(t$jscomp$1.startAt));t$jscomp$1.endAt&&(t$jscomp$0+="|ub:",t$jscomp$0+=le(t$jscomp$1.endAt));t$jscomp$1.R=t$jscomp$0}return t$jscomp$1.R}function Yt(t$jscomp$0){let e$jscomp$0=
t$jscomp$0.path.canonicalString();return null!==t$jscomp$0.collectionGroup&&(e$jscomp$0+=" collectionGroup\x3d"+t$jscomp$0.collectionGroup),0<t$jscomp$0.filters.length&&(e$jscomp$0+=`, filters: [${t$jscomp$0.filters.map(t=>{return`${(e=t).field.canonicalString()} ${e.op} ${Mt(e.value)}`;var e}).join(", ")}]`),null==t$jscomp$0.limit||(e$jscomp$0+=", limit: "+t$jscomp$0.limit),0<t$jscomp$0.orderBy.length&&(e$jscomp$0+=`, orderBy: [${t$jscomp$0.orderBy.map(t=>`${t.field.canonicalString()} (${t.dir})`).join(", ")}]`),
t$jscomp$0.startAt&&(e$jscomp$0+=", startAt: "+le(t$jscomp$0.startAt)),t$jscomp$0.endAt&&(e$jscomp$0+=", endAt: "+le(t$jscomp$0.endAt)),`Target(${e$jscomp$0})`}function Xt(t$jscomp$0,e$jscomp$0){if(t$jscomp$0.limit!==e$jscomp$0.limit||t$jscomp$0.orderBy.length!==e$jscomp$0.orderBy.length)return!1;for(let n=0;n<t$jscomp$0.orderBy.length;n++){var t=t$jscomp$0.orderBy[n],e=e$jscomp$0.orderBy[n];if(t.dir!==e.dir||!t.field.isEqual(e.field))return!1}if(t$jscomp$0.filters.length!==e$jscomp$0.filters.length)return!1;
for(t=0;t<t$jscomp$0.filters.length;t++)if(n$jscomp$0=t$jscomp$0.filters[t],s=e$jscomp$0.filters[t],n$jscomp$0.op!==s.op||!n$jscomp$0.field.isEqual(s.field)||!Nt(n$jscomp$0.value,s.value))return!1;var n$jscomp$0,s;return t$jscomp$0.collectionGroup===e$jscomp$0.collectionGroup&&!!t$jscomp$0.path.isEqual(e$jscomp$0.path)&&!!_e(t$jscomp$0.startAt,e$jscomp$0.startAt)&&_e(t$jscomp$0.endAt,e$jscomp$0.endAt)}function Zt(t){return Dt.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}function re(t$jscomp$0,
e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map(t=>Dt.fromName(t.referenceValue))}function le(t$jscomp$0){return`${t$jscomp$0.before?"b":"a"}:${t$jscomp$0.position.map(t=>Mt(t)).join(",")}`}function we(t,e,n){var s=0;for(let i=0;i<t.position.length;i++){const r=e[i];s=t.position[i];s=r.field.isKeyField()?Dt.comparator(Dt.fromName(s.referenceValue),n.key):xt(s,n.data.field(r.field));if("desc"===r.dir&&(s*=-1),0!==s)break}return t.before?0>=s:0>s}function _e(t,e){if(null===
t)return null===e;if(null===e||t.before!==e.before||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Nt(t.position[n],e.position[n]))return!1;return!0}function pe(t){return null!=t.limit&&"F"===t.limitType}function Te(t){return null!=t.limit&&"L"===t.limitType}function Ee(t){return 0<t.explicitOrderBy.length?t.explicitOrderBy[0].field:null}function Ie(t){for(const e of t.filters)if(e.V())return e.field;return null}function Re(t$jscomp$0){if(null===t$jscomp$0.S){t$jscomp$0.S=
[];var t=Ie(t$jscomp$0);const n=Ee(t$jscomp$0);if(null!==t&&null===n)t.isKeyField()||t$jscomp$0.S.push(new fe(t)),t$jscomp$0.S.push(new fe(mt.keyField(),"asc"));else{t=!1;for(var n$jscomp$0 of t$jscomp$0.explicitOrderBy)t$jscomp$0.S.push(n$jscomp$0),n$jscomp$0.field.isKeyField()&&(t=!0);t||(n$jscomp$0=0<t$jscomp$0.explicitOrderBy.length?t$jscomp$0.explicitOrderBy[t$jscomp$0.explicitOrderBy.length-1].dir:"asc",t$jscomp$0.S.push(new fe(mt.keyField(),n$jscomp$0)))}}return t$jscomp$0.S}function be(t$jscomp$0){if(!t$jscomp$0.D)if("F"===
t$jscomp$0.limitType)t$jscomp$0.D=Ht(t$jscomp$0.path,t$jscomp$0.collectionGroup,Re(t$jscomp$0),t$jscomp$0.filters,t$jscomp$0.limit,t$jscomp$0.startAt,t$jscomp$0.endAt);else{const t=[];for(var n of Re(t$jscomp$0))t.push(new fe(n.field,"desc"===n.dir?"asc":"desc"));n=t$jscomp$0.endAt?new he(t$jscomp$0.endAt.position,!t$jscomp$0.endAt.before):null;const s=t$jscomp$0.startAt?new he(t$jscomp$0.startAt.position,!t$jscomp$0.startAt.before):null;t$jscomp$0.D=Ht(t$jscomp$0.path,t$jscomp$0.collectionGroup,
t,t$jscomp$0.filters,t$jscomp$0.limit,n,s)}return t$jscomp$0.D}function Pe(t,e,n){return new me(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function ve(t,e){return Xt(be(t),be(e))&&t.limitType===e.limitType}function Ve(t){return`${Jt(be(t))}|lt:${t.limitType}`}function Se(t){return`Query(target=${Yt(be(t))}; limitType=${t.limitType})`}function De(t$jscomp$0,e$jscomp$0){return e$jscomp$0.isFoundDocument()&&function(t,e){const n=e.key.path;return null!==
t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):Dt.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t$jscomp$0,e$jscomp$0)&&function(t,e){for(const n of t.explicitOrderBy)if(!n.field.isKeyField()&&null===e.data.field(n.field))return!1;return!0}(t$jscomp$0,e$jscomp$0)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t$jscomp$0,e$jscomp$0)&&function(t,e){return t.startAt&&!we(t.startAt,Re(t),e)||t.endAt&&we(t.endAt,Re(t),
e)?!1:!0}(t$jscomp$0,e$jscomp$0)}function Ce(t$jscomp$0){return(e$jscomp$0,n)=>{let s=!1;for(const i of Re(t$jscomp$0)){a:{var JSCompiler_inline_result=i;var e=e$jscomp$0;var JSCompiler_temp=n;if(JSCompiler_inline_result.field.isKeyField())JSCompiler_temp=Dt.comparator(e.key,JSCompiler_temp.key);else{var t=JSCompiler_inline_result.field;e=e.data.field(t);JSCompiler_temp=JSCompiler_temp.data.field(t);JSCompiler_temp=null!==e&&null!==JSCompiler_temp?xt(e,JSCompiler_temp):B()}switch(JSCompiler_inline_result.dir){case "asc":JSCompiler_inline_result=
JSCompiler_temp;break a;case "desc":JSCompiler_inline_result=-1*JSCompiler_temp;break a;default:JSCompiler_inline_result=B()}}if(0!==JSCompiler_inline_result)return JSCompiler_inline_result;s=s||i.field.isKeyField()}return 0}}function ke(t,e){if(t.C){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Vt(e)?"-0":e}}function $e(t,e){return St(e)?{integerValue:""+e}:ke(t,e)}function Me(t$jscomp$0,e$jscomp$0,n){return t$jscomp$0 instanceof
Be?function(t,e){t={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(t.fields.__previous_value__=e),{mapValue:t}}(n,e$jscomp$0):t$jscomp$0 instanceof Ue?qe(t$jscomp$0,e$jscomp$0):t$jscomp$0 instanceof Ke?je(t$jscomp$0,e$jscomp$0):function(t,e){e=Le(t,e);var JSCompiler_temp_const=It(e.integerValue||e.doubleValue);var JSCompiler_inline_result=t.N;JSCompiler_inline_result=It(JSCompiler_inline_result.integerValue||
JSCompiler_inline_result.doubleValue);JSCompiler_temp_const+=JSCompiler_inline_result;return Lt(e)&&Lt(t.N)?{integerValue:""+JSCompiler_temp_const}:ke(t.k,JSCompiler_temp_const)}(t$jscomp$0,e$jscomp$0)}function Le(t,e){return t instanceof Qe?Lt(n=e)||n&&"doubleValue"in n?e:{integerValue:0}:null;var n}function qe(t$jscomp$0,e$jscomp$0){e$jscomp$0=Ge(e$jscomp$0);for(const e of t$jscomp$0.elements)e$jscomp$0.some(t=>Nt(t,e))||e$jscomp$0.push(e);return{arrayValue:{values:e$jscomp$0}}}function je(t$jscomp$0,
e$jscomp$0){e$jscomp$0=Ge(e$jscomp$0);for(const e of t$jscomp$0.elements)e$jscomp$0=e$jscomp$0.filter(t=>!Nt(t,e));return{arrayValue:{values:e$jscomp$0}}}function Ge(t){return Bt(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}function Xe(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}function tn(t$jscomp$0,e$jscomp$0,n$jscomp$0){t$jscomp$0 instanceof on?function(t,e,n){const s=t.value.clone();t=un(t.fieldTransforms,
e,n.transformResults);s.setAll(t);e.convertToFoundDocument(n.version,s).setHasCommittedMutations()}(t$jscomp$0,e$jscomp$0,n$jscomp$0):t$jscomp$0 instanceof cn?function(t,e,n){if(!Xe(t.precondition,e))return void e.convertToUnknownDocument(n.version);const s=un(t.fieldTransforms,e,n.transformResults),i=e.data;i.setAll(an(t));i.setAll(s);e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(t$jscomp$0,e$jscomp$0,n$jscomp$0):e$jscomp$0.convertToNoDocument(n$jscomp$0.version).setHasCommittedMutations()}
function en(t$jscomp$0,e$jscomp$0,n$jscomp$0){t$jscomp$0 instanceof on?function(t,e,n){if(Xe(t.precondition,e)){var s=t.value.clone();t=hn(t.fieldTransforms,n,e);s.setAll(t);e.convertToFoundDocument(rn(e),s).setHasLocalMutations()}}(t$jscomp$0,e$jscomp$0,n$jscomp$0):t$jscomp$0 instanceof cn?function(t,e,n){if(Xe(t.precondition,e)){n=hn(t.fieldTransforms,n,e);var i=e.data;i.setAll(an(t));i.setAll(n);e.convertToFoundDocument(rn(e),i).setHasLocalMutations()}}(t$jscomp$0,e$jscomp$0,n$jscomp$0):function(t,
e){Xe(t.precondition,e)&&e.convertToNoDocument(ut.min())}(t$jscomp$0,e$jscomp$0)}function sn(t$jscomp$1,e$jscomp$1){return t$jscomp$1.type===e$jscomp$1.type&&!!t$jscomp$1.key.isEqual(e$jscomp$1.key)&&!!t$jscomp$1.precondition.isEqual(e$jscomp$1.precondition)&&!!function(t$jscomp$0,e$jscomp$0){return void 0===t$jscomp$0&&void 0===e$jscomp$0||!(!t$jscomp$0||!e$jscomp$0)&&ot(t$jscomp$0,e$jscomp$0,(t,e)=>{var JSCompiler_temp;if(JSCompiler_temp=t.field.isEqual(e.field))t=t.transform,e=e.transform,JSCompiler_temp=
t instanceof Ue&&e instanceof Ue||t instanceof Ke&&e instanceof Ke?ot(t.elements,e.elements,Nt):t instanceof Qe&&e instanceof Qe?Nt(t.N,e.N):t instanceof Be&&e instanceof Be;return JSCompiler_temp})}(t$jscomp$1.fieldTransforms,e$jscomp$1.fieldTransforms)&&(0===t$jscomp$1.type?t$jscomp$1.value.isEqual(e$jscomp$1.value):1!==t$jscomp$1.type||t$jscomp$1.data.isEqual(e$jscomp$1.data)&&t$jscomp$1.fieldMask.isEqual(e$jscomp$1.fieldMask))}function rn(t){return t.isFoundDocument()?t.version:ut.min()}function an(t){const e=
new Map;return t.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const s=t.data.field(n);e.set(n,s)}}),e}function un(t,e,n$jscomp$0){const s=new Map;t.length===n$jscomp$0.length||B();for(let i=0;i<n$jscomp$0.length;i++){var r=t[i],o=r.transform,c=e.data.field(r.field),JSCompiler_temp_const=s,JSCompiler_temp_const$jscomp$0=JSCompiler_temp_const.set;r=r.field;var n=n$jscomp$0[i];o=o instanceof Ue?qe(o,c):o instanceof Ke?je(o,c):n;JSCompiler_temp_const$jscomp$0.call(JSCompiler_temp_const,r,o)}return s}
function hn(t,e,n){const s=new Map;for(const i of t){t=i.transform;const r=n.data.field(i.field);s.set(i.field,Me(t,r,e))}return s}function mn(t){switch(t){default:return B();case j.CANCELLED:case j.UNKNOWN:case j.DEADLINE_EXCEEDED:case j.RESOURCE_EXHAUSTED:case j.INTERNAL:case j.UNAVAILABLE:case j.UNAUTHENTICATED:return!1;case j.INVALID_ARGUMENT:case j.NOT_FOUND:case j.ALREADY_EXISTS:case j.PERMISSION_DENIED:case j.FAILED_PRECONDITION:case j.ABORTED:case j.OUT_OF_RANGE:case j.UNIMPLEMENTED:case j.DATA_LOSS:return!0}}
function gn(t){if(void 0===t)return M("GRPC error has no .code"),j.UNKNOWN;switch(t){case wn.OK:return j.OK;case wn.CANCELLED:return j.CANCELLED;case wn.UNKNOWN:return j.UNKNOWN;case wn.DEADLINE_EXCEEDED:return j.DEADLINE_EXCEEDED;case wn.RESOURCE_EXHAUSTED:return j.RESOURCE_EXHAUSTED;case wn.INTERNAL:return j.INTERNAL;case wn.UNAVAILABLE:return j.UNAVAILABLE;case wn.UNAUTHENTICATED:return j.UNAUTHENTICATED;case wn.INVALID_ARGUMENT:return j.INVALID_ARGUMENT;case wn.NOT_FOUND:return j.NOT_FOUND;case wn.ALREADY_EXISTS:return j.ALREADY_EXISTS;
case wn.PERMISSION_DENIED:return j.PERMISSION_DENIED;case wn.FAILED_PRECONDITION:return j.FAILED_PRECONDITION;case wn.ABORTED:return j.ABORTED;case wn.OUT_OF_RANGE:return j.OUT_OF_RANGE;case wn.UNIMPLEMENTED:return j.UNIMPLEMENTED;case wn.DATA_LOSS:return j.DATA_LOSS;default:return B()}}function Dn(...t){let e=Sn;for(const n of t)e=e.add(n);return e}function Qn(t,e){return t.C?`${(new Date(1E3*e.seconds)).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:
{seconds:""+e.seconds,nanos:e.nanoseconds}}function Wn(t,e){return t.C?e.toBase64():e.toUint8Array()}function zn(t){t||B();var JSCompiler_temp_const=ut,JSCompiler_temp_const$jscomp$0=JSCompiler_temp_const.fromTimestamp;t=Et(t);t=new at(t.seconds,t.nanos);return JSCompiler_temp_const$jscomp$0.call(JSCompiler_temp_const,t)}function Hn(t,e){return(new wt(["projects",t.projectId,"databases",t.database])).child("documents").child(e).canonicalString()}function Jn(t){t=wt.fromString(t);Rs(t)||B();return t}
function Xn(t,e){e=Jn(e);if(e.get(1)!==t.databaseId.projectId)throw new Q(j.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+t.databaseId.projectId);if(e.get(3)!==t.databaseId.database)throw new Q(j.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+t.databaseId.database);return new Dt(ns(e))}function Zn(t,e){return Hn(t.databaseId,e)}function ts(t){t=Jn(t);return 4===t.length?wt.emptyPath():ns(t)}function es(t){return(new wt(["projects",
t.databaseId.projectId,"databases",t.databaseId.database])).canonicalString()}function ns(t){4<t.length&&"documents"===t.get(4)||B();return t.popFirst(5)}function ss(t,e,n){return{name:Hn(t.databaseId,e.path),fields:n.value.mapValue.fields}}function is(t,e,n){t=Xn(t,e.name);const i=zn(e.updateTime);e=new Qt({mapValue:{fields:e.fields}});e=Gt.newFoundDocument(t,i,e);return n&&e.setHasCommittedMutations(),n?e.setHasCommittedMutations():e}function rs(t$jscomp$0,e$jscomp$0){return"found"in e$jscomp$0?
function(t,e){e.found||B();e.found.name;e.found.updateTime;t=Xn(t,e.found.name);const s=zn(e.found.updateTime);e=new Qt({mapValue:{fields:e.found.fields}});return Gt.newFoundDocument(t,s,e)}(t$jscomp$0,e$jscomp$0):"missing"in e$jscomp$0?function(t,e){e.missing||B();e.readTime||B();t=Xn(t,e.missing);e=zn(e.readTime);return Gt.newNoDocument(t,e)}(t$jscomp$0,e$jscomp$0):B()}function os(t$jscomp$0,e$jscomp$0){if("targetChange"in e$jscomp$0){e$jscomp$0.targetChange;var s=function(t){return"NO_CHANGE"===
t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:B()}(e$jscomp$0.targetChange.targetChangeType||"NO_CHANGE"),i=e$jscomp$0.targetChange.targetIds||[];t$jscomp$0=function(t,e){t.C?(void 0===e||"string"==typeof e||B(),t=pt.fromBase64String(e||"")):(void 0===e||e instanceof Uint8Array||B(),t=pt.fromUint8Array(e||new Uint8Array));return t}(t$jscomp$0,e$jscomp$0.targetChange.resumeToken);e$jscomp$0=(e$jscomp$0=e$jscomp$0.targetChange.cause)&&function(t){const e=void 0===t.code?j.UNKNOWN:gn(t.code);
return new Q(e,t.message||"")}(e$jscomp$0);t$jscomp$0=new Mn(s,i,t$jscomp$0,e$jscomp$0||null)}else if("documentChange"in e$jscomp$0)e$jscomp$0.documentChange,s=e$jscomp$0.documentChange,s.document,s.document.name,s.document.updateTime,t$jscomp$0=Xn(t$jscomp$0,s.document.name),i=zn(s.document.updateTime),e$jscomp$0=new Qt({mapValue:{fields:s.document.fields}}),t$jscomp$0=Gt.newFoundDocument(t$jscomp$0,i,e$jscomp$0),t$jscomp$0=new $n(s.targetIds||[],s.removedTargetIds||[],t$jscomp$0.key,t$jscomp$0);
else if("documentDelete"in e$jscomp$0)e$jscomp$0.documentDelete,s=e$jscomp$0.documentDelete,s.document,t$jscomp$0=Xn(t$jscomp$0,s.document),i=s.readTime?zn(s.readTime):ut.min(),t$jscomp$0=Gt.newNoDocument(t$jscomp$0,i),t$jscomp$0=new $n([],s.removedTargetIds||[],t$jscomp$0.key,t$jscomp$0);else if("documentRemove"in e$jscomp$0)e$jscomp$0.documentRemove,s=e$jscomp$0.documentRemove,s.document,t$jscomp$0=Xn(t$jscomp$0,s.document),t$jscomp$0=new $n([],s.removedTargetIds||[],t$jscomp$0,null);else{if(!("filter"in
e$jscomp$0))return B();e$jscomp$0.filter;t$jscomp$0=e$jscomp$0.filter;t$jscomp$0.targetId;s=new dn(t$jscomp$0.count||0);t$jscomp$0=new On(t$jscomp$0.targetId,s)}return t$jscomp$0}function cs(t$jscomp$1,e$jscomp$0){let n;if(e$jscomp$0 instanceof on)n={update:ss(t$jscomp$1,e$jscomp$0.key,e$jscomp$0.value)};else if(e$jscomp$0 instanceof ln)n={delete:Hn(t$jscomp$1.databaseId,e$jscomp$0.key.path)};else if(e$jscomp$0 instanceof cn)n={update:ss(t$jscomp$1,e$jscomp$0.key,e$jscomp$0.data),updateMask:As(e$jscomp$0.fieldMask)};
else{if(!(e$jscomp$0 instanceof fn))return B();n={verify:Hn(t$jscomp$1.databaseId,e$jscomp$0.key.path)}}return 0<e$jscomp$0.fieldTransforms.length&&(n.updateTransforms=e$jscomp$0.fieldTransforms.map(t$jscomp$0=>function(t,e){t=e.transform;if(t instanceof Be)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(t instanceof Ue)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:t.elements}};if(t instanceof Ke)return{fieldPath:e.field.canonicalString(),
removeAllFromArray:{values:t.elements}};if(t instanceof Qe)return{fieldPath:e.field.canonicalString(),increment:t.N};throw B();}(0,t$jscomp$0))),e$jscomp$0.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:Qn(t,e.updateTime.toTimestamp())}:void 0!==e.exists?{exists:e.exists}:B()}(t$jscomp$1,e$jscomp$0.precondition)),n}function as(t$jscomp$1,e$jscomp$0){const n$jscomp$0=e$jscomp$0.currentDocument?function(t){return void 0!==t.updateTime?Ye.updateTime(zn(t.updateTime)):
void 0!==t.exists?Ye.exists(t.exists):Ye.none()}(e$jscomp$0.currentDocument):Ye.none();var s=e$jscomp$0.updateTransforms?e$jscomp$0.updateTransforms.map(e=>{let n=null;"setToServerValue"in e?("REQUEST_TIME"===e.setToServerValue||B(),n=new Be):"appendMissingElements"in e?n=new Ue(e.appendMissingElements.values||[]):"removeAllFromArray"in e?n=new Ke(e.removeAllFromArray.values||[]):"increment"in e?n=new Qe(t$jscomp$1,e.increment):B();e=mt.fromServerFormat(e.fieldPath);return new ze(e,n)}):[];if(e$jscomp$0.update){e$jscomp$0.update.name;
const i=Xn(t$jscomp$1,e$jscomp$0.update.name),r=new Qt({mapValue:{fields:e$jscomp$0.update.fields}});return e$jscomp$0.updateMask?(e$jscomp$0=function(t$jscomp$0){return new gt((t$jscomp$0.fieldPaths||[]).map(t=>mt.fromServerFormat(t)))}(e$jscomp$0.updateMask),new cn(i,r,e$jscomp$0,n$jscomp$0,s)):new on(i,r,n$jscomp$0,s)}return e$jscomp$0.delete?(s=Xn(t$jscomp$1,e$jscomp$0.delete),new ln(s,n$jscomp$0)):e$jscomp$0.verify?(s=Xn(t$jscomp$1,e$jscomp$0.verify),new fn(s,n$jscomp$0)):B()}function us(t$jscomp$0,
e){t$jscomp$0&&0<t$jscomp$0.length?(void 0!==e||B(),t$jscomp$0=t$jscomp$0.map(t=>{let n=t.updateTime?zn(t.updateTime):zn(e);return n.isEqual(ut.min())&&(n=zn(e)),new Je(n,t.transformResults||[])})):t$jscomp$0=[];return t$jscomp$0}function ls(t$jscomp$2,e$jscomp$0){const n={structuredQuery:{}};var s=e$jscomp$0.path;null!==e$jscomp$0.collectionGroup?(n.parent=Zn(t$jscomp$2,s),n.structuredQuery.from=[{collectionId:e$jscomp$0.collectionGroup,allDescendants:!0}]):(n.parent=Zn(t$jscomp$2,s.popLast()),n.structuredQuery.from=
[{collectionId:s.lastSegment()}]);(s=function(t$jscomp$1){if(0!==t$jscomp$1.length)return t$jscomp$1=t$jscomp$1.map(t$jscomp$0=>function(t){if("\x3d\x3d"===t.op){if(qt(t.value))return{unaryFilter:{field:ps(t.field),op:"IS_NAN"}};if(Ut(t.value))return{unaryFilter:{field:ps(t.field),op:"IS_NULL"}}}else if("!\x3d"===t.op){if(qt(t.value))return{unaryFilter:{field:ps(t.field),op:"IS_NOT_NAN"}};if(Ut(t.value))return{unaryFilter:{field:ps(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ps(t.field),
op:Kn[t.op],value:t.value}}}(t$jscomp$0)),1===t$jscomp$1.length?t$jscomp$1[0]:{compositeFilter:{op:"AND",filters:t$jscomp$1}}}(e$jscomp$0.filters))&&(n.structuredQuery.where=s);(s=function(t$jscomp$0){if(0!==t$jscomp$0.length)return t$jscomp$0.map(t=>({field:ps(t.field),direction:qn[t.dir]}))}(e$jscomp$0.orderBy))&&(n.structuredQuery.orderBy=s);t$jscomp$2=function(t,e){return t.C||null==e?e:{value:e}}(t$jscomp$2,e$jscomp$0.limit);return null!==t$jscomp$2&&(n.structuredQuery.limit=t$jscomp$2),e$jscomp$0.startAt&&
(n.structuredQuery.startAt=_s(e$jscomp$0.startAt)),e$jscomp$0.endAt&&(n.structuredQuery.endAt=_s(e$jscomp$0.endAt)),n}function fs(t$jscomp$0){let e$jscomp$0=ts(t$jscomp$0.parent);t$jscomp$0=t$jscomp$0.structuredQuery;var s=t$jscomp$0.from?t$jscomp$0.from.length:0;let i=null;0<s&&(1===s||B(),s=t$jscomp$0.from[0],s.allDescendants?i=s.collectionId:e$jscomp$0=e$jscomp$0.child(s.collectionId));s=[];t$jscomp$0.where&&(s=ws(t$jscomp$0.where));let o=[];t$jscomp$0.orderBy&&(o=t$jscomp$0.orderBy.map(t=>{var JSCompiler_temp_const=
mt.fromServerFormat(t.field.fieldPath);a:switch(t.direction){case "ASCENDING":t="asc";break a;case "DESCENDING":t="desc";break a;default:t=void 0}return new fe(JSCompiler_temp_const,t)}));let c=null;t$jscomp$0.limit&&(c=function(t){let e;return e="object"==typeof t?t.value:t,null==e?null:e}(t$jscomp$0.limit));let a=null;t$jscomp$0.startAt&&(a=ms(t$jscomp$0.startAt));let u=null;return t$jscomp$0.endAt&&(u=ms(t$jscomp$0.endAt)),new me(e$jscomp$0,i,o,s,c,"F",a,u)}function ds(t$jscomp$0,e$jscomp$0){t$jscomp$0=
function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return B()}}(0,e$jscomp$0.purpose);return null==t$jscomp$0?null:{"goog-listen-tags":t$jscomp$0}}function ws(t$jscomp$0){return t$jscomp$0?void 0!==t$jscomp$0.unaryFilter?[Is(t$jscomp$0)]:void 0!==t$jscomp$0.fieldFilter?[Es(t$jscomp$0)]:void 0!==t$jscomp$0.compositeFilter?t$jscomp$0.compositeFilter.filters.map(t=>ws(t)).reduce((t,e)=>t.concat(e)):B():[]}function _s(t){return{before:t.before,
values:t.position}}function ms(t){return new he(t.values||[],!!t.before)}function ps(t){return{fieldPath:t.canonicalString()}}function Es(t$jscomp$0){return te.create(mt.fromServerFormat(t$jscomp$0.fieldFilter.field.fieldPath),function(t){switch(t){case "EQUAL":return"\x3d\x3d";case "NOT_EQUAL":return"!\x3d";case "GREATER_THAN":return"\x3e";case "GREATER_THAN_OR_EQUAL":return"\x3e\x3d";case "LESS_THAN":return"\x3c";case "LESS_THAN_OR_EQUAL":return"\x3c\x3d";case "ARRAY_CONTAINS":return"array-contains";
case "IN":return"in";case "NOT_IN":return"not-in";case "ARRAY_CONTAINS_ANY":return"array-contains-any";default:return B()}}(t$jscomp$0.fieldFilter.op),t$jscomp$0.fieldFilter.value)}function Is(t){switch(t.unaryFilter.op){case "IS_NAN":return t=mt.fromServerFormat(t.unaryFilter.field.fieldPath),te.create(t,"\x3d\x3d",{doubleValue:NaN});case "IS_NULL":return t=mt.fromServerFormat(t.unaryFilter.field.fieldPath),te.create(t,"\x3d\x3d",{nullValue:"NULL_VALUE"});case "IS_NOT_NAN":return t=mt.fromServerFormat(t.unaryFilter.field.fieldPath),
te.create(t,"!\x3d",{doubleValue:NaN});case "IS_NOT_NULL":return t=mt.fromServerFormat(t.unaryFilter.field.fieldPath),te.create(t,"!\x3d",{nullValue:"NULL_VALUE"});default:return B()}}function As(t$jscomp$0){const e=[];return t$jscomp$0.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Rs(t){return 4<=t.length&&"projects"===t.get(0)&&"databases"===t.get(2)}function bs(t$jscomp$0){var e$jscomp$0="";for(let n=0;n<t$jscomp$0.length;n++){0<e$jscomp$0.length&&(e$jscomp$0+="");var t=
t$jscomp$0.get(n);const s$jscomp$0=t.length;for(let e=0;e<s$jscomp$0;e++){const s=t.charAt(e);switch(s){case "\x00":e$jscomp$0+="";break;case "":e$jscomp$0+="";break;default:e$jscomp$0+=s}}}return e$jscomp$0+""}function Vs(t){const e$jscomp$0=t.length;2<=e$jscomp$0||B();if(2===e$jscomp$0)return""===t.charAt(0)&&""===t.charAt(1)||B(),wt.emptyPath();const n=e$jscomp$0-2,s=[];let i="";for(var r=0;r<e$jscomp$0;){const e=t.indexOf("",r);(0>e||e>n)&&B();switch(t.charAt(e+1)){case "":r=t.substring(r,
e);let o;0===i.length?o=r:(i+=r,o=i,i="");s.push(o);break;case "":i+=t.substring(r,e);i+="\x00";break;case "":i+=t.substring(r,e+1);break;default:B()}r=e+2}return new wt(s)}function Zs(t){return"IndexedDbTransactionError"===t.name}function ei(t$jscomp$0){return new zs((e,n)=>{t$jscomp$0.onsuccess=t=>{e(t.target.result)};t$jscomp$0.onerror=t=>{t=si(t.target.error);n(t)}})}function si(t$jscomp$0){const e=Js.bt((0,_util.getUA)());if(12.2<=e&&13>e&&0<=t$jscomp$0.message.indexOf("An internal error was encountered in the Indexed Database server")){const t=
new Q("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown 'An internal error was encountered in the Indexed Database server'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return ni||(ni=!0,setTimeout(()=>{throw t;},0)),t}return t$jscomp$0}function ri(t,e){return Js.Dt(t.Wt,e)}function hi(t,e){if(e.document)return is(t.Gt,e.document,!!e.hasCommittedMutations);if(e.noDocument){t=Dt.fromSegments(e.noDocument.path);
const n=_i(e.noDocument.readTime);t=Gt.newNoDocument(t,n);return e.hasCommittedMutations?t.setHasCommittedMutations():t}return e.unknownDocument?(t=Dt.fromSegments(e.unknownDocument.path),e=_i(e.unknownDocument.version),Gt.newUnknownDocument(t,e)):B()}function li(t,e,n$jscomp$0){n$jscomp$0=fi(n$jscomp$0);const i=e.key.path.popLast().toArray();if(e.isFoundDocument())return t=t.Gt,t={name:Hn(t.databaseId,e.key.path),fields:e.data.value.mapValue.fields,updateTime:Qn(t,e.version.toTimestamp())},new Os(null,
null,t,e.hasCommittedMutations,n$jscomp$0,i);if(e.isNoDocument()){t=e.key.path.toArray();const n=wi(e.version);e=e.hasCommittedMutations;return new Os(null,new xs(t,n),null,e,n$jscomp$0,i)}return e.isUnknownDocument()?(t=e.key.path.toArray(),e=wi(e.version),new Os(new $s(t,e),null,null,!0,n$jscomp$0,i)):B()}function fi(t){t=t.toTimestamp();return[t.seconds,t.nanoseconds]}function di(t){t=new at(t[0],t[1]);return ut.fromTimestamp(t)}function wi(t){t=t.toTimestamp();return new Ss(t.seconds,t.nanoseconds)}
function _i(t){t=new at(t.seconds,t.nanoseconds);return ut.fromTimestamp(t)}function mi(t$jscomp$0,e$jscomp$0){const n=(e$jscomp$0.baseMutations||[]).map(e=>as(t$jscomp$0.Gt,e));for(var t=0;t<e$jscomp$0.mutations.length-1;++t){var n$jscomp$0=e$jscomp$0.mutations[t];t+1<e$jscomp$0.mutations.length&&void 0!==e$jscomp$0.mutations[t+1].transform&&(n$jscomp$0.updateTransforms=e$jscomp$0.mutations[t+1].transform.fieldTransforms,e$jscomp$0.mutations.splice(t+1,1),++t)}t=e$jscomp$0.mutations.map(e=>as(t$jscomp$0.Gt,
e));n$jscomp$0=at.fromMillis(e$jscomp$0.localWriteTimeMs);return new oi(e$jscomp$0.batchId,n$jscomp$0,n,t)}function gi(t){const e=_i(t.readTime),n=void 0!==t.lastLimboFreeSnapshotVersion?_i(t.lastLimboFreeSnapshotVersion):ut.min();var s;void 0!==t.query.documents?(1===(s=t.query).documents.length||B(),s=be(new me(ts(s.documents[0])))):s=be(fs(t.query));return new ai(s,t.targetId,0,t.lastListenSequenceNumber,e,n,pt.fromBase64String(t.resumeToken))}function yi(t,e){const n=wi(e.snapshotVersion),s=wi(e.lastLimboFreeSnapshotVersion);
t=Zt(e.target)?{documents:[Zn(t.Gt,e.target.path)]}:ls(t.Gt,e.target);const r=e.resumeToken.toBase64();return new Fs(e.targetId,Jt(e.target),n,r,e.sequenceNumber,s,t)}function pi(t){const e=fs({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?Pe(e,e.limit,"L"):e}function Si(t$jscomp$0,e$jscomp$0,n$jscomp$0){var s=t$jscomp$0.store(Ns.store);t$jscomp$0=t$jscomp$0.store(ks.store);const r=[],o=IDBKeyRange.only(n$jscomp$0.batchId);let c=0;s=s.jt({range:o},(t,e,n)=>(c++,n.delete()));
r.push(s.next(()=>{1===c||B()}));const u=[];for(const t of n$jscomp$0.mutations)s=ks.key(e$jscomp$0,t.key.path,n$jscomp$0.batchId),r.push(t$jscomp$0.delete(s)),u.push(t.key);return zs.waitFor(r).next(()=>u)}function Di(t){if(!t)return 0;if(t.document)t=t.document;else if(t.unknownDocument)t=t.unknownDocument;else{if(!t.noDocument)throw B();t=t.noDocument}return JSON.stringify(t).length}function Ni(t$jscomp$0,e,n$jscomp$0){n$jscomp$0=ks.prefixForPath(e,n$jscomp$0.path);const i=n$jscomp$0[1];n$jscomp$0=
IDBKeyRange.lowerBound(n$jscomp$0);let o=!1;return ri(t$jscomp$0,ks.store).jt({range:n$jscomp$0,Kt:!0},(t,n,s)=>{const [r,c]=t;r===e&&c===i&&(o=!0);s.done()}).next(()=>o)}function ki(t){return ri(t,Ns.store)}function Bi(t){return ri(t,Ls.store)}function Ui(t){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){if(t.code!==j.FAILED_PRECONDITION||"The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab."!==t.message)throw t;
O("LocalStore","Unexpectedly lost primary lease")})}function qi([t,e],[n,s]){t=rt(t,n);return 0===t?rt(e,s):t}function Gi(t,e){var JSCompiler_temp_const=Bi(t),JSCompiler_temp_const$jscomp$0=JSCompiler_temp_const.put;t=t.currentSequenceNumber;e=new Ls(0,bs(e.path),t);return JSCompiler_temp_const$jscomp$0.call(JSCompiler_temp_const,e)}function Zi(t){return ri(t,Os.store)}function nr(t){t.createObjectStore(Ls.store,{keyPath:Ls.keyPath}).createIndex(Ls.documentTargetsIndex,Ls.documentTargetsKeyPath,{unique:!0});
t.createObjectStore(Fs.store,{keyPath:Fs.keyPath}).createIndex(Fs.queryTargetsIndexName,Fs.queryTargetsKeyPath,{unique:!0});t.createObjectStore(Bs.store)}function cr(t,e){let n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}function wr(t$jscomp$1,e$jscomp$1){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){let s$jscomp$0=t$jscomp$1.An,i=t$jscomp$1.Wn;const r$jscomp$0=yield t$jscomp$1.persistence.runTransaction("Handle user change","readonly",t$jscomp$0=>
{let r;return t$jscomp$1.An.getAllMutationBatches(t$jscomp$0).next(o=>(r=o,s$jscomp$0=t$jscomp$1.persistence.getMutationQueue(e$jscomp$1),i=new ur(t$jscomp$1.Qn,s$jscomp$0,t$jscomp$1.persistence.getIndexManager()),s$jscomp$0.getAllMutationBatches(t$jscomp$0))).next(e$jscomp$0=>{const n=[],s=[];let o=Dn();for(const t of r){n.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}for(const t of e$jscomp$0){s.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}return i.vn(t$jscomp$0,o).next(t=>
({Gn:t,removedBatchIds:n,addedBatchIds:s}))})});return t$jscomp$1.An=s$jscomp$0,t$jscomp$1.Wn=i,t$jscomp$1.Un.On(t$jscomp$1.Wn),r$jscomp$0})}function _r(t$jscomp$2,e$jscomp$1){return t$jscomp$2.persistence.runTransaction("Acknowledge batch","readwrite-primary",t$jscomp$1=>{const s$jscomp$0=e$jscomp$1.batch.keys(),i$jscomp$0=t$jscomp$2.Qn.newChangeBuffer({trackRemovals:!0});return function(t$jscomp$0,e$jscomp$0,n,s){const i=n.batch,r$jscomp$0=i.keys();let o=zs.resolve();return r$jscomp$0.forEach(t=>
{o=o.next(()=>s.getEntry(e$jscomp$0,t)).next(e=>{const r=n.docVersions.get(t);null!==r||B();0>e.version.compareTo(r)&&(i.applyToRemoteDocument(e,n),e.isValidDocument()&&s.addEntry(e,n.commitVersion))})}),o.next(()=>t$jscomp$0.An.removeMutationBatch(e$jscomp$0,i))}(t$jscomp$2,t$jscomp$1,e$jscomp$1,i$jscomp$0).next(()=>i$jscomp$0.apply(t$jscomp$1)).next(()=>t$jscomp$2.An.performConsistencyCheck(t$jscomp$1)).next(()=>t$jscomp$2.Wn.vn(t$jscomp$1,s$jscomp$0))})}function mr(t$jscomp$0){return t$jscomp$0.persistence.runTransaction("Get last remote snapshot version",
"readonly",t=>t$jscomp$0.He.getLastRemoteSnapshotVersion(t))}function gr(t$jscomp$1,e$jscomp$1){const s$jscomp$0=e$jscomp$1.snapshotVersion;let i$jscomp$0=t$jscomp$1.qn;return t$jscomp$1.persistence.runTransaction("Apply remote event","readwrite-primary",t$jscomp$0=>{const r$jscomp$0=t$jscomp$1.Qn.newChangeBuffer({trackRemovals:!0});i$jscomp$0=t$jscomp$1.qn;const o=[];e$jscomp$1.targetChanges.forEach((r,c)=>{const a=i$jscomp$0.get(c);if(a){o.push(t$jscomp$1.He.removeMatchingKeys(t$jscomp$0,r.removedDocuments,
c).next(()=>t$jscomp$1.He.addMatchingKeys(t$jscomp$0,r.addedDocuments,c)));var u=a.withSequenceNumber(t$jscomp$0.currentSequenceNumber);e$jscomp$1.targetMismatches.has(c)?u=u.withResumeToken(pt.EMPTY_BYTE_STRING,ut.min()).withLastLimboFreeSnapshotVersion(ut.min()):0<r.resumeToken.approximateByteSize()&&(u=u.withResumeToken(r.resumeToken,s$jscomp$0));i$jscomp$0=i$jscomp$0.insert(c,u);(function(t,e,n){return 0===t.resumeToken.approximateByteSize()||3E8<=e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()?
!0:0<n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size})(a,u,r)&&o.push(t$jscomp$1.He.updateTargetData(t$jscomp$0,u))}});let c$jscomp$0=An;if(e$jscomp$1.documentUpdates.forEach((s,i)=>{e$jscomp$1.resolvedLimboDocuments.has(s)&&o.push(t$jscomp$1.persistence.referenceDelegate.updateLimboDocument(t$jscomp$0,s))}),o.push(yr(t$jscomp$0,r$jscomp$0,e$jscomp$1.documentUpdates,s$jscomp$0,void 0).next(t=>{c$jscomp$0=t})),!s$jscomp$0.isEqual(ut.min())){const e$jscomp$0=t$jscomp$1.He.getLastRemoteSnapshotVersion(t$jscomp$0).next(e=>
t$jscomp$1.He.setTargetsMetadata(t$jscomp$0,t$jscomp$0.currentSequenceNumber,s$jscomp$0));o.push(e$jscomp$0)}return zs.waitFor(o).next(()=>r$jscomp$0.apply(t$jscomp$0)).next(()=>t$jscomp$1.Wn.Vn(t$jscomp$0,c$jscomp$0)).next(()=>c$jscomp$0)}).then(t=>(t$jscomp$1.qn=i$jscomp$0,t))}function yr(t$jscomp$0,e,n$jscomp$0,s,i){let r$jscomp$0=Dn();return n$jscomp$0.forEach(t=>r$jscomp$0=r$jscomp$0.add(t)),e.getEntries(t$jscomp$0,r$jscomp$0).next(t=>{let r=An;return n$jscomp$0.forEach((n,o)=>{const c=t.get(n),
a=(null==i?void 0:i.get(n))||s;o.isNoDocument()&&o.version.isEqual(ut.min())?(e.removeEntry(n,a),r=r.insert(n,o)):!c.isValidDocument()||0<o.version.compareTo(c.version)||0===o.version.compareTo(c.version)&&c.hasPendingWrites?(e.addEntry(o,a),r=r.insert(n,o)):O("LocalStore","Ignoring outdated watch update for ",n,". Current version:",c.version," Watch version:",o.version)}),r})}function pr(t$jscomp$0,e){return t$jscomp$0.persistence.runTransaction("Get next mutation batch","readonly",t=>(void 0===
e&&(e=-1),t$jscomp$0.An.getNextMutationBatchAfterBatchId(t,e)))}function Tr(t$jscomp$0,e){return t$jscomp$0.persistence.runTransaction("Allocate target","readwrite",t=>{let s;return t$jscomp$0.He.getTargetData(t,e).next(i$jscomp$0=>i$jscomp$0?(s=i$jscomp$0,zs.resolve(s)):t$jscomp$0.He.allocateTargetId(t).next(i=>(s=new ai(e,i,0,t.currentSequenceNumber),t$jscomp$0.He.addTargetData(t,s).next(()=>s))))}).then(t=>{const s=t$jscomp$0.qn.get(t.targetId);return(null===s||0<t.snapshotVersion.compareTo(s.snapshotVersion))&&
(t$jscomp$0.qn=t$jscomp$0.qn.insert(t.targetId,t),t$jscomp$0.Kn.set(e,t.targetId)),t})}function Er(t$jscomp$0,e,n){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){const i=t$jscomp$0.qn.get(e),r=n?"readwrite":"readwrite-primary";try{n||(yield t$jscomp$0.persistence.runTransaction("Release target",r,t=>t$jscomp$0.persistence.referenceDelegate.removeTarget(t,i)))}catch(t){if(!Zs(t))throw t;O("LocalStore",`Failed to update sequence numbers for target ${e}: ${t}`)}t$jscomp$0.qn=t$jscomp$0.qn.remove(e);
t$jscomp$0.Kn.delete(i.target)})}function Ir(t$jscomp$1,e$jscomp$0,n$jscomp$0){let i$jscomp$0=ut.min(),r=Dn();return t$jscomp$1.persistence.runTransaction("Execute query","readonly",t$jscomp$0=>function(t,e,n){const i=t.Kn.get(n);return void 0!==i?zs.resolve(t.qn.get(i)):t.He.getTargetData(e,n)}(t$jscomp$1,t$jscomp$0,be(e$jscomp$0)).next(e=>{if(e)return i$jscomp$0=e.lastLimboFreeSnapshotVersion,t$jscomp$1.He.getMatchingKeysForTargetId(t$jscomp$0,e.targetId).next(t=>{r=t})}).next(()=>t$jscomp$1.Un.getDocumentsMatchingQuery(t$jscomp$0,
e$jscomp$0,n$jscomp$0?i$jscomp$0:ut.min(),n$jscomp$0?r:Dn())).next(t=>({documents:t,zn:r})))}function Ar(t$jscomp$1,e){const s=t$jscomp$1.He,i=t$jscomp$1.qn.get(e);return i?Promise.resolve(i.target):t$jscomp$1.persistence.runTransaction("Get target data","readonly",t$jscomp$0=>s.Et(t$jscomp$0,e).next(t=>t?t.target:null))}function Rr(t$jscomp$2){return t$jscomp$2.persistence.runTransaction("Get new document changes","readonly",t$jscomp$1=>function(t$jscomp$0,e$jscomp$0,n){let i=An,r=fi(n);e$jscomp$0=
Zi(e$jscomp$0);n=IDBKeyRange.lowerBound(r,!0);return e$jscomp$0.jt({index:Os.readTimeIndex,range:n},(t,e)=>{t=hi(t$jscomp$0.k,e);i=i.insert(t.key,t);r=e.readTime}).next(()=>({In:i,readTime:di(r)}))}(t$jscomp$2.Qn,t$jscomp$1,t$jscomp$2.jn)).then(({In:t,readTime:n})=>(t$jscomp$2.jn=n,t))}function br(t$jscomp$2){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){return t$jscomp$2.persistence.runTransaction("Synchronize last document change read time","readonly",t$jscomp$1=>function(t$jscomp$0){t$jscomp$0=
Zi(t$jscomp$0);let n=ut.min();return t$jscomp$0.jt({index:Os.readTimeIndex,reverse:!0},(t,e,s)=>{e.readTime&&(n=di(e.readTime));s.done()}).next(()=>n)}(t$jscomp$1)).then(t=>{t$jscomp$2.jn=t})})}function Pr(t$jscomp$0,e$jscomp$0,n$jscomp$0,s){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){let r=Dn(),o=An,c=vn;for(const t of n$jscomp$0){const n=e$jscomp$0.Hn(t.metadata.name);t.document&&(r=r.add(n));o=o.insert(n,e$jscomp$0.Jn(t));c=c.insert(n,e$jscomp$0.Yn(t.metadata.readTime))}const a=
t$jscomp$0.Qn.newChangeBuffer({trackRemovals:!0}),u=yield Tr(t$jscomp$0,be(new me(wt.fromString(`__bundle__/docs/${s}`))));return t$jscomp$0.persistence.runTransaction("Apply bundle documents","readwrite",t=>yr(t,a,o,ut.min(),c).next(e=>(a.apply(t),e)).next(e=>t$jscomp$0.He.removeMatchingKeysForTargetId(t,u.targetId).next(()=>t$jscomp$0.He.addMatchingKeys(t,r,u.targetId)).next(()=>t$jscomp$0.Wn.Vn(t,e)).next(()=>e)))})}function vr(t$jscomp$0,e,n=Dn()){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){const s=
yield Tr(t$jscomp$0,be(pi(e.bundledQuery)));return t$jscomp$0.persistence.runTransaction("Save named query","readwrite",t=>{var r=zn(e.readTime);if(0<=s.snapshotVersion.compareTo(r))return t$jscomp$0.Ye.saveNamedQuery(t,e);r=s.withResumeToken(pt.EMPTY_BYTE_STRING,r);return t$jscomp$0.qn=t$jscomp$0.qn.insert(r.targetId,r),t$jscomp$0.He.updateTargetData(t,r).next(()=>t$jscomp$0.He.removeMatchingKeysForTargetId(t,s.targetId)).next(()=>t$jscomp$0.He.addMatchingKeys(t,n,s.targetId)).next(()=>t$jscomp$0.Ye.saveNamedQuery(t,
e))})})}function Lr(t,e,n){t=`firestore_mutations_${t}_${n}`;return e.isAuthenticated()&&(t+=`_${e.uid}`),t}function Br(t,e){return`firestore_targets_${t}_${e}`}function to(){return"undefined"!=typeof document?document:null}function uo(t){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){if(yo(t))for(const e of t.zr)yield e(!0)})}function ho(t){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){for(const e of t.zr)yield e(!1)})}function lo(t,e){t.Wr.has(e.targetId)||(t.Wr.set(e.targetId,
e),go(t)?mo(t):Oo(t).lr()&&wo(t,e))}function fo(t,e){const s=Oo(t);t.Wr.delete(e);s.lr()&&(t.Yr.X(e),Oo(t).vr(e));0===t.Wr.size&&(s.lr()?s._r():yo(t)&&t.Jr.set("Unknown"))}function wo(t,e){t.Yr.X(e.targetId);Oo(t).Pr(e)}function mo(t){t.Yr=new Ln({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),Et:e=>t.Wr.get(e)||null});Oo(t).start();t.Jr.Br()}function go(t){return yo(t)&&!Oo(t).hr()&&0<t.Wr.size}function yo(t){return 0===t.Gr.size}function To(t){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){t.Wr.forEach((e,
n)=>{wo(t,e)})})}function Eo(t,e){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){t.Yr=void 0;go(t)?(t.Jr.Kr(e),mo(t)):t.Jr.set("Unknown")})}function Io(t$jscomp$0,e$jscomp$2,n$jscomp$1){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){if(t$jscomp$0.Jr.set("Online"),e$jscomp$2 instanceof Mn&&2===e$jscomp$2.state&&e$jscomp$2.cause)try{yield function(t,e){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){const n=e.cause;for(const s of e.targetIds)t.Wr.has(s)&&
(yield t.remoteSyncer.rejectListen(s,n),t.Wr.delete(s),t.Yr.removeTarget(s))})}(t$jscomp$0,e$jscomp$2)}catch(n){O("RemoteStore","Failed to remove targets %s: %s ",e$jscomp$2.targetIds.join(","),n),yield Ao(t$jscomp$0,n)}else if(e$jscomp$2 instanceof $n?t$jscomp$0.Yr.ot(e$jscomp$2):e$jscomp$2 instanceof On?t$jscomp$0.Yr.dt(e$jscomp$2):t$jscomp$0.Yr.ut(e$jscomp$2),!n$jscomp$1.isEqual(ut.min()))try{const e$jscomp$1=yield mr(t$jscomp$0.localStore);0<=n$jscomp$1.compareTo(e$jscomp$1)&&(yield function(t,
e$jscomp$0){const n$jscomp$0=t.Yr.gt(e$jscomp$0);return n$jscomp$0.targetChanges.forEach((n,s)=>{if(0<n.resumeToken.approximateByteSize()){const i=t.Wr.get(s);i&&t.Wr.set(s,i.withResumeToken(n.resumeToken,e$jscomp$0))}}),n$jscomp$0.targetMismatches.forEach(e=>{const n=t.Wr.get(e);n&&(t.Wr.set(e,n.withResumeToken(pt.EMPTY_BYTE_STRING,n.snapshotVersion)),t.Yr.X(e),Oo(t).vr(e),e=new ai(n.target,e,1,n.sequenceNumber),wo(t,e))}),t.remoteSyncer.applyRemoteEvent(n$jscomp$0)}(t$jscomp$0,n$jscomp$1))}catch(e){O("RemoteStore",
"Failed to raise snapshot:",e),yield Ao(t$jscomp$0,e)}})}function Ao(t,e,n){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){if(!Zs(e))throw e;t.Gr.add(1);yield ho(t);t.Jr.set("Offline");n||(n=()=>mr(t.localStore));t.asyncQueue.enqueueRetryable(()=>$jscomp.asyncExecutePromiseGeneratorFunction(function*(){O("RemoteStore","Retrying IndexedDB access");yield n();t.Gr.delete(1);yield uo(t)}))})}function Ro(t,e){return e().catch(n=>Ao(t,n,e))}function bo(t$jscomp$1){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){const n$jscomp$0=
Mo(t$jscomp$1);let s=0<t$jscomp$1.Qr.length?t$jscomp$1.Qr[t$jscomp$1.Qr.length-1].batchId:-1;for(;Po(t$jscomp$1);)try{const t=yield pr(t$jscomp$1.localStore,s);if(null===t){0===t$jscomp$1.Qr.length&&n$jscomp$0._r();break}s=t.batchId;var t$jscomp$0=t$jscomp$1,e=t;t$jscomp$0.Qr.push(e);const n=Mo(t$jscomp$0);n.lr()&&n.Sr&&n.Dr(e.mutations)}catch(t){yield Ao(t$jscomp$1,t)}Vo(t$jscomp$1)&&Mo(t$jscomp$1).start()})}function Po(t){return yo(t)&&10>t.Qr.length}function Vo(t){return yo(t)&&!Mo(t).hr()&&0<
t.Qr.length}function Do(t){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){Mo(t).kr()})}function Co(t){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){const e=Mo(t);for(const n of t.Qr)e.Dr(n.mutations)})}function No(t,e,n){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){const s=t.Qr.shift(),i=ci.from(s,e,n);yield Ro(t,()=>t.remoteSyncer.applySuccessfulWrite(i));yield bo(t)})}function ko(t$jscomp$0,e$jscomp$0){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){e$jscomp$0&&
Mo(t$jscomp$0).Sr&&(yield function(t,e){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){if(n$jscomp$0=e.code,mn(n$jscomp$0)&&n$jscomp$0!==j.ABORTED){const n=t.Qr.shift();Mo(t).wr();yield Ro(t,()=>t.remoteSyncer.rejectFailedWrite(n.batchId,e));yield bo(t)}var n$jscomp$0})}(t$jscomp$0,e$jscomp$0));Vo(t$jscomp$0)&&Mo(t$jscomp$0).start()})}function xo(t,e){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){t.asyncQueue.verifyOperationInProgress();O("RemoteStore","RemoteStore received new credentials");
const s=yo(t);t.Gr.add(3);yield ho(t);s&&t.Jr.set("Unknown");yield t.remoteSyncer.handleCredentialChange(e);t.Gr.delete(3);yield uo(t)})}function $o(t,e){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){e?(t.Gr.delete(2),yield uo(t)):e||(t.Gr.add(2),yield ho(t),t.Jr.set("Unknown"))})}function Oo(t$jscomp$0){return t$jscomp$0.Xr||(t$jscomp$0.Xr=function(t,e,n){return t.Or(),new io(e,t.ir,t.authCredentials,t.appCheckCredentials,t.k,n)}(t$jscomp$0.datastore,t$jscomp$0.asyncQueue,{Di:To.bind(null,
t$jscomp$0),Ni:Eo.bind(null,t$jscomp$0),br:Io.bind(null,t$jscomp$0)}),t$jscomp$0.zr.push(e=>$jscomp.asyncExecutePromiseGeneratorFunction(function*(){e?(t$jscomp$0.Xr.wr(),go(t$jscomp$0)?mo(t$jscomp$0):t$jscomp$0.Jr.set("Unknown")):(yield t$jscomp$0.Xr.stop(),t$jscomp$0.Yr=void 0)}))),t$jscomp$0.Xr}function Mo(t$jscomp$0){return t$jscomp$0.Zr||(t$jscomp$0.Zr=function(t,e,n){return t.Or(),new ro(e,t.ir,t.authCredentials,t.appCheckCredentials,t.k,n)}(t$jscomp$0.datastore,t$jscomp$0.asyncQueue,{Di:Do.bind(null,
t$jscomp$0),Ni:ko.bind(null,t$jscomp$0),Nr:Co.bind(null,t$jscomp$0),Cr:No.bind(null,t$jscomp$0)}),t$jscomp$0.zr.push(e=>$jscomp.asyncExecutePromiseGeneratorFunction(function*(){e?(t$jscomp$0.Zr.wr(),yield bo(t$jscomp$0)):(yield t$jscomp$0.Zr.stop(),0<t$jscomp$0.Qr.length&&(O("RemoteStore",`Stopping write stream with ${t$jscomp$0.Qr.length} pending writes`),t$jscomp$0.Qr=[]))}))),t$jscomp$0.Zr}function Lo(t,e){if(M("AsyncQueue",`${e}: ${t}`),Zs(t))return new Q(j.UNAVAILABLE,`${e}: ${t}`);throw t;}
function Qo(t$jscomp$0,e){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){var s=e.query;let i=!1,r=t$jscomp$0.queries.get(s);if(r||(i=!0,r=new Ko),i)try{r.so=yield t$jscomp$0.onListen(s)}catch(t){return s=Lo(t,`Initialization of query '${Se(e.query)}' failed`),void e.onError(s)}(t$jscomp$0.queries.set(s,r),r.listeners.push(e),e.ro(t$jscomp$0.onlineState),r.so)&&e.oo(r.so)&&Ho(t$jscomp$0)})}function Wo(t$jscomp$0,e){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){const s=
e.query;let i=!1;const r=t$jscomp$0.queries.get(s);if(r){const t=r.listeners.indexOf(e);0<=t&&(r.listeners.splice(t,1),i=0===r.listeners.length)}if(i)return t$jscomp$0.queries.delete(s),t$jscomp$0.onUnlisten(s)})}function Go(t$jscomp$0,e$jscomp$0){let s=!1;for(const t of e$jscomp$0)if(e$jscomp$0=t$jscomp$0.queries.get(t.query)){for(const e of e$jscomp$0.listeners)e.oo(t)&&(s=!0);e$jscomp$0.so=t}s&&Ho(t$jscomp$0)}function zo(t$jscomp$0,e,n){const i=t$jscomp$0.queries.get(e);if(i)for(const t of i.listeners)t.onError(n);
t$jscomp$0.queries.delete(e)}function Ho(t$jscomp$0){t$jscomp$0.io.forEach(t=>{t.next()})}function tc(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}function cc(t,e){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){const n=Oc(t);var r$jscomp$0=n.Mo.get(e);if(r$jscomp$0){var s=r$jscomp$0.targetId;n.sharedClientState.addLocalQueryTarget(s);s=r$jscomp$0.view.xo()}else{r$jscomp$0=yield Tr(n.localStore,be(e));const r=
n.sharedClientState.addLocalQueryTarget(r$jscomp$0.targetId);s=r$jscomp$0.targetId;s=yield ac(n,e,s,"current"===r);n.isPrimaryClient&&lo(n.remoteStore,r$jscomp$0)}return s})}function ac(t$jscomp$1,e$jscomp$1,n$jscomp$1,s$jscomp$1){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){t$jscomp$1.Go=(e$jscomp$0,n$jscomp$0,s$jscomp$0)=>function(t$jscomp$0,e,n,s){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){let i=e.view.Po(n);i.Bn&&(i=yield Ir(t$jscomp$0.localStore,e.query,
!1).then(({documents:t})=>e.view.Po(t,i)));var r=s&&s.targetChanges.get(e.targetId);r=e.view.applyChanges(i,t$jscomp$0.isPrimaryClient,r);return Ec(t$jscomp$0,e.targetId,r.Co),r.snapshot})}(t$jscomp$1,e$jscomp$0,n$jscomp$0,s$jscomp$0);var i$jscomp$0=yield Ir(t$jscomp$1.localStore,e$jscomp$1,!0),r$jscomp$0=new sc(e$jscomp$1,i$jscomp$0.zn);i$jscomp$0=r$jscomp$0.Po(i$jscomp$0.documents);const c=xn.createSynthesizedTargetChangeForCurrentChange(n$jscomp$1,s$jscomp$1&&"Offline"!==t$jscomp$1.onlineState);
i$jscomp$0=r$jscomp$0.applyChanges(i$jscomp$0,t$jscomp$1.isPrimaryClient,c);Ec(t$jscomp$1,n$jscomp$1,i$jscomp$0.Co);r$jscomp$0=new ic(e$jscomp$1,n$jscomp$1,r$jscomp$0);return t$jscomp$1.Mo.set(e$jscomp$1,r$jscomp$0),t$jscomp$1.Fo.has(n$jscomp$1)?t$jscomp$1.Fo.get(n$jscomp$1).push(e$jscomp$1):t$jscomp$1.Fo.set(n$jscomp$1,[e$jscomp$1]),i$jscomp$0.snapshot})}function uc(t$jscomp$0,e){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){const s=t$jscomp$0.Mo.get(e),i=t$jscomp$0.Fo.get(s.targetId);
if(1<i.length)return t$jscomp$0.Fo.set(s.targetId,i.filter(t=>!ve(t,e))),void t$jscomp$0.Mo.delete(e);t$jscomp$0.isPrimaryClient?(t$jscomp$0.sharedClientState.removeLocalQueryTarget(s.targetId),t$jscomp$0.sharedClientState.isActiveQueryTarget(s.targetId)||(yield Er(t$jscomp$0.localStore,s.targetId,!1).then(()=>{t$jscomp$0.sharedClientState.clearQueryState(s.targetId);fo(t$jscomp$0.remoteStore,s.targetId);pc(t$jscomp$0,s.targetId)}).catch(Ui))):(pc(t$jscomp$0,s.targetId),yield Er(t$jscomp$0.localStore,
s.targetId,!0))})}function hc(t$jscomp$4,e$jscomp$1,n$jscomp$0){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){var s$jscomp$1=Mc(t$jscomp$4);try{const t$jscomp$3=yield function(t$jscomp$2,e$jscomp$0){const s$jscomp$0=at.now(),i$jscomp$0=e$jscomp$0.reduce((t,e)=>t.add(e.key),Dn());let r;return t$jscomp$2.persistence.runTransaction("Locally write mutations","readwrite",t$jscomp$1=>t$jscomp$2.Wn.vn(t$jscomp$1,i$jscomp$0).next(i=>{r=i;i=[];for(const t of e$jscomp$0){var t$jscomp$0=t,
e=r.get(t.key);let n=null;for(const s of t$jscomp$0.fieldTransforms)t$jscomp$0=e.data.field(s.field),t$jscomp$0=Le(s.transform,t$jscomp$0||null),null!=t$jscomp$0&&(null==n&&(n=Qt.empty()),n.set(s.field,t$jscomp$0));e=n||null;null!=e&&i.push(new cn(t.key,e,Wt(e.value.mapValue),Ye.exists(!0)))}return t$jscomp$2.An.addMutationBatch(t$jscomp$1,s$jscomp$0,i,e$jscomp$0)})).then(t=>(t.applyToLocalDocumentSet(r),{batchId:t.batchId,changes:r}))}(s$jscomp$1.localStore,e$jscomp$1);s$jscomp$1.sharedClientState.addPendingMutation(t$jscomp$3.batchId);
(function(t,e,n){let s=t.Ko[t.currentUser.toKey()];s||(s=new yn(rt));s=s.insert(e,n);t.Ko[t.currentUser.toKey()]=s})(s$jscomp$1,t$jscomp$3.batchId,n$jscomp$0);yield Rc(s$jscomp$1,t$jscomp$3.changes);yield bo(s$jscomp$1.remoteStore)}catch(t){s$jscomp$1=Lo(t,"Failed to persist write"),n$jscomp$0.reject(s$jscomp$1)}})}function lc(t$jscomp$1,e$jscomp$0){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){try{const t$jscomp$0=yield gr(t$jscomp$1.localStore,e$jscomp$0);e$jscomp$0.targetChanges.forEach((t,
e)=>{if(e=t$jscomp$1.Uo.get(e))1>=t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size||B(),0<t.addedDocuments.size?e.$o=!0:0<t.modifiedDocuments.size?e.$o||B():0<t.removedDocuments.size&&(e.$o||B(),e.$o=!1)});yield Rc(t$jscomp$1,t$jscomp$0,e$jscomp$0)}catch(t){yield Ui(t)}})}function fc(t$jscomp$3,e$jscomp$0,n$jscomp$0){if(t$jscomp$3.isPrimaryClient&&0===n$jscomp$0||!t$jscomp$3.isPrimaryClient&&1===n$jscomp$0){const t$jscomp$2=[];t$jscomp$3.Mo.forEach((n,s)=>{n=s.view.ro(e$jscomp$0);
n.snapshot&&t$jscomp$2.push(n.snapshot)});(function(t$jscomp$1,e){t$jscomp$1.onlineState=e;let s=!1;t$jscomp$1.queries.forEach((t$jscomp$0,n)=>{for(const t of n.listeners)t.ro(e)&&(s=!0)});s&&Ho(t$jscomp$1)})(t$jscomp$3.eventManager,e$jscomp$0);t$jscomp$2.length&&t$jscomp$3.Oo.br(t$jscomp$2);t$jscomp$3.onlineState=e$jscomp$0;t$jscomp$3.isPrimaryClient&&t$jscomp$3.sharedClientState.setOnlineState(e$jscomp$0)}}function dc(t$jscomp$0,e,n$jscomp$0){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){t$jscomp$0.sharedClientState.updateQueryState(e,
"rejected",n$jscomp$0);var i=t$jscomp$0.Uo.get(e);if(i=i&&i.key){var t=new yn(Dt.comparator);t=t.insert(i,Gt.newNoDocument(i,ut.min()));const n=Dn().add(i);t=new kn(ut.min(),new Map,new En(rt),t,n);yield lc(t$jscomp$0,t);t$jscomp$0.Bo=t$jscomp$0.Bo.remove(i);t$jscomp$0.Uo.delete(e);Ac(t$jscomp$0)}else yield Er(t$jscomp$0.localStore,e,!1).then(()=>pc(t$jscomp$0,e,n$jscomp$0)).catch(Ui)})}function wc(t$jscomp$0,e){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){const s=e.batch.batchId;
try{const t=yield _r(t$jscomp$0.localStore,e);yc(t$jscomp$0,s,null);gc(t$jscomp$0,s);t$jscomp$0.sharedClientState.updateMutationState(s,"acknowledged");yield Rc(t$jscomp$0,t)}catch(t){yield Ui(t)}})}function _c(t$jscomp$2,e$jscomp$1,n$jscomp$0){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){try{const t$jscomp$1=yield function(t$jscomp$0,e$jscomp$0){return t$jscomp$0.persistence.runTransaction("Reject batch","readwrite-primary",t=>{let s;return t$jscomp$0.An.lookupMutationBatch(t,
e$jscomp$0).next(e=>{null!==e||B();return s=e.keys(),t$jscomp$0.An.removeMutationBatch(t,e)}).next(()=>t$jscomp$0.An.performConsistencyCheck(t)).next(()=>t$jscomp$0.Wn.vn(t,s))})}(t$jscomp$2.localStore,e$jscomp$1);yc(t$jscomp$2,e$jscomp$1,n$jscomp$0);gc(t$jscomp$2,e$jscomp$1);t$jscomp$2.sharedClientState.updateMutationState(e$jscomp$1,"rejected",n$jscomp$0);yield Rc(t$jscomp$2,t$jscomp$1)}catch(n){yield Ui(n)}})}function mc(t$jscomp$2,e){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){yo(t$jscomp$2.remoteStore)||
O("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{var t$jscomp$1=yield function(t$jscomp$0){return t$jscomp$0.persistence.runTransaction("Get highest unacknowledged batch id","readonly",t=>t$jscomp$0.An.getHighestUnacknowledgedBatchId(t))}(t$jscomp$2.localStore);if(-1===t$jscomp$1)return void e.resolve();const s=t$jscomp$2.jo.get(t$jscomp$1)||[];s.push(e);t$jscomp$2.jo.set(t$jscomp$1,s)}catch(t){t$jscomp$1=Lo(t,
"Initialization of waitForPendingWrites() operation failed"),e.reject(t$jscomp$1)}})}function gc(t$jscomp$0,e){(t$jscomp$0.jo.get(e)||[]).forEach(t=>{t.resolve()});t$jscomp$0.jo.delete(e)}function yc(t$jscomp$0,e,n){let i=t$jscomp$0.Ko[t$jscomp$0.currentUser.toKey()];if(i){const t=i.get(e);t&&(n?t.reject(n):t.resolve(),i=i.remove(e));t$jscomp$0.Ko[t$jscomp$0.currentUser.toKey()]=i}}function pc(t,e$jscomp$0,n=null){t.sharedClientState.removeLocalQueryTarget(e$jscomp$0);for(const s of t.Fo.get(e$jscomp$0))t.Mo.delete(s),
n&&t.Oo.zo(s,n);(t.Fo.delete(e$jscomp$0),t.isPrimaryClient)&&t.qo.us(e$jscomp$0).forEach(e=>{t.qo.containsKey(e)||Tc(t,e)})}function Tc(t,e){t.Lo.delete(e.path.canonicalString());const n=t.Bo.get(e);null!==n&&(fo(t.remoteStore,n),t.Bo=t.Bo.remove(e),t.Uo.delete(n),Ac(t))}function Ec(t,e,n$jscomp$0){for(const s$jscomp$0 of n$jscomp$0)if(s$jscomp$0 instanceof ec){t.qo.addReference(s$jscomp$0.key,e);n$jscomp$0=t;const n=s$jscomp$0.key,s=n.path.canonicalString();n$jscomp$0.Bo.get(n)||n$jscomp$0.Lo.has(s)||
(O("SyncEngine","New document in limbo: "+n),n$jscomp$0.Lo.add(s),Ac(n$jscomp$0))}else s$jscomp$0 instanceof nc?(O("SyncEngine","Document no longer in limbo: "+s$jscomp$0.key),t.qo.removeReference(s$jscomp$0.key,e),t.qo.containsKey(s$jscomp$0.key)||Tc(t,s$jscomp$0.key)):B()}function Ac(t){for(;0<t.Lo.size&&t.Bo.size<t.maxConcurrentLimboResolutions;){var e=t.Lo.values().next().value;t.Lo.delete(e);e=new Dt(wt.fromString(e));const s=t.Qo.next();t.Uo.set(s,new rc(e));t.Bo=t.Bo.insert(e,s);lo(t.remoteStore,
new ai(be(new me(e.path)),s,2,nt.I))}}function Rc(t$jscomp$2,e$jscomp$1,n){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){const i=[],r=[],o=[];t$jscomp$2.Mo.isEmpty()||(t$jscomp$2.Mo.forEach((t$jscomp$0,c)=>{o.push(t$jscomp$2.Go(c,e$jscomp$1,n).then(t=>{t&&(t$jscomp$2.isPrimaryClient&&t$jscomp$2.sharedClientState.updateQueryState(c.targetId,t.fromCache?"not-current":"current"),i.push(t),t=hr.$n(c.targetId,t),r.push(t))}))}),yield Promise.all(o),t$jscomp$2.Oo.br(i),yield function(t$jscomp$1,
e$jscomp$0){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){try{yield t$jscomp$1.persistence.runTransaction("notifyLocalViewChanges","readwrite",t=>zs.forEach(e$jscomp$0,e=>zs.forEach(e.kn,s=>t$jscomp$1.persistence.referenceDelegate.addReference(t,e.targetId,s)).next(()=>zs.forEach(e.xn,s=>t$jscomp$1.persistence.referenceDelegate.removeReference(t,e.targetId,s)))))}catch(t){if(!Zs(t))throw t;O("LocalStore","Failed to update sequence numbers: "+t)}for(const t of e$jscomp$0){const e=
t.targetId;if(!t.fromCache){var t$jscomp$0=t$jscomp$1.qn.get(e);t$jscomp$0=t$jscomp$0.withLastLimboFreeSnapshotVersion(t$jscomp$0.snapshotVersion);t$jscomp$1.qn=t$jscomp$1.qn.insert(e,t$jscomp$0)}}})}(t$jscomp$2.localStore,r))})}function bc(t$jscomp$3,e$jscomp$0){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){if(!t$jscomp$3.currentUser.isEqual(e$jscomp$0)){O("SyncEngine","User change. New user:",e$jscomp$0.toKey());const t$jscomp$2=yield wr(t$jscomp$3.localStore,e$jscomp$0);t$jscomp$3.currentUser=
e$jscomp$0;(function(t$jscomp$1,e){t$jscomp$1.jo.forEach(t$jscomp$0=>{t$jscomp$0.forEach(t=>{t.reject(new Q(j.CANCELLED,e))})});t$jscomp$1.jo.clear()})(t$jscomp$3,"'waitForPendingWrites' promise is rejected due to a user change.");t$jscomp$3.sharedClientState.handleUserChange(e$jscomp$0,t$jscomp$2.removedBatchIds,t$jscomp$2.addedBatchIds);yield Rc(t$jscomp$3,t$jscomp$2.Gn)}})}function Pc(t,e$jscomp$0){var s=t.Uo.get(e$jscomp$0);if(s&&s.$o)return Dn().add(s.key);s=Dn();e$jscomp$0=t.Fo.get(e$jscomp$0);
if(!e$jscomp$0)return s;for(const e of e$jscomp$0)e$jscomp$0=t.Mo.get(e),s=s.unionWith(e$jscomp$0.view.bo);return s}function vc(t,e){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){var s=yield Ir(t.localStore,e.query,!0);s=e.view.ko(s);return t.isPrimaryClient&&Ec(t,e.targetId,s.Co),s})}function Vc(t$jscomp$0){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){return Rr(t$jscomp$0.localStore).then(t=>Rc(t$jscomp$0,t))})}function Sc(t$jscomp$1,e$jscomp$1,n,s$jscomp$0){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){const r=
yield function(t$jscomp$0,e$jscomp$0){const s=t$jscomp$0.An;return t$jscomp$0.persistence.runTransaction("Lookup mutation documents","readonly",t=>s.Zt(t,e$jscomp$0).next(e=>e?t$jscomp$0.Wn.vn(t,e):zs.resolve(null)))}(t$jscomp$1.localStore,e$jscomp$1);null!==r?("pending"===n?yield bo(t$jscomp$1.remoteStore):"acknowledged"===n||"rejected"===n?(yc(t$jscomp$1,e$jscomp$1,s$jscomp$0||null),gc(t$jscomp$1,e$jscomp$1),t$jscomp$1.localStore.An.ee(e$jscomp$1)):B(),yield Rc(t$jscomp$1,r)):O("SyncEngine","Cannot apply mutation batch with id: "+
e$jscomp$1)})}function Dc(t$jscomp$3,e$jscomp$0){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){if(Oc(t$jscomp$3),Mc(t$jscomp$3),!0===e$jscomp$0&&!0!==t$jscomp$3.Wo){var t$jscomp$2=t$jscomp$3.sharedClientState.getAllActiveQueryTargets();t$jscomp$2=yield Cc(t$jscomp$3,t$jscomp$2.toArray());t$jscomp$3.Wo=!0;yield $o(t$jscomp$3.remoteStore,!0);for(const t of t$jscomp$2)lo(t$jscomp$3.remoteStore,t)}else if(!1===e$jscomp$0&&!1!==t$jscomp$3.Wo){const t$jscomp$1=[];let e=Promise.resolve();
t$jscomp$3.Fo.forEach((s,i)=>{t$jscomp$3.sharedClientState.isLocalQueryTarget(i)?t$jscomp$1.push(i):e=e.then(()=>(pc(t$jscomp$3,i),Er(t$jscomp$3.localStore,i,!0)));fo(t$jscomp$3.remoteStore,i)});yield e;yield Cc(t$jscomp$3,t$jscomp$1);(function(t$jscomp$0){t$jscomp$0.Uo.forEach((t,n)=>{fo(t$jscomp$0.remoteStore,n)});t$jscomp$0.qo.hs();t$jscomp$0.Uo=new Map;t$jscomp$0.Bo=new yn(Dt.comparator)})(t$jscomp$3);t$jscomp$3.Wo=!1;yield $o(t$jscomp$3.remoteStore,!1)}})}function Cc(t$jscomp$1,e$jscomp$0,n$jscomp$0){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){const i=
[],r=[];for(const t$jscomp$0 of e$jscomp$0){let e;var n=t$jscomp$1.Fo.get(t$jscomp$0);if(n&&0!==n.length){e=yield Tr(t$jscomp$1.localStore,be(n[0]));for(const t of n)n=t$jscomp$1.Mo.get(t),n=yield vc(t$jscomp$1,n),n.snapshot&&r.push(n.snapshot)}else n=yield Ar(t$jscomp$1.localStore,t$jscomp$0),e=yield Tr(t$jscomp$1.localStore,n),yield ac(t$jscomp$1,Nc(n),t$jscomp$0,!1);i.push(e)}return t$jscomp$1.Oo.br(r),i})}function Nc(t){return new me(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,
t.endAt)}function kc(t){return t.localStore.persistence.Tn()}function xc(t$jscomp$0,e,n,s$jscomp$0){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){if(t$jscomp$0.Wo)O("SyncEngine","Ignoring unexpected query state notification.");else if(t$jscomp$0.Fo.has(e))switch(n){case "current":case "not-current":const t=yield Rr(t$jscomp$0.localStore),s=kn.createSynthesizedRemoteEventForCurrentChange(e,"current"===n);yield Rc(t$jscomp$0,t,s);break;case "rejected":yield Er(t$jscomp$0.localStore,
e,!0);pc(t$jscomp$0,e,s$jscomp$0);break;default:B()}})}function $c(t$jscomp$0,e$jscomp$0,n$jscomp$0){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){const s=Oc(t$jscomp$0);if(s.Wo){for(const t of e$jscomp$0){if(s.Fo.has(t)){O("SyncEngine","Adding an already active target "+t);continue}const e=yield Ar(s.localStore,t),n=yield Tr(s.localStore,e);yield ac(s,Nc(e),n.targetId,!1);lo(s.remoteStore,n)}for(const t of n$jscomp$0)s.Fo.has(t)&&(yield Er(s.localStore,t,!1).then(()=>{fo(s.remoteStore,
t);pc(s,t)}).catch(Ui))}})}function Oc(t){return t.remoteStore.remoteSyncer.applyRemoteEvent=lc.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Pc.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=dc.bind(null,t),t.Oo.br=Go.bind(null,t.eventManager),t.Oo.zo=zo.bind(null,t.eventManager),t}function Mc(t){return t.remoteStore.remoteSyncer.applySuccessfulWrite=wc.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=_c.bind(null,t),t}function Fc(t$jscomp$2,e$jscomp$1,n$jscomp$0){(function(t$jscomp$1,
e$jscomp$0,n){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){try{const s$jscomp$0=yield e$jscomp$0.getMetadata();if(yield function(t$jscomp$0,e){const s=zn(e.createTime);return t$jscomp$0.persistence.runTransaction("hasNewerBundle","readonly",t=>t$jscomp$0.Ye.getBundleMetadata(t,e.id)).then(t=>!!t&&0<=t.createTime.compareTo(s))}(t$jscomp$1.localStore,s$jscomp$0))return yield e$jscomp$0.close(),void n._completeWith({taskState:"Success",documentsLoaded:s$jscomp$0.totalDocuments,bytesLoaded:s$jscomp$0.totalBytes,
totalDocuments:s$jscomp$0.totalDocuments,totalBytes:s$jscomp$0.totalBytes});n._updateProgress(tc(s$jscomp$0));const i=new Zo(s$jscomp$0,t$jscomp$1.localStore,e$jscomp$0.k);let r=yield e$jscomp$0.Ho();for(;r;){const t=yield i.yo(r);t&&n._updateProgress(t);r=yield e$jscomp$0.Ho()}const o=yield i.complete();yield Rc(t$jscomp$1,o.In,void 0);yield function(t$jscomp$0,e){return t$jscomp$0.persistence.runTransaction("Save bundle","readwrite",t=>t$jscomp$0.Ye.saveBundleMetadata(t,e))}(t$jscomp$1.localStore,
s$jscomp$0);n._completeWith(o.progress)}catch(t){F("SyncEngine",`Loading bundle failed with ${t}`),n._failWith(t)}})})(t$jscomp$2,e$jscomp$1,n$jscomp$0).then(()=>{t$jscomp$2.sharedClientState.notifyBundleLoaded()})}function Kc(t,e=10240){let n=0;return{read(){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){if(n<t.byteLength){const s={value:t.slice(n,n+e),done:!1};return n+=e,s}return{done:!0}})},cancel(){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){})},releaseLock(){},
closed:Promise.reject("unimplemented")}}function Hc(t$jscomp$0,e){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){t$jscomp$0.asyncQueue.verifyOperationInProgress();O("FirestoreClient","Initializing OfflineComponentProvider");const n=yield t$jscomp$0.getConfiguration();yield e.initialize(n);let s=n.initialUser;t$jscomp$0.setCredentialChangeListener(t=>$jscomp.asyncExecutePromiseGeneratorFunction(function*(){s.isEqual(t)||(yield wr(e.localStore,t),s=t)}));e.persistence.setDatabaseDeletedListener(()=>
t$jscomp$0.terminate());t$jscomp$0.offlineComponents=e})}function Jc(t$jscomp$0,e){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){t$jscomp$0.asyncQueue.verifyOperationInProgress();const n$jscomp$0=yield Yc(t$jscomp$0);O("FirestoreClient","Initializing OnlineComponentProvider");const s=yield t$jscomp$0.getConfiguration();yield e.initialize(n$jscomp$0,s);t$jscomp$0.setCredentialChangeListener(t=>xo(e.remoteStore,t));t$jscomp$0.setAppCheckTokenChangeListener((t,n)=>xo(e.remoteStore,
n));t$jscomp$0.onlineComponents=e})}function Yc(t){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){return t.offlineComponents||(O("FirestoreClient","Using default OfflineComponentProvider"),yield Hc(t,new Lc)),t.offlineComponents})}function Xc(t){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){return t.onlineComponents||(O("FirestoreClient","Using default OnlineComponentProvider"),yield Jc(t,new qc)),t.onlineComponents})}function Zc(t$jscomp$0){return Yc(t$jscomp$0).then(t=>
t.persistence)}function ta(t$jscomp$0){return Yc(t$jscomp$0).then(t=>t.localStore)}function ea(t$jscomp$0){return Xc(t$jscomp$0).then(t=>t.remoteStore)}function na(t$jscomp$0){return Xc(t$jscomp$0).then(t=>t.syncEngine)}function sa(t){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){const e=yield Xc(t),n=e.eventManager;return n.onListen=cc.bind(null,e.syncEngine),n.onUnlisten=uc.bind(null,e.syncEngine),n})}function ia(t){return t.asyncQueue.enqueue(()=>$jscomp.asyncExecutePromiseGeneratorFunction(function*(){const e=
yield Zc(t),n=yield ea(t);e.setNetworkEnabled(!0);return n.Gr.delete(0),uo(n)}))}function ra(t$jscomp$0){return t$jscomp$0.asyncQueue.enqueue(()=>$jscomp.asyncExecutePromiseGeneratorFunction(function*(){const e=yield Zc(t$jscomp$0),n=yield ea(t$jscomp$0);return e.setNetworkEnabled(!1),function(t){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){t.Gr.add(0);yield ho(t);t.Jr.set("Offline")})}(n)}))}function oa(t$jscomp$2,e$jscomp$1){const n$jscomp$0=new W;return t$jscomp$2.asyncQueue.enqueueAndForget(()=>
$jscomp.asyncExecutePromiseGeneratorFunction(function*(){return function(t$jscomp$1,e$jscomp$0,n){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){try{var s=yield function(t$jscomp$0,e){return t$jscomp$0.persistence.runTransaction("read document","readonly",t=>t$jscomp$0.Wn.Rn(t,e))}(t$jscomp$1,e$jscomp$0);s.isFoundDocument()?n.resolve(s):s.isNoDocument()?n.resolve(null):n.reject(new Q(j.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(t){s=
Lo(t,`Failed to get document '${e$jscomp$0} from cache`),n.reject(s)}})}(yield ta(t$jscomp$2),e$jscomp$1,n$jscomp$0)})),n$jscomp$0.promise}function ca(t$jscomp$1,e$jscomp$0,n$jscomp$0={}){const s$jscomp$0=new W;return t$jscomp$1.asyncQueue.enqueueAndForget(()=>$jscomp.asyncExecutePromiseGeneratorFunction(function*(){return function(t$jscomp$0,e,n,s,i){const r$jscomp$0=new jc({next:r=>{e.enqueueAndForget(()=>Wo(t$jscomp$0,o));const c=r.docs.has(n);!c&&r.fromCache?i.reject(new Q(j.UNAVAILABLE,"Failed to get document because the client is offline.")):
c&&r.fromCache&&s&&"server"===s.source?i.reject(new Q(j.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(r)},error:t=>i.reject(t)}),o=new Jo(new me(n.path),r$jscomp$0,{includeMetadataChanges:!0,wo:!0});return Qo(t$jscomp$0,o)}(yield sa(t$jscomp$1),t$jscomp$1.asyncQueue,e$jscomp$0,n$jscomp$0,s$jscomp$0)})),s$jscomp$0.promise}function aa(t$jscomp$1,e$jscomp$0){const n$jscomp$0=
new W;return t$jscomp$1.asyncQueue.enqueueAndForget(()=>$jscomp.asyncExecutePromiseGeneratorFunction(function*(){return function(t$jscomp$0,e,n){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){try{var s=yield Ir(t$jscomp$0,e,!0);const i=new sc(e,s.zn),r=i.Po(s.documents),o=i.applyChanges(r,!1);n.resolve(o.snapshot)}catch(t){s=Lo(t,`Failed to execute query '${e} against cache`),n.reject(s)}})}(yield ta(t$jscomp$1),e$jscomp$0,n$jscomp$0)})),n$jscomp$0.promise}function ua(t$jscomp$1,
e$jscomp$0,n$jscomp$1={}){const s$jscomp$0=new W;return t$jscomp$1.asyncQueue.enqueueAndForget(()=>$jscomp.asyncExecutePromiseGeneratorFunction(function*(){return function(t$jscomp$0,e,n$jscomp$0,s,i){const r=new jc({next:n=>{e.enqueueAndForget(()=>Wo(t$jscomp$0,o));n.fromCache&&"server"===s.source?i.reject(new Q(j.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):
i.resolve(n)},error:t=>i.reject(t)}),o=new Jo(n$jscomp$0,r,{includeMetadataChanges:!0,wo:!0});return Qo(t$jscomp$0,o)}(yield sa(t$jscomp$1),t$jscomp$1.asyncQueue,e$jscomp$0,n$jscomp$1,s$jscomp$0)})),s$jscomp$0.promise}function ha(t,e){const n=new jc(e);return t.asyncQueue.enqueueAndForget(()=>$jscomp.asyncExecutePromiseGeneratorFunction(function*(){(yield sa(t)).io.add(n);n.next()})),()=>{n.nc();t.asyncQueue.enqueueAndForget(()=>$jscomp.asyncExecutePromiseGeneratorFunction(function*(){(yield sa(t)).io.delete(n)}))}}
function la(t$jscomp$1,e){const n=new W;return t$jscomp$1.asyncQueue.enqueueAndForget(()=>$jscomp.asyncExecutePromiseGeneratorFunction(function*(){const s=yield function(t$jscomp$0){return Xc(t$jscomp$0).then(t=>t.datastore)}(t$jscomp$1);(new Gc(t$jscomp$1.asyncQueue,s,e,n)).run()})),n.promise}function fa(t$jscomp$1,e$jscomp$1,n,s){const i=function(t$jscomp$0,e$jscomp$0){return function(t,e){return new Qc(t,e)}(function(t,e){if(t instanceof Uint8Array)return Kc(t,e);if(t instanceof ArrayBuffer)return Kc(new Uint8Array(t),
e);if(t instanceof ReadableStream)return t.getReader();throw Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream");}("string"==typeof t$jscomp$0?(new TextEncoder).encode(t$jscomp$0):t$jscomp$0),e$jscomp$0)}(n,new jn(e$jscomp$1,!0));t$jscomp$1.asyncQueue.enqueueAndForget(()=>$jscomp.asyncExecutePromiseGeneratorFunction(function*(){Fc(yield na(t$jscomp$1),i,s)}))}function da(t$jscomp$1,e$jscomp$0){return t$jscomp$1.asyncQueue.enqueue(()=>$jscomp.asyncExecutePromiseGeneratorFunction(function*(){return function(t$jscomp$0,
e){return t$jscomp$0.persistence.runTransaction("Get named query","readonly",t=>t$jscomp$0.Ye.getNamedQuery(t,e))}(yield ta(t$jscomp$1),e$jscomp$0)}))}function ga(t,e,n){if(!n)throw new Q(j.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`);}function ya(t,e,n,s){if(!0===e&&!0===s)throw new Q(j.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`);}function pa(t){if(!Dt.isDocumentKey(t))throw new Q(j.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`);
}function Ta(t){if(Dt.isDocumentKey(t))throw new Q(j.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`);}function Ea(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return 20<t.length&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";t=t.constructor?t.constructor.name:
null;return t?`a custom ${t} object`:"an object"}return"function"==typeof t?"a function":B()}function Ia(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Q(j.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");t=Ea(t);throw new Q(j.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`);}return t}function Aa(t,e){if(0>=e)throw new Q(j.INVALID_ARGUMENT,`Function ${t}() requires a positive number, but it was: ${e}.`);
}function Na(t,e,...n){if(t=(0,_util.getModularInstance)(t),1===arguments.length&&(e=it.A()),ga("doc","path",e),t instanceof ba)return n=wt.fromString(e,...n),pa(n),new va(t,null,new Dt(n));if(!(t instanceof va||t instanceof Sa))throw new Q(j.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");n=t._path.child(wt.fromString(e,...n));return pa(n),new va(t.firestore,t instanceof Sa?t.converter:null,new Dt(n))}function xa(t,
e){return t=(0,_util.getModularInstance)(t),e=(0,_util.getModularInstance)(e),t instanceof Va&&e instanceof Va&&t.firestore===e.firestore&&ve(t._query,e._query)&&t.converter===e.converter}function Oa(t$jscomp$0){a:{var e=["next","error","complete"];if("object"==typeof t$jscomp$0&&null!==t$jscomp$0)for(const t of e)if(t in t$jscomp$0&&"function"==typeof t$jscomp$0[t]){t$jscomp$0=!0;break a}t$jscomp$0=!1}return t$jscomp$0}function qa(t){return t._firestoreClient||Ka(t),t._firestoreClient.verifyNotTerminated(),
t._firestoreClient}function Ka(t){var e;const n=t._freezeSettings();var e$jscomp$0=(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"";e=new wa(t._databaseId,e$jscomp$0,t._persistenceKey,n.host,n.ssl,n.experimentalForceLongPolling,n.experimentalAutoDetectLongPolling,n.useFetchStreams);t._firestoreClient=new zc(t._authCredentials,t._appCheckCredentials,t._queue,e)}function Wa(t$jscomp$0,e,n){const s=new W;return t$jscomp$0.asyncQueue.enqueue(()=>$jscomp.asyncExecutePromiseGeneratorFunction(function*(){try{yield Hc(t$jscomp$0,
n),yield Jc(t$jscomp$0,e),s.resolve()}catch(t){var JSCompiler_inline_result="FirebaseError"===t.name?t.code===j.FAILED_PRECONDITION||t.code===j.UNIMPLEMENTED:"undefined"!=typeof DOMException&&t instanceof DOMException?22===t.code||20===t.code||11===t.code:!0;if(!JSCompiler_inline_result)throw t;console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+t);s.reject(t)}})).then(()=>s.promise)}function tu(t){if(t._initialized||t._terminated)throw new Q(j.FAILED_PRECONDITION,
"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");}function uu(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw B();}}function fu(t){const e=t._freezeSettings(),n=new jn(t._databaseId,!0);return new lu(t._databaseId,!!e.ignoreUndefinedProperties,n)}function du(t$jscomp$0,e,n,s$jscomp$0,i,r={}){t$jscomp$0=t$jscomp$0.Qc(r.merge||r.mergeFields?2:0,e,n,i);
Pu("Data must be an object, but it was:",t$jscomp$0,s$jscomp$0);s$jscomp$0=Ru(s$jscomp$0,t$jscomp$0);let a;if(r.merge)a=new gt(t$jscomp$0.fieldMask),e=t$jscomp$0.fieldTransforms;else if(r.mergeFields){i=[];for(const s of r.mergeFields){r=vu(e,s,n);if(!t$jscomp$0.contains(r))throw new Q(j.INVALID_ARGUMENT,`Field '${r}' is specified in your field mask but missing from your input data.`);Cu(i,r)||i.push(r)}a=new gt(i);e=t$jscomp$0.fieldTransforms.filter(t=>a.covers(t.field))}else a=null,e=t$jscomp$0.fieldTransforms;
return new cu(new Qt(s$jscomp$0),a,e)}function _u(t,e,n){return new hu({$c:3,jc:e.settings.jc,methodName:t._methodName,Fc:n},e.databaseId,e.k,e.ignoreUndefinedProperties)}function Tu(t$jscomp$0,e,n,s$jscomp$0){const i=t$jscomp$0.Qc(1,e,n);Pu("Data must be an object, but it was:",i,s$jscomp$0);const r=[],o=Qt.empty();lt(s$jscomp$0,(t,s)=>{t=Su(e,t,n);s=(0,_util.getModularInstance)(s);const a=i.Bc(t);s instanceof wu?r.push(t):(s=Au(s,a),null!=s&&(r.push(t),o.set(t,s)))});t$jscomp$0=new gt(r);return new au(o,
t$jscomp$0,i.fieldTransforms)}function Eu(t,e$jscomp$0,n$jscomp$0,s$jscomp$0,i,r){t=t.Qc(1,e$jscomp$0,n$jscomp$0);n$jscomp$0=[vu(e$jscomp$0,s$jscomp$0,n$jscomp$0)];i=[i];if(0!=r.length%2)throw new Q(j.INVALID_ARGUMENT,`Function ${e$jscomp$0}() needs to be called with an even number of arguments that alternate between field names and values.`);for(s$jscomp$0=0;s$jscomp$0<r.length;s$jscomp$0+=2)n$jscomp$0.push(vu(e$jscomp$0,r[s$jscomp$0])),i.push(r[s$jscomp$0+1]);r=[];e$jscomp$0=Qt.empty();for(s$jscomp$0=
n$jscomp$0.length-1;0<=s$jscomp$0;--s$jscomp$0)if(!Cu(r,n$jscomp$0[s$jscomp$0])){const e=n$jscomp$0[s$jscomp$0];var n=i[s$jscomp$0];n=(0,_util.getModularInstance)(n);const s=t.Bc(e);n instanceof wu?r.push(e):(n=Au(n,s),null!=n&&(r.push(e),e$jscomp$0.set(e,n)))}n$jscomp$0=new gt(r);return new au(e$jscomp$0,n$jscomp$0,t.fieldTransforms)}function Iu(t,e,n,s=!1){return Au(n,t.Qc(s?4:3,e))}function Au(t$jscomp$0,e$jscomp$0){if(bu(t$jscomp$0=(0,_util.getModularInstance)(t$jscomp$0)))return Pu("Unsupported field value:",
e$jscomp$0,t$jscomp$0),Ru(t$jscomp$0,e$jscomp$0);if(t$jscomp$0 instanceof iu)return function(t,e){if(!uu(e.$c))throw e.qc(`${t._methodName}() can only be used with update() and set()`);if(!e.path)throw e.qc(`${t._methodName}() is not currently supported inside arrays`);(t=t._toFieldTransform(e))&&e.fieldTransforms.push(t)}(t$jscomp$0,e$jscomp$0),null;if(void 0===t$jscomp$0&&e$jscomp$0.ignoreUndefinedProperties)return null;if(e$jscomp$0.path&&e$jscomp$0.fieldMask.push(e$jscomp$0.path),t$jscomp$0 instanceof
Array){if(e$jscomp$0.settings.Fc&&4!==e$jscomp$0.$c)throw e$jscomp$0.qc("Nested arrays are not supported");return function(t,e){const n=[];let s=0;for(const i of t)t=Au(i,e.Uc(s)),null==t&&(t={nullValue:"NULL_VALUE"}),n.push(t),s++;return{arrayValue:{values:n}}}(t$jscomp$0,e$jscomp$0)}return function(t,e){if(null===(t=(0,_util.getModularInstance)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return $e(e.k,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};
if(t instanceof Date)return t=at.fromDate(t),{timestampValue:Qn(e.k,t)};if(t instanceof at)return t=new at(t.seconds,1E3*Math.floor(t.nanoseconds/1E3)),{timestampValue:Qn(e.k,t)};if(t instanceof ru)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof su)return{bytesValue:Wn(e.k,t._byteString)};if(t instanceof va){const n=e.databaseId,s=t.firestore._databaseId;if(!s.isEqual(n))throw e.qc(`Document reference is for database ${s.projectId}/${s.database} but should be for database ${n.projectId}/${n.database}`);
return{referenceValue:Hn(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.qc(`Unsupported field value: ${Ea(t)}`);}(t$jscomp$0,e$jscomp$0)}function Ru(t$jscomp$0,e){const n={};return ft(t$jscomp$0)?e.path&&0<e.path.length&&e.fieldMask.push(e.path):lt(t$jscomp$0,(t,s)=>{s=Au(s,e.Mc(t));null!=s&&(n[t]=s)}),{mapValue:{fields:n}}}function bu(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof at||t instanceof ru||t instanceof su||t instanceof va||t instanceof
iu)}function Pu(t,e,n){var JSCompiler_temp;(JSCompiler_temp=!bu(n))||(JSCompiler_temp=!("object"==typeof n&&null!==n&&(Object.getPrototypeOf(n)===Object.prototype||null===Object.getPrototypeOf(n))));if(JSCompiler_temp)throw n=Ea(n),"an object"===n?e.qc(t+" a custom object"):e.qc(t+" "+n);}function vu(t,e,n){if((e=(0,_util.getModularInstance)(e))instanceof eu)return e._internalPath;if("string"==typeof e)return Su(t,e);throw Du("Field path arguments must be of type string or ",t,!1,void 0,n);}function Su(t,
e,n){if(0<=e.search(Vu))throw Du(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return(new eu(...e.split(".")))._internalPath}catch(s){throw Du(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n);}}function Du(t,e,n,s,i){const r=s&&!s.isEmpty(),o=void 0!==i;e=`Function ${e}() called with invalid data`;n&&(e+=" (via `toFirestore()`)");n="";return(r||o)&&(n+=" (found",r&&(n+=` in field ${s}`),
o&&(n+=` in document ${i}`),n+=")"),new Q(j.INVALID_ARGUMENT,e+". "+t+n)}function Cu(t$jscomp$0,e){return t$jscomp$0.some(t=>t.isEqual(e))}function xu(t,e){return"string"==typeof e?Su(t,e):e instanceof eu?e._internalPath:e._delegate._internalPath}function Lu(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return B()}}function Uu(t){if(Te(t)&&0===t.explicitOrderBy.length)throw new Q(j.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause");
}function sh(t$jscomp$0,e$jscomp$0,n$jscomp$1,s$jscomp$0){if(n$jscomp$1[0]=(0,_util.getModularInstance)(n$jscomp$1[0]),n$jscomp$1[0]instanceof Nu)return function(t,e,n$jscomp$0,s,i){if(!s)throw new Q(j.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n$jscomp$0}().`);n$jscomp$0=[];for(const n of Re(t))if(n.field.isKeyField())n$jscomp$0.push(Ft(e,s.key));else{t=s.data.field(n.field);if(Rt(t))throw new Q(j.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+
n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===t)throw e=n.field.canonicalString(),new Q(j.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`);n$jscomp$0.push(t)}return new he(n$jscomp$0,i)}(t$jscomp$0._query,t$jscomp$0.firestore._databaseId,e$jscomp$0,n$jscomp$1[0]._document,s$jscomp$0);const i$jscomp$0=
fu(t$jscomp$0.firestore);return function(t,e,n,s,i,r$jscomp$0){const o=t.explicitOrderBy;if(i.length>o.length)throw new Q(j.INVALID_ARGUMENT,`Too many arguments provided to ${s}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const c=[];for(let r=0;r<i.length;r++){var a=i[r];if(o[r].field.isKeyField()){if("string"!=typeof a)throw new Q(j.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${s}(), but got a ${typeof a}`);if(null===t.collectionGroup&&
-1!==a.indexOf("/"))throw new Q(j.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${s}() must be a plain document ID, but '${a}' contains a slash.`);a=t.path.child(wt.fromString(a));if(!Dt.isDocumentKey(a))throw new Q(j.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${s}() must result in a valid document path, but '${a}' is not because it contains an odd number of segments.`);
a=new Dt(a);c.push(Ft(e,a))}else a=Iu(n,s,a),c.push(a)}return new he(c,r$jscomp$0)}(t$jscomp$0._query,t$jscomp$0.firestore._databaseId,i$jscomp$0,e$jscomp$0,n$jscomp$1,s$jscomp$0)}function ih(t,e,n){if("string"==typeof(n=(0,_util.getModularInstance)(n))){if(""===n)throw new Q(j.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(null===e.collectionGroup&&-1!==n.indexOf("/"))throw new Q(j.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);
e=e.path.child(wt.fromString(n));if(!Dt.isDocumentKey(e))throw new Q(j.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${e}' is not because it has an odd number of segments (${e.length}).`);return Ft(t,new Dt(e))}if(n instanceof va)return Ft(t,n._key);throw new Q(j.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Ea(n)}.`);
}function rh(t,e){if(!Array.isArray(t)||0===t.length)throw new Q(j.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`);if(10<t.length)throw new Q(j.INVALID_ARGUMENT,`Invalid Query. '${e.toString()}' filters support a maximum of 10 elements in the value array.`);}function oh(t,e,n){if(!n.isEqual(e))throw new Q(j.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`);
}function ah(t,e,n){let s;return s=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,s}function lh(t,e){if((t=(0,_util.getModularInstance)(t)).firestore!==e)throw new Q(j.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}function bh(t$jscomp$0,e$jscomp$0){return function(t,e){const n=new W;return t.asyncQueue.enqueueAndForget(()=>$jscomp.asyncExecutePromiseGeneratorFunction(function*(){return hc(yield na(t),e,n)})),n.promise}(qa(t$jscomp$0),
e$jscomp$0)}function Ph(t,e,n){const s=n.docs.get(e._key),i=new dh(t);return new Ou(t,i,e._key,s,new $u(n.hasPendingWrites,n.fromCache),e.converter)}function Fh(t,e){if("string"!=typeof t[e])throw new Q(j.INVALID_ARGUMENT,"Missing string value for: "+e);return t[e]}var process=require("module$node_modules$process$browser");"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports._cast=Ia;exports._debugAssert=function(t,e){t||B()};exports._isBase64Available=function(){return"undefined"!=
typeof atob};exports._logWarn=F;exports._setIndexConfiguration=function(t$jscomp$0,e$jscomp$0){qa(Ia(t$jscomp$0,La));if("string"==typeof e$jscomp$0)try{var JSCompiler_temp=JSON.parse(e$jscomp$0)}catch(t){throw new Q(j.INVALID_ARGUMENT,"Failed to parse JSON:"+t.message);}else JSCompiler_temp=e$jscomp$0;t$jscomp$0=JSCompiler_temp;if(Array.isArray(t$jscomp$0.indexes))for(const t of t$jscomp$0.indexes)if(Fh(t,"collectionGroup"),t$jscomp$0=[],Array.isArray(t.fields))for(const e of t.fields)e$jscomp$0=
Su("setIndexConfiguration",Fh(e,"fieldPath")),"CONTAINS"===e.arrayConfig?t$jscomp$0.push(new Oh(e$jscomp$0,2)):"ASCENDING"===e.order?t$jscomp$0.push(new Oh(e$jscomp$0,0)):"DESCENDING"===e.order&&t$jscomp$0.push(new Oh(e$jscomp$0,1));return Promise.resolve()};exports._validateIsNotUsedTogether=ya;exports.addDoc=function(t,e){const n=Ia(t.firestore,La),s=Na(t);e=ah(t.converter,e);return bh(n,[du(fu(t.firestore),"addDoc",s._key,e,null!==t.converter,{}).toMutation(s._key,Ye.exists(!1))]).then(()=>s)};
exports.arrayRemove=function(...t){return new yu("arrayRemove",t)};exports.arrayUnion=function(...t){return new gu("arrayUnion",t)};exports.clearIndexedDbPersistence=function(t$jscomp$0){if(t$jscomp$0._initialized&&!t$jscomp$0._terminated)throw new Q(j.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new W;return t$jscomp$0._queue.enqueueAndForgetEvenWhileRestricted(()=>$jscomp.asyncExecutePromiseGeneratorFunction(function*(){try{yield function(t){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){if(!Js.Pt())return Promise.resolve();
yield Js.delete(t+"main")})}(cr(t$jscomp$0._databaseId,t$jscomp$0._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise};exports.collection=function(t,e,...n){if(t=(0,_util.getModularInstance)(t),ga("collection","path",e),t instanceof ba)return e=wt.fromString(e,...n),Ta(e),new Sa(t,null,e);if(!(t instanceof va||t instanceof Sa))throw new Q(j.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");e=t._path.child(wt.fromString(e,
...n));return Ta(e),new Sa(t.firestore,null,e)};exports.collectionGroup=function(t,e){if(t=Ia(t,ba),ga("collectionGroup","collection id",e),0<=e.indexOf("/"))throw new Q(j.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);e=new me(wt.emptyPath(),e);return new Va(t,null,e)};exports.connectFirestoreEmulator=function(t,e,n,s={}){var i;const r=(t=Ia(t,ba))._getSettings();if("firestore.googleapis.com"!==r.host&&r.host!==e&&F("Host has been set in both settings() and useEmulator(), emulator host will be used"),
t._setSettings(Object.assign(Object.assign({},r),{host:`${e}:${n}`,ssl:!1})),s.mockUserToken){if("string"==typeof s.mockUserToken)e=s.mockUserToken,s=C.MOCK_USER;else{e=(0,_util.createMockUserToken)(s.mockUserToken,null===(i=t._app)||void 0===i?void 0:i.options.projectId);s=s.mockUserToken.sub||s.mockUserToken.user_id;if(!s)throw new Q(j.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");s=new C(s)}t._authCredentials=new H(new G(e,s))}};exports.deleteDoc=function(t){return bh(Ia(t.firestore,
La),[new ln(t._key,Ye.none())])};exports.deleteField=function(){return new wu("deleteField")};exports.disableNetwork=function(t){return ra(qa(Ia(t,La)))};exports.doc=Na;exports.documentId=function(){return new eu("__name__")};exports.enableIndexedDbPersistence=function(t,e){tu(t=Ia(t,La));const n=qa(t);t=t._freezeSettings();const i=new qc;return Wa(n,i,new Bc(i,t.cacheSizeBytes,null==e?void 0:e.forceOwnership))};exports.enableMultiTabIndexedDbPersistence=function(t){tu(t=Ia(t,La));const e=qa(t);t=
t._freezeSettings();const s=new qc;return Wa(e,s,new Uc(s,t.cacheSizeBytes))};exports.enableNetwork=function(t){return ia(qa(Ia(t,La)))};exports.endAt=function(...t){return new th("endAt",t,!1)};exports.endBefore=function(...t){return new th("endBefore",t,!0)};exports.ensureFirestoreConfigured=qa;exports.executeWrite=bh;exports.getDoc=function(t){t=Ia(t,va);const e=Ia(t.firestore,La);return ca(qa(e),t._key).then(n=>Ph(e,t,n))};exports.getDocFromCache=function(t){t=Ia(t,va);const e=Ia(t.firestore,
La),n$jscomp$0=qa(e),s=new dh(e);return oa(n$jscomp$0,t._key).then(n=>new Ou(e,s,t._key,n,new $u(null!==n&&n.hasLocalMutations,!0),t.converter))};exports.getDocFromServer=function(t){t=Ia(t,va);const e=Ia(t.firestore,La);return ca(qa(e),t._key,{source:"server"}).then(n=>Ph(e,t,n))};exports.getDocs=function(t){t=Ia(t,Va);const e=Ia(t.firestore,La),n$jscomp$0=qa(e),s=new dh(e);return Uu(t._query),ua(n$jscomp$0,t._query).then(n=>new Fu(e,s,t,n))};exports.getDocsFromCache=function(t){t=Ia(t,Va);const e=
Ia(t.firestore,La),n$jscomp$0=qa(e),s=new dh(e);return aa(n$jscomp$0,t._query).then(n=>new Fu(e,s,t,n))};exports.getDocsFromServer=function(t){t=Ia(t,Va);const e=Ia(t.firestore,La),n$jscomp$0=qa(e),s=new dh(e);return ua(n$jscomp$0,t._query,{source:"server"}).then(n=>new Fu(e,s,t,n))};exports.getFirestore=function(e=(0,_app.getApp)()){return(0,_app._getProvider)(e,"firestore").getImmediate()};exports.increment=function(t){return new pu("increment",t)};exports.initializeFirestore=function(t,e){var n=
(0,_app._getProvider)(t,"firestore");if(n.isInitialized()){t=n.getImmediate();n=n.getOptions();if((0,_util.deepEqual)(n,e))return t;throw new Q(j.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.");}if(void 0!==e.cacheSizeBytes&&-1!==e.cacheSizeBytes&&1048576>e.cacheSizeBytes)throw new Q(j.INVALID_ARGUMENT,
"cacheSizeBytes must be at least 1048576");return n.initialize({options:e})};exports.limit=function(t){return Aa("limit",t),new zu("limit",t,"F")};exports.limitToLast=function(t){return Aa("limitToLast",t),new zu("limitToLast",t,"L")};exports.loadBundle=function(t,e){const n=qa(t=Ia(t,La)),s=new Ma;return fa(n,t._databaseId,e,s),s};exports.namedQuery=function(t,e$jscomp$0){return da(qa(t=Ia(t,La)),e$jscomp$0).then(e=>e?new Va(t,null,e.query):null)};exports.onSnapshot=function(t$jscomp$0,...e$jscomp$0){var n$jscomp$0,
s$jscomp$0,i$jscomp$0;t$jscomp$0=(0,_util.getModularInstance)(t$jscomp$0);var r$jscomp$0={includeMetadataChanges:!1};let o=0;"object"!=typeof e$jscomp$0[o]||Oa(e$jscomp$0[o])||(r$jscomp$0=e$jscomp$0[o],o++);r$jscomp$0={includeMetadataChanges:r$jscomp$0.includeMetadataChanges};if(Oa(e$jscomp$0[o])){const t=e$jscomp$0[o];e$jscomp$0[o]=null===(n$jscomp$0=t.next)||void 0===n$jscomp$0?void 0:n$jscomp$0.bind(t);e$jscomp$0[o+1]=null===(s$jscomp$0=t.error)||void 0===s$jscomp$0?void 0:s$jscomp$0.bind(t);e$jscomp$0[o+
2]=null===(i$jscomp$0=t.complete)||void 0===i$jscomp$0?void 0:i$jscomp$0.bind(t)}let u;if(t$jscomp$0 instanceof va)u=Ia(t$jscomp$0.firestore,La),s$jscomp$0=new me(t$jscomp$0._key.path),n$jscomp$0={next:n=>{e$jscomp$0[o]&&e$jscomp$0[o](Ph(u,t$jscomp$0,n))},error:e$jscomp$0[o+1],complete:e$jscomp$0[o+2]};else{const n=Ia(t$jscomp$0,Va);u=Ia(n.firestore,La);s$jscomp$0=n._query;const s=new dh(u);n$jscomp$0={next:t=>{e$jscomp$0[o]&&e$jscomp$0[o](new Fu(u,s,n,t))},error:e$jscomp$0[o+1],complete:e$jscomp$0[o+
2]};Uu(t$jscomp$0._query)}return function(t,e,n,s){const i=new jc(s),r=new Jo(e,i,n);return t.asyncQueue.enqueueAndForget(()=>$jscomp.asyncExecutePromiseGeneratorFunction(function*(){return Qo(yield sa(t),r)})),()=>{i.nc();t.asyncQueue.enqueueAndForget(()=>$jscomp.asyncExecutePromiseGeneratorFunction(function*(){return Wo(yield sa(t),r)}))}}(qa(u),s$jscomp$0,r$jscomp$0,n$jscomp$0)};exports.onSnapshotsInSync=function(t,e){return ha(qa(Ia(t,La)),Oa(e)?e:{next:e})};exports.orderBy=function(t,e="asc"){t=
xu("orderBy",t);return new Wu(t,e)};exports.query=function(t,...e){for(const n of e)t=n._apply(t);return t};exports.queryEqual=xa;exports.refEqual=function(t,e){return t=(0,_util.getModularInstance)(t),e=(0,_util.getModularInstance)(e),(t instanceof va||t instanceof Sa)&&(e instanceof va||e instanceof Sa)&&t.firestore===e.firestore&&t.path===e.path&&t.converter===e.converter};exports.runTransaction=function(t,e){return la(qa(t=Ia(t,La)),n=>e(new vh(t,n)))};exports.serverTimestamp=function(){return new mu("serverTimestamp")};
exports.setDoc=function(t,e,n){t=Ia(t,va);const s=Ia(t.firestore,La);e=ah(t.converter,e,n);return bh(s,[du(fu(s),"setDoc",t._key,e,null!==t.converter,n).toMutation(t._key,Ye.none())])};exports.setLogLevel=function(t){k.setLogLevel(t)};exports.snapshotEqual=function(t,e){return t instanceof Ou&&e instanceof Ou?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(null===t._document?null===e._document:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof Fu&&e instanceof Fu&&t._firestore===
e._firestore&&xa(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot)};exports.startAfter=function(...t){return new Yu("startAfter",t,!1)};exports.startAt=function(...t){return new Yu("startAt",t,!0)};exports.terminate=function(t){return(0,_app._removeServiceInstance)(t.app,"firestore"),t._delete()};exports.updateDoc=function(t,e,n,...s){t=Ia(t,va);const i=Ia(t.firestore,La),r=fu(i);let o;o="string"==typeof(e=(0,_util.getModularInstance)(e))||e instanceof eu?Eu(r,"updateDoc",
t._key,e,n,s):Tu(r,"updateDoc",t._key,e);return bh(i,[o.toMutation(t._key,Ye.exists(!0))])};exports.waitForPendingWrites=function(t$jscomp$0){return function(t){const e=new W;return t.asyncQueue.enqueueAndForget(()=>$jscomp.asyncExecutePromiseGeneratorFunction(function*(){return mc(yield na(t),e)})),e.promise}(qa(t$jscomp$0=Ia(t$jscomp$0,La)))};exports.where=function(t,e,n){t=xu("where",t);return new ju(t,e,n)};exports.writeBatch=function(t){return qa(t=Ia(t,La)),new hh(t,e=>bh(t,e))};exports._FieldPath=
exports._EmptyAuthCredentialsProvider=exports._EmptyAppCheckTokenProvider=exports._DocumentKey=exports._DatabaseId=exports.WriteBatch=exports.Transaction=exports.Timestamp=exports.SnapshotMetadata=exports.QuerySnapshot=exports.QueryDocumentSnapshot=exports.QueryConstraint=exports.Query=exports.LoadBundleTask=exports.GeoPoint=exports.FirestoreError=exports.Firestore=exports.FieldValue=exports.FieldPath=exports.DocumentSnapshot=exports.DocumentReference=exports.CollectionReference=exports.CACHE_SIZE_UNLIMITED=
exports.Bytes=exports.AbstractUserDataWriter=void 0;var _app=require("module$node_modules$$firebase$app$dist$esm$index_esm2017"),_component=require("module$node_modules$$firebase$component$dist$esm$index_esm2017"),_logger=require("module$node_modules$$firebase$logger$dist$index_cjs"),_util=require("module$node_modules$$firebase$util$dist$index_esm2017"),_webchannelWrapper=require("module$node_modules$$firebase$webchannel_wrapper$dist$index");class C{constructor(t){this.uid=t}isAuthenticated(){return null!=
this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}C.UNAUTHENTICATED=new C(null);C.GOOGLE_CREDENTIALS=new C("google-credentials-uid");C.FIRST_PARTY=new C("first-party-uid");C.MOCK_USER=new C("mock-user");let N="9.6.5";const k=new _logger.Logger("@firebase/firestore"),j={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",
PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Q extends _util.FirebaseError{constructor(t,e){super(t,e);this.code=t;this.message=e;this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}exports.FirestoreError=Q;class W{constructor(){this.promise=
new Promise((t,e)=>{this.resolve=t;this.reject=e})}}class G{constructor(t,e){this.user=e;this.type="OAuth";this.headers=new Map;this.headers.set("Authorization",`Bearer ${t}`)}}class z{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable(()=>e(C.UNAUTHENTICATED))}shutdown(){}}exports._EmptyAuthCredentialsProvider=z;class H{constructor(t){this.token=t;this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=
e;t.enqueueRetryable(()=>e(this.token.user))}shutdown(){this.changeListener=null}}class J{constructor(t){this.t=t;this.currentUser=C.UNAUTHENTICATED;this.i=0;this.forceRefresh=!1;this.auth=null}start(t$jscomp$0,e$jscomp$0){let n=this.i;const s=t=>this.i!==n?(n=this.i,e$jscomp$0(t)):Promise.resolve();let i=new W;this.o=()=>{this.i++;this.currentUser=this.u();i.resolve();i=new W;t$jscomp$0.enqueueRetryable(()=>s(this.currentUser))};const r=()=>{const e=i;t$jscomp$0.enqueueRetryable(()=>{const $jscomp$async$this=
this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){yield e.promise;yield s($jscomp$async$this.currentUser)})})},o=t=>{O("FirebaseAuthCredentialsProvider","Auth detected");this.auth=t;this.auth.addAuthTokenListener(this.o);r()};this.t.onInit(t=>o(t));setTimeout(()=>{if(!this.auth){const t=this.t.getImmediate({optional:!0});t?o(t):(O("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new W)}},0);r()}getToken(){const t=this.i,e$jscomp$0=this.forceRefresh;return this.forceRefresh=
!1,this.auth?this.auth.getToken(e$jscomp$0).then(e=>{this.i!==t?e=(O("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?("string"==typeof e.accessToken||B(),e=new G(e.accessToken,this.currentUser)):e=null;return e}):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const t=this.auth&&this.auth.getUid();null===t||"string"==typeof t||B();return new C(t)}}class Y{constructor(t,e,
n){this.type="FirstParty";this.user=C.FIRST_PARTY;this.headers=new Map;this.headers.set("X-Goog-AuthUser",e);(t=t.auth.getAuthHeaderValueForFirstParty([]))&&this.headers.set("Authorization",t);n&&this.headers.set("X-Goog-Iam-Authorization-Token",n)}}class X{constructor(t,e,n){this.h=t;this.l=e;this.m=n}getToken(){return Promise.resolve(new Y(this.h,this.l,this.m))}start(t,e){t.enqueueRetryable(()=>e(C.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Z{constructor(t){this.value=t;this.type="AppCheck";
this.headers=new Map;t&&0<t.length&&this.headers.set("x-firebase-appcheck",this.value)}}class tt{constructor(t){this.g=t;this.forceRefresh=!1;this.appCheck=null}start(t$jscomp$0,e){this.o=n=>{t$jscomp$0.enqueueRetryable(()=>(null!=n.error&&O("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${n.error.message}`),e(n.token)))};const n$jscomp$0=t=>{O("FirebaseAppCheckTokenProvider","AppCheck detected");this.appCheck=t;this.appCheck.addTokenListener(this.o)};
this.g.onInit(t=>n$jscomp$0(t));setTimeout(()=>{if(!this.appCheck){const t=this.g.getImmediate({optional:!0});t?n$jscomp$0(t):O("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const t$jscomp$0=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t$jscomp$0).then(t=>{t?("string"==typeof t.token||B(),t=new Z(t.token)):t=null;return t}):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}
class et{getToken(){return Promise.resolve(new Z(""))}invalidateToken(){}start(t,e){}shutdown(){}}exports._EmptyAppCheckTokenProvider=et;class nt{constructor(t$jscomp$0,e){this.previousValue=t$jscomp$0;e&&(e.sequenceNumberHandler=t=>this.p(t),this.T=t=>e.writeSequenceNumber(t))}p(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.T&&this.T(t),t}}nt.I=-1;class it{static A(){const e=62*Math.floor(256/62);let n="";for(;20>n.length;){var e$jscomp$0=
"undefined"!=typeof self&&(self.crypto||self.msCrypto),n$jscomp$0=new Uint8Array(40);if(e$jscomp$0&&"function"==typeof e$jscomp$0.getRandomValues)e$jscomp$0.getRandomValues(n$jscomp$0);else for(e$jscomp$0=0;40>e$jscomp$0;e$jscomp$0++)n$jscomp$0[e$jscomp$0]=Math.floor(256*Math.random());for(e$jscomp$0=0;e$jscomp$0<n$jscomp$0.length;++e$jscomp$0)20>n.length&&n$jscomp$0[e$jscomp$0]<e&&(n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n$jscomp$0[e$jscomp$0]%62))}return n}}class at{constructor(t,
e){if(this.seconds=t,this.nanoseconds=e,0>e)throw new Q(j.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(1E9<=e)throw new Q(j.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(-62135596800>t)throw new Q(j.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(253402300800<=t)throw new Q(j.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);}static now(){return at.fromMillis(Date.now())}static fromDate(t){return at.fromMillis(t.getTime())}static fromMillis(t){const e=
Math.floor(t/1E3);return new at(e,Math.floor(1E6*(t-1E3*e)))}toDate(){return new Date(this.toMillis())}toMillis(){return 1E3*this.seconds+this.nanoseconds/1E6}_compareTo(t){return this.seconds===t.seconds?rt(this.nanoseconds,t.nanoseconds):rt(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds\x3d"+this.seconds+", nanoseconds\x3d"+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds-
-62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}exports.Timestamp=at;class ut{constructor(t){this.timestamp=t}static fromTimestamp(t){return new ut(t)}static min(){return new ut(new at(0,0))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1E6*this.timestamp.seconds+this.timestamp.nanoseconds/1E3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}
class dt{constructor(t,e,n){void 0===e?e=0:e>t.length&&B();void 0===n?n=t.length-e:n>t.length-e&&B();this.segments=t;this.offset=e;this.len=n}get length(){return this.len}isEqual(t){return 0===dt.comparator(this,t)}child(t$jscomp$0){const e=this.segments.slice(this.offset,this.limit());return t$jscomp$0 instanceof dt?t$jscomp$0.forEach(t=>{e.push(t)}):e.push(t$jscomp$0),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+
t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;
return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n$jscomp$0=Math.min(t.length,e.length);for(let s=0;s<n$jscomp$0;s++){const n=t.get(s),i=e.get(s);if(n<i)return-1;if(n>i)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class wt extends dt{construct(t,e,n){return new wt(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...t$jscomp$0){const e=
[];for(const n of t$jscomp$0){if(0<=n.indexOf("//"))throw new Q(j.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter(t=>0<t.length))}return new wt(e)}static emptyPath(){return new wt([])}}const _t=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class mt extends dt{construct(t,e,n){return new mt(t,e,n)}static isValidIdentifier(t){return _t.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),mt.isValidIdentifier(t)||
(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new mt(["__name__"])}static fromServerFormat(t){const e=[];let n="",s=0;const i=()=>{if(0===n.length)throw new Q(j.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n);n=""};let r=!1;for(;s<t.length;){var e$jscomp$0=t[s];if("\\"===e$jscomp$0){if(s+1===t.length)throw new Q(j.INVALID_ARGUMENT,
"Path has trailing escape character: "+t);e$jscomp$0=t[s+1];if("\\"!==e$jscomp$0&&"."!==e$jscomp$0&&"`"!==e$jscomp$0)throw new Q(j.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=e$jscomp$0;s+=2}else"`"===e$jscomp$0?(r=!r,s++):"."!==e$jscomp$0||r?(n+=e$jscomp$0,s++):(i(),s++)}if(i(),r)throw new Q(j.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new mt(e)}static emptyPath(){return new mt([])}}exports._FieldPath=mt;class gt{constructor(t){this.fields=t;t.sort(mt.comparator)}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;
return!1}isEqual(t$jscomp$0){return ot(this.fields,t$jscomp$0.fields,(t,e)=>t.isEqual(e))}}class pt{constructor(t){this.binaryString=t}static fromBase64String(t){t=atob(t);return new pt(t)}static fromUint8Array(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return new pt(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return t=this.binaryString,btoa(t);var t}toUint8Array(){var t=
this.binaryString;const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return rt(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}pt.EMPTY_BYTE_STRING=new pt("");const Tt=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);class Dt{constructor(t){this.path=t}static fromPath(t){return new Dt(wt.fromString(t))}static fromName(t){return new Dt(wt.fromString(t).popFirst(5))}hasCollectionId(t){return 2<=
this.path.length&&this.path.get(this.path.length-2)===t}isEqual(t){return null!==t&&0===wt.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return wt.comparator(t.path,e.path)}static isDocumentKey(t){return 0==t.length%2}static fromSegments(t){return new Dt(new wt(t.slice()))}}exports._DocumentKey=Dt;class Qt{constructor(t){this.value=t}static empty(){return new Qt({mapValue:{}})}field(t){if(t.isEmpty())return this.value;let e=this.value;for(let n=0;n<t.length-
1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!Kt(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=jt(e)}setAll(t$jscomp$1){let e=mt.emptyPath(),n={},s=[];t$jscomp$1.forEach((t$jscomp$0,i)=>{if(!e.isImmediateParentOf(i)){const t=this.getFieldsMap(e);this.applyChanges(t,n,s);n={};s=[];e=i.popLast()}t$jscomp$0?n[i.lastSegment()]=jt(t$jscomp$0):s.push(i.lastSegment())});t$jscomp$1=this.getFieldsMap(e);this.applyChanges(t$jscomp$1,
n,s)}delete(t){const e=this.field(t.popLast());Kt(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return Nt(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let s=e.mapValue.fields[t.get(n)];Kt(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=s);e=s}return e.mapValue.fields}applyChanges(t,e$jscomp$0,n$jscomp$0){lt(e$jscomp$0,(e,n)=>t[e]=n);for(const e of n$jscomp$0)delete t[e]}clone(){return new Qt(jt(this.value))}}
class Gt{constructor(t,e,n,s,i){this.key=t;this.documentType=e;this.version=n;this.data=s;this.documentState=i}static newInvalidDocument(t){return new Gt(t,0,ut.min(),Qt.empty(),0)}static newFoundDocument(t,e,n){return new Gt(t,1,e,n,0)}static newNoDocument(t,e){return new Gt(t,2,e,Qt.empty(),0)}static newUnknownDocument(t,e){return new Gt(t,3,e,Qt.empty(),2)}convertToFoundDocument(t,e){return this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=
t,this.documentType=2,this.data=Qt.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=Qt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==
this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(t){return t instanceof Gt&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new Gt(this.key,this.documentType,this.version,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}
class zt{constructor(t,e=null,n=[],s=[],i=null,r=null,o=null){this.path=t;this.collectionGroup=e;this.orderBy=n;this.filters=s;this.limit=i;this.startAt=r;this.endAt=o;this.R=null}}class te extends class{}{constructor(t,e,n){super();this.field=t;this.op=e;this.value=n}static create(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.P(t,e,n):new ne(t,e,n):"array-contains"===e?new oe(t,n):"in"===e?new ce(t,n):"not-in"===e?new ae(t,n):"array-contains-any"===e?new ue(t,n):new te(t,e,n)}static P(t,
e,n){return"in"===e?new se(t,n):new ie(t,n)}matches(t){t=t.data.field(this.field);return"!\x3d"===this.op?null!==t&&this.v(xt(t,this.value)):null!==t&&Ct(this.value)===Ct(t)&&this.v(xt(t,this.value))}v(t){switch(this.op){case "\x3c":return 0>t;case "\x3c\x3d":return 0>=t;case "\x3d\x3d":return 0===t;case "!\x3d":return 0!==t;case "\x3e":return 0<t;case "\x3e\x3d":return 0<=t;default:return B()}}V(){return 0<="\x3c \x3c\x3d \x3e \x3e\x3d !\x3d not-in".split(" ").indexOf(this.op)}}class ne extends te{constructor(t,
e,n){super(t,e,n);this.key=Dt.fromName(n.referenceValue)}matches(t){t=Dt.comparator(t.key,this.key);return this.v(t)}}class se extends te{constructor(t,e){super(t,"in",e);this.keys=re("in",e)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}}class ie extends te{constructor(t,e){super(t,"not-in",e);this.keys=re("not-in",e)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}}class oe extends te{constructor(t,e){super(t,"array-contains",e)}matches(t){t=t.data.field(this.field);return Bt(t)&&
kt(t.arrayValue,this.value)}}class ce extends te{constructor(t,e){super(t,"in",e)}matches(t){t=t.data.field(this.field);return null!==t&&kt(this.value.arrayValue,t)}}class ae extends te{constructor(t,e){super(t,"not-in",e)}matches(t){if(kt(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;t=t.data.field(this.field);return null!==t&&!kt(this.value.arrayValue,t)}}class ue extends te{constructor(t,e){super(t,"array-contains-any",e)}matches(t$jscomp$0){t$jscomp$0=t$jscomp$0.data.field(this.field);
return!(!Bt(t$jscomp$0)||!t$jscomp$0.arrayValue.values)&&t$jscomp$0.arrayValue.values.some(t=>kt(this.value.arrayValue,t))}}class he{constructor(t,e){this.position=t;this.before=e}}class fe{constructor(t,e="asc"){this.field=t;this.dir=e}}class me{constructor(t,e=null,n=[],s=[],i=null,r="F",o=null,c=null){this.path=t;this.collectionGroup=e;this.explicitOrderBy=n;this.filters=s;this.limit=i;this.limitType=r;this.startAt=o;this.endAt=c;this.D=this.S=null;this.startAt;this.endAt}}class Oe{constructor(){this._=
void 0}}class Be extends Oe{}class Ue extends Oe{constructor(t){super();this.elements=t}}class Ke extends Oe{constructor(t){super();this.elements=t}}class Qe extends Oe{constructor(t,e){super();this.k=t;this.N=e}}class ze{constructor(t,e){this.field=t;this.transform=e}}class Je{constructor(t,e){this.version=t;this.transformResults=e}}class Ye{constructor(t,e){this.updateTime=t;this.exists=e}static none(){return new Ye}static exists(t){return new Ye(void 0,t)}static updateTime(t){return new Ye(t)}get isNone(){return void 0===
this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}class Ze{}class on extends Ze{constructor(t,e,n,s=[]){super();this.key=t;this.value=e;this.precondition=n;this.fieldTransforms=s;this.type=0}}class cn extends Ze{constructor(t,e,n,s,i=[]){super();this.key=t;this.data=e;this.fieldMask=n;this.precondition=s;this.fieldTransforms=i;this.type=1}}class ln extends Ze{constructor(t,e){super();
this.key=t;this.precondition=e;this.type=2;this.fieldTransforms=[]}}class fn extends Ze{constructor(t,e){super();this.key=t;this.precondition=e;this.type=3;this.fieldTransforms=[]}}class dn{constructor(t){this.count=t}}var wn,_n;(_n=wn||(wn={}))[_n.OK=0]="OK";_n[_n.CANCELLED=1]="CANCELLED";_n[_n.UNKNOWN=2]="UNKNOWN";_n[_n.INVALID_ARGUMENT=3]="INVALID_ARGUMENT";_n[_n.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED";_n[_n.NOT_FOUND=5]="NOT_FOUND";_n[_n.ALREADY_EXISTS=6]="ALREADY_EXISTS";_n[_n.PERMISSION_DENIED=
7]="PERMISSION_DENIED";_n[_n.UNAUTHENTICATED=16]="UNAUTHENTICATED";_n[_n.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED";_n[_n.FAILED_PRECONDITION=9]="FAILED_PRECONDITION";_n[_n.ABORTED=10]="ABORTED";_n[_n.OUT_OF_RANGE=11]="OUT_OF_RANGE";_n[_n.UNIMPLEMENTED=12]="UNIMPLEMENTED";_n[_n.INTERNAL=13]="INTERNAL";_n[_n.UNAVAILABLE=14]="UNAVAILABLE";_n[_n.DATA_LOSS=15]="DATA_LOSS";class yn{constructor(t,e){this.comparator=t;this.root=e||Tn.EMPTY}insert(t,e){return new yn(this.comparator,this.root.insert(t,e,this.comparator).copy(null,
null,Tn.BLACK,null,null))}remove(t){return new yn(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Tn.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(0===n)return e.value;0>n?e=e.left:0<n&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const s=this.comparator(t,n.key);if(0===s)return e+n.left.size;0>s?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((e,
n)=>(t(e,n),!1))}toString(){const t=[];return this.inorderTraversal((e,n)=>(t.push(`${e}:${n}`),!1)),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new pn(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new pn(this.root,t,this.comparator,!1)}getReverseIterator(){return new pn(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new pn(this.root,t,this.comparator,!0)}}class pn{constructor(t,e,n,s){this.isReverse=s;this.nodeStack=
[];let i=1;for(;!t.isEmpty();)if(i=e?n(t.key,e):1,s&&(i*=-1),0>i)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t);t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return 0<this.nodeStack.length}peek(){if(0===this.nodeStack.length)return null;
const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class Tn{constructor(t,e,n,s,i){this.key=t;this.value=e;this.color=null!=n?n:Tn.RED;this.left=null!=s?s:Tn.EMPTY;this.right=null!=i?i:Tn.EMPTY;this.size=this.left.size+1+this.right.size}copy(t,e,n,s,i){return new Tn(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=s?s:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||
this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let s=this;const i=n(t,s.key);return s=0>i?s.copy(null,null,null,s.left.insert(t,e,n),null):0===i?s.copy(null,e,null,null,null):s.copy(null,null,null,null,s.right.insert(t,e,n)),s.fixUp()}removeMin(){if(this.left.isEmpty())return Tn.EMPTY;
let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,s=this;if(0>e(t,s.key))s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,e),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),0===e(t,s.key)){if(s.right.isEmpty())return Tn.EMPTY;n=s.right.min();s=s.copy(n.key,
n.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,e))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();
return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,Tn.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,Tn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=
this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw B();if(this.right.isRed())throw B();const t=this.left.check();if(t!==this.right.check())throw B();return t+(this.isRed()?0:1)}}Tn.EMPTY=null;Tn.RED=!0;Tn.BLACK=!1;Tn.EMPTY=new class{constructor(){this.size=0}get key(){throw B();}get value(){throw B();}get color(){throw B();}get left(){throw B();}get right(){throw B();}copy(t,e,n,s,i){return this}insert(t,e,n){return new Tn(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};
class En{constructor(t){this.comparator=t;this.data=new yn(this.comparator)}has(t){return null!==this.data.get(t)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((e,n)=>(t(e),!1))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const s=n.getNext();if(0<=this.comparator(s.key,t[1]))break;e(s.key)}}forEachWhile(t,e){for(e=void 0!==e?this.data.getIteratorFrom(e):
this.data.getIterator();e.hasNext()&&t(e.getNext().key););}firstAfterOrEqual(t){t=this.data.getIteratorFrom(t);return t.hasNext()?t.getNext().key:null}getIterator(){return new In(this.data.getIterator())}getIteratorFrom(t){return new In(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t$jscomp$0){let e=this;return e.size<t$jscomp$0.size&&(e=t$jscomp$0,
t$jscomp$0=this),t$jscomp$0.forEach(t=>{e=e.add(t)}),e}isEqual(t$jscomp$0){if(!(t$jscomp$0 instanceof En)||this.size!==t$jscomp$0.size)return!1;const e=this.data.getIterator();for(t$jscomp$0=t$jscomp$0.data.getIterator();e.hasNext();){const t=e.getNext().key,s=t$jscomp$0.getNext().key;if(0!==this.comparator(t,s))return!1}return!0}toArray(){const t=[];return this.forEach(e=>{t.push(e)}),t}toString(){const t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(t){const e=new En(this.comparator);
return e.data=t,e}}class In{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}const An=new yn(Dt.comparator),bn=new yn(Dt.comparator),vn=new yn(Dt.comparator),Sn=new En(Dt.comparator),Cn=new En(rt);class kn{constructor(t,e,n,s,i){this.snapshotVersion=t;this.targetChanges=e;this.targetMismatches=n;this.documentUpdates=s;this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(t,e){const n=new Map;return n.set(t,xn.createSynthesizedTargetChangeForCurrentChange(t,
e)),new kn(ut.min(),n,Cn,An,Dn())}}class xn{constructor(t,e,n,s,i){this.resumeToken=t;this.current=e;this.addedDocuments=n;this.modifiedDocuments=s;this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(t,e){return new xn(pt.EMPTY_BYTE_STRING,e,Dn(),Dn(),Dn())}}class $n{constructor(t,e,n,s){this.$=t;this.removedTargetIds=e;this.key=n;this.O=s}}class On{constructor(t,e){this.targetId=t;this.M=e}}class Mn{constructor(t,e,n=pt.EMPTY_BYTE_STRING,s=null){this.state=t;this.targetIds=
e;this.resumeToken=n;this.cause=s}}class Fn{constructor(){this.F=0;this.L=new yn(Dt.comparator);this.B=pt.EMPTY_BYTE_STRING;this.U=!1;this.q=!0}get current(){return this.U}get resumeToken(){return this.B}get K(){return 0!==this.F}get j(){return this.q}W(t){0<t.approximateByteSize()&&(this.q=!0,this.B=t)}G(){let t=Dn(),e=Dn(),n=Dn();return this.L.forEach((s,i)=>{switch(i){case 0:t=t.add(s);break;case 2:e=e.add(s);break;case 1:n=n.add(s);break;default:B()}}),new xn(this.B,this.U,t,e,n)}H(){this.q=!1;
this.L=new yn(Dt.comparator)}J(t,e){this.q=!0;this.L=this.L.insert(t,e)}Y(t){this.q=!0;this.L=this.L.remove(t)}X(){this.F+=1}Z(){--this.F}tt(){this.U=this.q=!0}}class Ln{constructor(t){this.et=t;this.nt=new Map;this.st=An;this.it=new yn(Dt.comparator);this.rt=new En(rt)}ot(t){for(const e of t.$)t.O&&t.O.isFoundDocument()?this.ct(e,t.O):this.at(e,t.key,t.O);for(const e of t.removedTargetIds)this.at(e,t.key,t.O)}ut(t){this.forEachTarget(t,e=>{const n=this.ht(e);switch(t.state){case 0:this.lt(e)&&n.W(t.resumeToken);
break;case 1:n.Z();n.K||n.H();n.W(t.resumeToken);break;case 2:n.Z();n.K||this.removeTarget(e);break;case 3:this.lt(e)&&(n.tt(),n.W(t.resumeToken));break;case 4:this.lt(e)&&(this.ft(e),n.W(t.resumeToken));break;default:B()}})}forEachTarget(t$jscomp$0,e){0<t$jscomp$0.targetIds.length?t$jscomp$0.targetIds.forEach(e):this.nt.forEach((t,n)=>{this.lt(n)&&e(n)})}dt(t){const e=t.targetId;t=t.M.count;var s=this.wt(e);s&&(s=s.target,Zt(s)?0===t?(t=new Dt(s.path),this.at(e,t,Gt.newNoDocument(t,ut.min()))):1===
t||B():this._t(e)!==t&&(this.ft(e),this.rt=this.rt.add(e)))}gt(t$jscomp$1){const e$jscomp$0=new Map;this.nt.forEach((n,s)=>{var i=this.wt(s);i&&(n.current&&Zt(i.target)&&(i=new Dt(i.target.path),null!==this.st.get(i)||this.yt(s,i)||this.at(s,i,Gt.newNoDocument(i,t$jscomp$1))),n.j&&(e$jscomp$0.set(s,n.G()),n.H()))});let n$jscomp$0=Dn();this.it.forEach((t$jscomp$0,e)=>{let s=!0;e.forEachWhile(t=>{t=this.wt(t);return!t||2===t.purpose||(s=!1,!1)});s&&(n$jscomp$0=n$jscomp$0.add(t$jscomp$0))});const s$jscomp$0=
new kn(t$jscomp$1,e$jscomp$0,this.rt,this.st,n$jscomp$0);return this.st=An,this.it=new yn(Dt.comparator),this.rt=new En(rt),s$jscomp$0}ct(t,e){if(this.lt(t)){var n=this.yt(t,e.key)?2:0;this.ht(t).J(e.key,n);this.st=this.st.insert(e.key,e);this.it=this.it.insert(e.key,this.Tt(e.key).add(t))}}at(t,e,n){if(this.lt(t)){var s=this.ht(t);this.yt(t,e)?s.J(e,1):s.Y(e);this.it=this.it.insert(e,this.Tt(e).delete(t));n&&(this.st=this.st.insert(e,n))}}removeTarget(t){this.nt.delete(t)}_t(t){const e=this.ht(t).G();
return this.et.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}X(t){this.ht(t).X()}ht(t){let e=this.nt.get(t);return e||(e=new Fn,this.nt.set(t,e)),e}Tt(t){let e=this.it.get(t);return e||(e=new En(rt),this.it=this.it.insert(t,e)),e}lt(t){const e=null!==this.wt(t);return e||O("WatchChangeAggregator","Detected inactive target",t),e}wt(t){const e=this.nt.get(t);return e&&e.K?null:this.et.Et(t)}ft(t){this.nt.set(t,new Fn);this.et.getRemoteKeysForTarget(t).forEach(e=>{this.at(t,
e,null)})}yt(t,e){return this.et.getRemoteKeysForTarget(t).has(e)}}const qn={asc:"ASCENDING",desc:"DESCENDING"},Kn={"\x3c":"LESS_THAN","\x3c\x3d":"LESS_THAN_OR_EQUAL","\x3e":"GREATER_THAN","\x3e\x3d":"GREATER_THAN_OR_EQUAL","\x3d\x3d":"EQUAL","!\x3d":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class jn{constructor(t,e){this.databaseId=t;this.C=e}}class Ss{constructor(t,e){this.seconds=t;this.nanoseconds=e}}class Ds{constructor(t,
e,n){this.ownerId=t;this.allowTabSynchronization=e;this.leaseTimestampMs=n}}Ds.store="owner";Ds.key="owner";class Cs{constructor(t,e,n){this.userId=t;this.lastAcknowledgedBatchId=e;this.lastStreamToken=n}}Cs.store="mutationQueues";Cs.keyPath="userId";class Ns{constructor(t,e,n,s,i){this.userId=t;this.batchId=e;this.localWriteTimeMs=n;this.baseMutations=s;this.mutations=i}}Ns.store="mutations";Ns.keyPath="batchId";Ns.userMutationsIndex="userMutationsIndex";Ns.userMutationsKeyPath=["userId","batchId"];
class ks{constructor(){}static prefixForUser(t){return[t]}static prefixForPath(t,e){return[t,bs(e)]}static key(t,e,n){return[t,bs(e),n]}}ks.store="documentMutations";ks.PLACEHOLDER=new ks;class xs{constructor(t,e){this.path=t;this.readTime=e}}class $s{constructor(t,e){this.path=t;this.version=e}}class Os{constructor(t,e,n,s,i,r){this.unknownDocument=t;this.noDocument=e;this.document=n;this.hasCommittedMutations=s;this.readTime=i;this.parentPath=r}}Os.store="remoteDocuments";Os.readTimeIndex="readTimeIndex";
Os.readTimeIndexPath="readTime";Os.collectionReadTimeIndex="collectionReadTimeIndex";Os.collectionReadTimeIndexPath=["parentPath","readTime"];class Ms{constructor(t){this.byteSize=t}}Ms.store="remoteDocumentGlobal";Ms.key="remoteDocumentGlobalKey";class Fs{constructor(t,e,n,s,i,r,o){this.targetId=t;this.canonicalId=e;this.readTime=n;this.resumeToken=s;this.lastListenSequenceNumber=i;this.lastLimboFreeSnapshotVersion=r;this.query=o}}Fs.store="targets";Fs.keyPath="targetId";Fs.queryTargetsIndexName=
"queryTargetsIndex";Fs.queryTargetsKeyPath=["canonicalId","targetId"];class Ls{constructor(t,e,n){this.targetId=t;this.path=e;this.sequenceNumber=n}}Ls.store="targetDocuments";Ls.keyPath=["targetId","path"];Ls.documentTargetsIndex="documentTargetsIndex";Ls.documentTargetsKeyPath=["path","targetId"];class Bs{constructor(t,e,n,s){this.highestTargetId=t;this.highestListenSequenceNumber=e;this.lastRemoteSnapshotVersion=n;this.targetCount=s}}Bs.key="targetGlobalKey";Bs.store="targetGlobal";class Us{constructor(t,
e){this.collectionId=t;this.parent=e}}Us.store="collectionParents";Us.keyPath=["collectionId","parent"];class qs{constructor(t,e,n,s){this.clientId=t;this.updateTimeMs=e;this.networkEnabled=n;this.inForeground=s}}qs.store="clientMetadata";qs.keyPath="clientId";class Ks{constructor(t,e,n){this.bundleId=t;this.createTime=e;this.version=n}}Ks.store="bundles";Ks.keyPath="bundleId";class js{constructor(t,e,n){this.name=t;this.readTime=e;this.bundledQuery=n}}js.store="namedQueries";js.keyPath="name";const Qs=
[Cs.store,Ns.store,ks.store,Os.store,Fs.store,Ds.store,Bs.store,Ls.store,qs.store,Ms.store,Us.store,Ks.store,js.store];class Gs{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}}class zs{constructor(t$jscomp$0){this.catchCallback=this.nextCallback=null;this.error=this.result=void 0;this.callbackAttached=this.isDone=!1;t$jscomp$0(t=>{this.isDone=!0;this.result=t;this.nextCallback&&
this.nextCallback(t)},t=>{this.isDone=!0;this.error=t;this.catchCallback&&this.catchCallback(t)})}catch(t){return this.next(void 0,t)}next(t$jscomp$0,e$jscomp$0){return this.callbackAttached&&B(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e$jscomp$0,this.error):this.wrapSuccess(t$jscomp$0,this.result):new zs((n,s)=>{this.nextCallback=e=>{this.wrapSuccess(t$jscomp$0,e).next(n,s)};this.catchCallback=t=>{this.wrapFailure(e$jscomp$0,t).next(n,s)}})}toPromise(){return new Promise((t,
e)=>{this.next(t,e)})}wrapUserFunction(t$jscomp$0){try{const e=t$jscomp$0();return e instanceof zs?e:zs.resolve(e)}catch(t){return zs.reject(t)}}wrapSuccess(t,e){return t?this.wrapUserFunction(()=>t(e)):zs.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction(()=>t(e)):zs.reject(e)}static resolve(t){return new zs((e,n)=>{e(t)})}static reject(t){return new zs((e,n)=>{n(t)})}static waitFor(t$jscomp$1){return new zs((e,n)=>{let s=0,i=0,r=!1;t$jscomp$1.forEach(t$jscomp$0=>{++s;t$jscomp$0.next(()=>
{++i;r&&i===s&&e()},t=>n(t))});r=!0;i===s&&e()})}static or(t$jscomp$0){let e=zs.resolve(!1);for(const n of t$jscomp$0)e=e.next(t=>t?zs.resolve(t):n());return e}static forEach(t$jscomp$0,e){const n=[];return t$jscomp$0.forEach((t,s)=>{n.push(e.call(this,t,s))}),this.waitFor(n)}}class Hs{constructor(t,e$jscomp$0){this.action=t;this.transaction=e$jscomp$0;this.aborted=!1;this.It=new W;this.transaction.oncomplete=()=>{this.It.resolve()};this.transaction.onabort=()=>{e$jscomp$0.error?this.It.reject(new Xs(t,
e$jscomp$0.error)):this.It.resolve()};this.transaction.onerror=e=>{e=si(e.target.error);this.It.reject(new Xs(t,e))}}static open(t$jscomp$0,e,n,s){try{return new Hs(e,t$jscomp$0.transaction(s,n))}catch(t){throw new Xs(e,t);}}get At(){return this.It.promise}abort(t){t&&this.It.reject(t);this.aborted||(O("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}store(t){t=this.transaction.objectStore(t);return new ti(t)}}class Js{constructor(t,
e,n){this.name=t;this.version=e;this.Rt=n;12.2===Js.bt((0,_util.getUA)())&&M("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(t){return O("SimpleDb","Removing database:",t),ei(window.indexedDB.deleteDatabase(t)).toPromise()}static Pt(){if(!(0,_util.isIndexedDBAvailable)())return!1;if(Js.vt())return!0;const t=(0,_util.getUA)();var e=Js.bt(t);e=
0<e&&10>e;var s=Js.Vt(t);s=0<s&&4.5>s;return!(0<t.indexOf("MSIE ")||0<t.indexOf("Trident/")||0<t.indexOf("Edge/")||e||s)}static vt(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.St)}static Dt(t,e){return t.store(e)}static bt(t){t=(t=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i))?t[1].split("_").slice(0,2).join("."):"-1";return Number(t)}static Vt(t){t=(t=t.match(/Android ([\d.]+)/i))?t[1].split(".").slice(0,2).join("."):"-1";return Number(t)}Ct(t$jscomp$0){const $jscomp$async$this=
this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){return $jscomp$async$this.db||(O("SimpleDb","Opening database:",$jscomp$async$this.name),$jscomp$async$this.db=yield new Promise((e$jscomp$0,n)=>{const s=indexedDB.open($jscomp$async$this.name,$jscomp$async$this.version);s.onsuccess=t=>{e$jscomp$0(t.target.result)};s.onblocked=()=>{n(new Xs(t$jscomp$0,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))};
s.onerror=e=>{e=e.target.error;"VersionError"===e.name?n(new Q(j.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===e.name?n(new Q(j.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+
e)):n(new Xs(t$jscomp$0,e))};s.onupgradeneeded=t=>{O("SimpleDb",'Database "'+$jscomp$async$this.name+'" requires upgrade from version:',t.oldVersion);$jscomp$async$this.Rt.Nt(t.target.result,s.transaction,t.oldVersion,$jscomp$async$this.version).next(()=>{O("SimpleDb","Database upgrade to version "+$jscomp$async$this.version+" complete")})}})),$jscomp$async$this.kt&&($jscomp$async$this.db.onversionchange=t=>$jscomp$async$this.kt(t)),$jscomp$async$this.db})}xt(t){this.kt=t;this.db&&(this.db.onversionchange=
e=>t(e))}runTransaction(t$jscomp$0,e$jscomp$0,n,s){const $jscomp$async$this=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){const i="readonly"===e$jscomp$0;let r$jscomp$0=0;for(;;){++r$jscomp$0;try{$jscomp$async$this.db=yield $jscomp$async$this.Ct(t$jscomp$0);const e=Hs.open($jscomp$async$this.db,t$jscomp$0,i?"readonly":"readwrite",n),r=s(e).catch(t=>(e.abort(t),zs.reject(t))).toPromise();return r.catch(()=>{}),yield e.At,r}catch(t){const e="FirebaseError"!==t.name&&3>r$jscomp$0;
if(O("SimpleDb","Transaction failed with error:",t.message,"Retrying:",e),$jscomp$async$this.close(),!e)return Promise.reject(t)}}})}close(){this.db&&this.db.close();this.db=void 0}}class Ys{constructor(t){this.$t=t;this.Ot=!1;this.Mt=null}get isDone(){return this.Ot}get Ft(){return this.Mt}set cursor(t){this.$t=t}done(){this.Ot=!0}Lt(t){this.Mt=t}delete(){return ei(this.$t.delete())}}class Xs extends Q{constructor(t,e){super(j.UNAVAILABLE,`IndexedDB transaction '${t}' failed: ${e}`);this.name="IndexedDbTransactionError"}}
class ti{constructor(t){this.store=t}put(t,e){let n;return void 0!==e?(O("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(O("SimpleDb","PUT",this.store.name,"\x3cauto-key\x3e",t),n=this.store.put(t)),ei(n)}add(t){O("SimpleDb","ADD",this.store.name,t,t);return ei(this.store.add(t))}get(t){return ei(this.store.get(t)).next(e=>(void 0===e&&(e=null),O("SimpleDb","GET",this.store.name,t,e),e))}delete(t){O("SimpleDb","DELETE",this.store.name,t);return ei(this.store.delete(t))}count(){O("SimpleDb",
"COUNT",this.store.name);return ei(this.store.count())}Bt(t$jscomp$0,e$jscomp$0){t$jscomp$0=this.cursor(this.options(t$jscomp$0,e$jscomp$0));const s=[];return this.Ut(t$jscomp$0,(t,e)=>{s.push(e)}).next(()=>s)}qt(t$jscomp$0,e$jscomp$0){O("SimpleDb","DELETE ALL",this.store.name);t$jscomp$0=this.options(t$jscomp$0,e$jscomp$0);t$jscomp$0.Kt=!1;t$jscomp$0=this.cursor(t$jscomp$0);return this.Ut(t$jscomp$0,(t,e,n)=>n.delete())}jt(t,e){let n;e?n=t:(n={},e=t);t=this.cursor(n);return this.Ut(t,e)}Qt(t$jscomp$0){const e$jscomp$0=
this.cursor({});return new zs((n,s$jscomp$0)=>{e$jscomp$0.onerror=t=>{t=si(t.target.error);s$jscomp$0(t)};e$jscomp$0.onsuccess=e=>{const s=e.target.result;s?t$jscomp$0(s.primaryKey,s.value).next(t=>{t?s.continue():n()}):n()}})}Ut(t$jscomp$1,e){const n=[];return(new zs((s,i)=>{t$jscomp$1.onerror=t=>{i(t.target.error)};t$jscomp$1.onsuccess=t$jscomp$0=>{t$jscomp$0=t$jscomp$0.target.result;if(!t$jscomp$0)return void s();const r=new Ys(t$jscomp$0);var o=e(t$jscomp$0.primaryKey,t$jscomp$0.value,r);o instanceof
zs&&(o=o.catch(t=>(r.done(),zs.reject(t))),n.push(o));r.isDone?s():null===r.Ft?t$jscomp$0.continue():t$jscomp$0.continue(r.Ft)}})).next(()=>zs.waitFor(n))}options(t,e){let n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}}cursor(t){let e="next";if(t.reverse&&(e="prev"),t.index){const n=this.store.index(t.index);return t.Kt?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)}}let ni=!1;class ii extends Gs{constructor(t,e){super();this.Wt=t;this.currentSequenceNumber=
e}}class oi{constructor(t,e,n,s){this.batchId=t;this.localWriteTime=e;this.baseMutations=n;this.mutations=s}applyToRemoteDocument(t,e$jscomp$0){e$jscomp$0=e$jscomp$0.mutationResults;for(let e=0;e<this.mutations.length;e++){const s=this.mutations[e];s.key.isEqual(t.key)&&tn(s,t,e$jscomp$0[e])}}applyToLocalView(t){for(const e of this.baseMutations)e.key.isEqual(t.key)&&en(e,t,this.localWriteTime);for(const e of this.mutations)e.key.isEqual(t.key)&&en(e,t,this.localWriteTime)}applyToLocalDocumentSet(t){this.mutations.forEach(e=>
{e=t.get(e.key);this.applyToLocalView(e);e.isValidDocument()||e.convertToNoDocument(ut.min())})}keys(){return this.mutations.reduce((t,e)=>t.add(e.key),Dn())}isEqual(t$jscomp$0){return this.batchId===t$jscomp$0.batchId&&ot(this.mutations,t$jscomp$0.mutations,(t,e)=>sn(t,e))&&ot(this.baseMutations,t$jscomp$0.baseMutations,(t,e)=>sn(t,e))}}class ci{constructor(t,e,n,s){this.batch=t;this.commitVersion=e;this.mutationResults=n;this.docVersions=s}static from(t$jscomp$0,e,n){t$jscomp$0.mutations.length===
n.length||B();let s=vn;const i=t$jscomp$0.mutations;for(let t=0;t<i.length;t++)s=s.insert(i[t].key,n[t].version);return new ci(t$jscomp$0,e,n,s)}}class ai{constructor(t,e,n,s,i=ut.min(),r=ut.min(),o=pt.EMPTY_BYTE_STRING){this.target=t;this.targetId=e;this.purpose=n;this.sequenceNumber=s;this.snapshotVersion=i;this.lastLimboFreeSnapshotVersion=r;this.resumeToken=o}withSequenceNumber(t){return new ai(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(t,
e){return new ai(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)}withLastLimboFreeSnapshotVersion(t){return new ai(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken)}}class ui{constructor(t){this.Gt=t}}class Ti{getBundleMetadata(t$jscomp$0,e$jscomp$0){return ri(t$jscomp$0,Ks.store).get(e$jscomp$0).next(t=>{if(t)return{id:(e=t).bundleId,createTime:_i(e.createTime),version:e.version};var e})}saveBundleMetadata(t,
e){return ri(t,Ks.store).put({bundleId:(n=e).id,createTime:wi(zn(n.createTime)),version:n.version});var n}getNamedQuery(t$jscomp$0,e$jscomp$0){return ri(t$jscomp$0,js.store).get(e$jscomp$0).next(t=>{if(t)return{name:(e=t).name,query:pi(e.bundledQuery),readTime:_i(e.readTime)};var e})}saveNamedQuery(t,e){t=ri(t,js.store);var JSCompiler_temp_const=t.put;e={name:e.name,readTime:wi(zn(e.readTime)),bundledQuery:e.bundledQuery};return JSCompiler_temp_const.call(t,e)}}class Ai{constructor(){this.zt=new Ri}addToCollectionParentIndex(t,
e){return this.zt.add(e),zs.resolve()}getCollectionParents(t,e){return zs.resolve(this.zt.getEntries(e))}}class Ri{constructor(){this.index={}}add(t){const e=t.lastSegment();t=t.popLast();const s=this.index[e]||new En(wt.comparator),i=!s.has(t);return this.index[e]=s.add(t),i}has(t){var e=t.lastSegment();t=t.popLast();return(e=this.index[e])&&e.has(t)}getEntries(t){return(this.index[t]||new En(wt.comparator)).toArray()}}class bi{constructor(){this.Ht=new Ri}addToCollectionParentIndex(t,e){if(!this.Ht.has(e)){var n=
e.lastSegment();const s=e.popLast();t.addOnCommittedListener(()=>{this.Ht.add(e)});n={collectionId:n,parent:bs(s)};return ri(t,Us.store).put(n)}return zs.resolve()}getCollectionParents(t$jscomp$0,e){const n=[],s$jscomp$0=IDBKeyRange.bound([e,""],[e+"\x00",""],!1,!0);return ri(t$jscomp$0,Us.store).Bt(s$jscomp$0).next(t=>{for(const s of t){if(s.collectionId!==e)break;n.push(Vs(s.parent))}return n})}}const vi={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Vi{constructor(t,
e,n){this.cacheSizeCollectionThreshold=t;this.percentileToCollect=e;this.maximumSequenceNumbersToCollect=n}static withCacheSize(t){return new Vi(t,Vi.DEFAULT_COLLECTION_PERCENTILE,Vi.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}Vi.DEFAULT_COLLECTION_PERCENTILE=10;Vi.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1E3;Vi.DEFAULT=new Vi(41943040,Vi.DEFAULT_COLLECTION_PERCENTILE,Vi.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT);Vi.DISABLED=new Vi(-1,0,0);class Ci{constructor(t,e,n,s){this.userId=t;this.k=e;this.Jt=n;
this.referenceDelegate=s;this.Yt={}}static Xt(t,e,n,s){""!==t.uid||B();t=t.isAuthenticated()?t.uid:"";return new Ci(t,e,n,s)}checkEmpty(t$jscomp$0){let e=!0;const n$jscomp$0=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return ki(t$jscomp$0).jt({index:Ns.userMutationsIndex,range:n$jscomp$0},(t,n,s)=>{e=!1;s.done()}).next(()=>e)}addMutationBatch(t$jscomp$0,e$jscomp$1,n$jscomp$0,s$jscomp$0){const i$jscomp$0=ri(t$jscomp$0,ks.store),r=ki(t$jscomp$0);
return r.add({}).next(o=>{"number"==typeof o||B();const c=new oi(o,e$jscomp$1,n$jscomp$0,s$jscomp$0),a=function(t,e$jscomp$0,n){const s=n.baseMutations.map(e=>cs(t.Gt,e)),i=n.mutations.map(e=>cs(t.Gt,e));return new Ns(e$jscomp$0,n.batchId,n.localWriteTime.toMillis(),s,i)}(this.k,this.userId,c),u=[];let h=new En((t,e)=>rt(t.canonicalString(),e.canonicalString()));for(const t of s$jscomp$0){const e=ks.key(this.userId,t.key.path,o);h=h.add(t.key.path.popLast());u.push(r.put(a));u.push(i$jscomp$0.put(e,
ks.PLACEHOLDER))}return h.forEach(e=>{u.push(this.Jt.addToCollectionParentIndex(t$jscomp$0,e))}),t$jscomp$0.addOnCommittedListener(()=>{this.Yt[o]=c.keys()}),zs.waitFor(u).next(()=>c)})}lookupMutationBatch(t$jscomp$0,e){return ki(t$jscomp$0).get(e).next(t=>{t?(t.userId===this.userId||B(),t=mi(this.k,t)):t=null;return t})}Zt(t$jscomp$0,e){return this.Yt[e]?zs.resolve(this.Yt[e]):this.lookupMutationBatch(t$jscomp$0,e).next(t=>t?(t=t.keys(),this.Yt[e]=t,t):null)}getNextMutationBatchAfterBatchId(t$jscomp$0,
e$jscomp$0){const n=e$jscomp$0+1;e$jscomp$0=IDBKeyRange.lowerBound([this.userId,n]);let i=null;return ki(t$jscomp$0).jt({index:Ns.userMutationsIndex,range:e$jscomp$0},(t,e,s)=>{e.userId===this.userId&&(e.batchId>=n||B(),i=mi(this.k,e));s.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(t$jscomp$0){const e$jscomp$0=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=-1;return ki(t$jscomp$0).jt({index:Ns.userMutationsIndex,range:e$jscomp$0,reverse:!0},(t,e,s)=>{n=e.batchId;s.done()}).next(()=>
n)}getAllMutationBatches(t$jscomp$1){const e=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return ki(t$jscomp$1).Bt(Ns.userMutationsIndex,e).next(t$jscomp$0=>t$jscomp$0.map(t=>mi(this.k,t)))}getAllMutationBatchesAffectingDocumentKey(t$jscomp$0,e){var n$jscomp$0=ks.prefixForPath(this.userId,e.path);n$jscomp$0=IDBKeyRange.lowerBound(n$jscomp$0);const i=[];return ri(t$jscomp$0,ks.store).jt({range:n$jscomp$0},(n,s,r)=>{const [o,c,a]=n;n=Vs(c);if(o===this.userId&&e.path.isEqual(n))return ki(t$jscomp$0).get(a).next(t=>
{if(!t)throw B();t.userId===this.userId||B();i.push(mi(this.k,t))});r.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(t$jscomp$0,e$jscomp$0){let n=new En(rt);const s$jscomp$0=[];return e$jscomp$0.forEach(e=>{var i$jscomp$0=ks.prefixForPath(this.userId,e.path);i$jscomp$0=IDBKeyRange.lowerBound(i$jscomp$0);i$jscomp$0=ri(t$jscomp$0,ks.store).jt({range:i$jscomp$0},(t,s,i)=>{const [r,o,c]=t;t=Vs(o);r===this.userId&&e.path.isEqual(t)?n=n.add(c):i.done()});s$jscomp$0.push(i$jscomp$0)}),zs.waitFor(s$jscomp$0).next(()=>
this.te(t$jscomp$0,n))}getAllMutationBatchesAffectingQuery(t$jscomp$0,e$jscomp$0){const n=e$jscomp$0.path,s=n.length+1;e$jscomp$0=ks.prefixForPath(this.userId,n);e$jscomp$0=IDBKeyRange.lowerBound(e$jscomp$0);let o=new En(rt);return ri(t$jscomp$0,ks.store).jt({range:e$jscomp$0},(t,e,i)=>{const [r,c,a]=t;t=Vs(c);r===this.userId&&n.isPrefixOf(t)?t.length===s&&(o=o.add(a)):i.done()}).next(()=>this.te(t$jscomp$0,o))}te(t$jscomp$0,e$jscomp$0){const n=[],s=[];return e$jscomp$0.forEach(e=>{s.push(ki(t$jscomp$0).get(e).next(t=>
{if(null===t)throw B();t.userId===this.userId||B();n.push(mi(this.k,t))}))}),zs.waitFor(s).next(()=>n)}removeMutationBatch(t,e$jscomp$0){return Si(t.Wt,this.userId,e$jscomp$0).next(n=>(t.addOnCommittedListener(()=>{this.ee(e$jscomp$0.batchId)}),zs.forEach(n,e=>this.referenceDelegate.markPotentiallyOrphaned(t,e))))}ee(t){delete this.Yt[t]}performConsistencyCheck(t$jscomp$0){return this.checkEmpty(t$jscomp$0).next(e$jscomp$0=>{if(!e$jscomp$0)return zs.resolve();e$jscomp$0=IDBKeyRange.lowerBound(ks.prefixForUser(this.userId));
const s=[];return ri(t$jscomp$0,ks.store).jt({range:e$jscomp$0},(t,e,n)=>{t[0]===this.userId?(t=Vs(t[1]),s.push(t)):n.done()}).next(()=>{0===s.length||B()})})}containsKey(t,e){return Ni(t,this.userId,e)}ne(t$jscomp$0){return ri(t$jscomp$0,Cs.store).get(this.userId).next(t=>t||new Cs(this.userId,-1,""))}}class Oi{constructor(t){this.se=t}next(){return this.se+=2,this.se}static ie(){return new Oi(0)}static re(){return new Oi(-1)}}class Mi{constructor(t,e){this.referenceDelegate=t;this.k=e}allocateTargetId(t){return this.oe(t).next(e=>
{const n=new Oi(e.highestTargetId);return e.highestTargetId=n.next(),this.ce(t,e).next(()=>e.highestTargetId)})}getLastRemoteSnapshotVersion(t$jscomp$0){return this.oe(t$jscomp$0).next(t=>ut.fromTimestamp(new at(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(t$jscomp$0){return this.oe(t$jscomp$0).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(t,e,n){return this.oe(t).next(s=>(s.highestListenSequenceNumber=e,n&&(s.lastRemoteSnapshotVersion=
n.toTimestamp()),e>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=e),this.ce(t,s)))}addTargetData(t,e){return this.ae(t,e).next(()=>this.oe(t).next(n=>(n.targetCount+=1,this.ue(e,n),this.ce(t,n))))}updateTargetData(t,e){return this.ae(t,e)}removeTargetData(t,e$jscomp$0){return this.removeMatchingKeysForTargetId(t,e$jscomp$0.targetId).next(()=>ri(t,Fs.store).delete(e$jscomp$0.targetId)).next(()=>this.oe(t)).next(e=>{0<e.targetCount||B();return--e.targetCount,this.ce(t,e)})}removeTargets(t,
e,n){let s=0;const i=[];return ri(t,Fs.store).jt((r,o)=>{r=gi(o);r.sequenceNumber<=e&&null===n.get(r.targetId)&&(s++,i.push(this.removeTargetData(t,r)))}).next(()=>zs.waitFor(i)).next(()=>s)}forEachTarget(t$jscomp$0,e){return ri(t$jscomp$0,Fs.store).jt((t,n)=>{t=gi(n);e(t)})}oe(t$jscomp$0){return ri(t$jscomp$0,Bs.store).get(Bs.key).next(t=>{null!==t||B();return t})}ce(t,e){return ri(t,Bs.store).put(Bs.key,e)}ae(t,e){return ri(t,Fs.store).put(yi(this.k,e))}ue(t,e){let n=!1;return t.targetId>e.highestTargetId&&
(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n}getTargetCount(t$jscomp$0){return this.oe(t$jscomp$0).next(t=>t.targetCount)}getTargetData(t$jscomp$0,e){var n$jscomp$0=Jt(e);n$jscomp$0=IDBKeyRange.bound([n$jscomp$0,Number.NEGATIVE_INFINITY],[n$jscomp$0,Number.POSITIVE_INFINITY]);let i=null;return ri(t$jscomp$0,Fs.store).jt({range:n$jscomp$0,index:Fs.queryTargetsIndexName},(t,n,s)=>{t=gi(n);Xt(e,t.target)&&
(i=t,s.done())}).next(()=>i)}addMatchingKeys(t,e$jscomp$0,n){const s=[],i=Bi(t);return e$jscomp$0.forEach(e=>{const r=bs(e.path);s.push(i.put(new Ls(n,r)));s.push(this.referenceDelegate.addReference(t,n,e))}),zs.waitFor(s)}removeMatchingKeys(t,e$jscomp$0,n){const s=Bi(t);return zs.forEach(e$jscomp$0,e=>{const i=bs(e.path);return zs.waitFor([s.delete([n,i]),this.referenceDelegate.removeReference(t,n,e)])})}removeMatchingKeysForTargetId(t,e){t=Bi(t);e=IDBKeyRange.bound([e],[e+1],!1,!0);return t.delete(e)}getMatchingKeysForTargetId(t$jscomp$0,
e$jscomp$0){e$jscomp$0=IDBKeyRange.bound([e$jscomp$0],[e$jscomp$0+1],!1,!0);t$jscomp$0=Bi(t$jscomp$0);let i=Dn();return t$jscomp$0.jt({range:e$jscomp$0,Kt:!0},(t,e,n)=>{t=Vs(t[1]);t=new Dt(t);i=i.add(t)}).next(()=>i)}containsKey(t$jscomp$0,e){e=bs(e.path);e=IDBKeyRange.bound([e],[e+"\x00"],!1,!0);let i=0;return Bi(t$jscomp$0).jt({index:Ls.documentTargetsIndex,Kt:!0,range:e},([t],n,s)=>{0!==t&&(i++,s.done())}).next(()=>0<i)}Et(t$jscomp$0,e){return ri(t$jscomp$0,Fs.store).get(e).next(t=>t?gi(t):null)}}
class Ki{constructor(t){this.he=t;this.buffer=new En(qi);this.le=0}fe(){return++this.le}de(t$jscomp$0){t$jscomp$0=[t$jscomp$0,this.fe()];if(this.buffer.size<this.he)this.buffer=this.buffer.add(t$jscomp$0);else{const t=this.buffer.last();0>qi(t$jscomp$0,t)&&(this.buffer=this.buffer.delete(t).add(t$jscomp$0))}}get maxValue(){return this.buffer.last()[0]}}class ji{constructor(t,e){this.garbageCollector=t;this.asyncQueue=e;this.we=!1;this._e=null}start(t){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&
this.me(t)}stop(){this._e&&(this._e.cancel(),this._e=null)}get started(){return null!==this._e}me(t$jscomp$0){const e=this.we?3E5:6E4;O("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`);this._e=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>{const $jscomp$async$this=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){$jscomp$async$this._e=null;$jscomp$async$this.we=!0;try{yield t$jscomp$0.collectGarbage($jscomp$async$this.garbageCollector)}catch(t){Zs(t)?
O("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):yield Ui(t)}yield $jscomp$async$this.me(t$jscomp$0)})})}}class Qi{constructor(t,e){this.ge=t;this.params=e}calculateTargetCount(t$jscomp$0,e){return this.ge.ye(t$jscomp$0).next(t=>Math.floor(e/100*t))}nthSequenceNumber(t$jscomp$0,e){if(0===e)return zs.resolve(nt.I);const n=new Ki(e);return this.ge.forEachTarget(t$jscomp$0,t=>n.de(t.sequenceNumber)).next(()=>this.ge.pe(t$jscomp$0,t=>n.de(t))).next(()=>n.maxValue)}removeTargets(t,
e,n){return this.ge.removeTargets(t,e,n)}removeOrphanedDocuments(t,e){return this.ge.removeOrphanedDocuments(t,e)}collect(t,e){return-1===this.params.cacheSizeCollectionThreshold?(O("LruGarbageCollector","Garbage collection skipped; disabled"),zs.resolve(vi)):this.getCacheSize(t).next(n=>n<this.params.cacheSizeCollectionThreshold?(O("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),vi):this.Te(t,e))}getCacheSize(t){return this.ge.getCacheSize(t)}Te(t$jscomp$0,
e$jscomp$0){let n,s$jscomp$0,i,r,o,a,u;const h=Date.now();return this.calculateTargetCount(t$jscomp$0,this.params.percentileToCollect).next(e=>(e>this.params.maximumSequenceNumbersToCollect?(O("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${e}`),s$jscomp$0=this.params.maximumSequenceNumbersToCollect):s$jscomp$0=e,r=Date.now(),this.nthSequenceNumber(t$jscomp$0,s$jscomp$0))).next(s=>(n=s,o=Date.now(),this.removeTargets(t$jscomp$0,
n,e$jscomp$0))).next(e=>(i=e,a=Date.now(),this.removeOrphanedDocuments(t$jscomp$0,n))).next(t=>{(u=Date.now(),k.logLevel<=_logger.LogLevel.DEBUG)&&O("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${r-h}ms\n\tDetermined least recently used ${s$jscomp$0} in `+(o-r)+"ms\n"+`\tRemoved ${i} targets in `+(a-o)+"ms\n"+`\tRemoved ${t} documents in `+(u-a)+"ms\n"+`Total Duration: ${u-h}ms`);return zs.resolve({didRun:!0,sequenceNumbersCollected:s$jscomp$0,targetsRemoved:i,documentsRemoved:t})})}}
class Wi{constructor(t,e){this.db=t;this.garbageCollector=new Qi(this,e)}ye(t$jscomp$0){const e$jscomp$0=this.Ee(t$jscomp$0);return this.db.getTargetCache().getTargetCount(t$jscomp$0).next(t=>e$jscomp$0.next(e=>t+e))}Ee(t$jscomp$0){let e=0;return this.pe(t$jscomp$0,t=>{e++}).next(()=>e)}forEachTarget(t,e){return this.db.getTargetCache().forEachTarget(t,e)}pe(t$jscomp$0,e){return this.Ie(t$jscomp$0,(t,n)=>e(n))}addReference(t,e,n){return Gi(t,n)}removeReference(t,e,n){return Gi(t,n)}removeTargets(t,
e,n){return this.db.getTargetCache().removeTargets(t,e,n)}markPotentiallyOrphaned(t,e){return Gi(t,e)}Ae(t$jscomp$1,e$jscomp$0){return function(t$jscomp$0,e){let n=!1;return ri(t$jscomp$0,Cs.store).Qt(s=>Ni(t$jscomp$0,s,e).next(t=>(t&&(n=!0),zs.resolve(!t)))).next(()=>n)}(t$jscomp$1,e$jscomp$0)}removeOrphanedDocuments(t,e$jscomp$0){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.Ie(t,(r,o)=>{o<=e$jscomp$0&&(o=this.Ae(t,r).next(e=>{if(!e)return i++,n.getEntry(t,
r).next(()=>(n.removeEntry(r),Bi(t).delete([0,bs(r.path)])))}),s.push(o))}).next(()=>zs.waitFor(s)).next(()=>n.apply(t)).next(()=>i)}removeTarget(t,e){e=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,e)}updateLimboDocument(t,e){return Gi(t,e)}Ie(t$jscomp$0,e){t$jscomp$0=Bi(t$jscomp$0);let s,i=nt.I;return t$jscomp$0.jt({index:Ls.documentTargetsIndex},([t],{path:r,sequenceNumber:o})=>{0===t?(i!==nt.I&&e(new Dt(Vs(s)),i),i=o,s=r):i=nt.I}).next(()=>{i!==
nt.I&&e(new Dt(Vs(s)),i)})}getCacheSize(t){return this.db.getRemoteDocumentCache().getSize(t)}}class zi{constructor(t,e){this.mapKeyFn=t;this.equalsFn=e;this.inner={}}get(t){var e$jscomp$0=this.mapKeyFn(t);e$jscomp$0=this.inner[e$jscomp$0];if(void 0!==e$jscomp$0)for(const [e,s]of e$jscomp$0)if(this.equalsFn(e,t))return s}has(t){return void 0!==this.get(t)}set(t,e){var n=this.mapKeyFn(t);const s=this.inner[n];if(void 0!==s){for(n=0;n<s.length;n++)if(this.equalsFn(s[n][0],t))return void(s[n]=[t,e]);
s.push([t,e])}else this.inner[n]=[[t,e]]}delete(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(let s=0;s<n.length;s++)if(this.equalsFn(n[s][0],t))return 1===n.length?delete this.inner[e]:n.splice(s,1),!0;return!1}forEach(t){lt(this.inner,(e$jscomp$0,n)=>{for(const [e,s]of n)t(e,s)})}isEmpty(){return ft(this.inner)}}class Hi{constructor(){this.changes=new zi(t=>t.toString(),(t,e)=>t.isEqual(e));this.changesApplied=!1}getReadTime(t){return(t=this.changes.get(t))?t.readTime:ut.min()}addEntry(t,
e){this.assertNotApplied();this.changes.set(t.key,{document:t,readTime:e})}removeEntry(t,e=null){this.assertNotApplied();this.changes.set(t,{document:Gt.newInvalidDocument(t),readTime:e})}getEntry(t,e){this.assertNotApplied();const n=this.changes.get(e);return void 0!==n?zs.resolve(n.document):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class Ji{constructor(t,e){this.k=
t;this.Jt=e}addEntry(t,e,n){return Zi(t).put(e.path.toArray(),n)}removeEntry(t,e){t=Zi(t);e=e.path.toArray();return t.delete(e)}updateMetadata(t,e){return this.getMetadata(t).next(n=>(n.byteSize+=e,this.Re(t,n)))}getEntry(t$jscomp$0,e){return Zi(t$jscomp$0).get(e.path.toArray()).next(t=>this.be(e,t))}Pe(t$jscomp$0,e){return Zi(t$jscomp$0).get(e.path.toArray()).next(t=>({document:this.be(e,t),size:Di(t)}))}getEntries(t$jscomp$0,e$jscomp$0){let n=An;return this.ve(t$jscomp$0,e$jscomp$0,(t,e)=>{e=this.be(t,
e);n=n.insert(t,e)}).next(()=>n)}Ve(t$jscomp$0,e$jscomp$0){let n=An,s=new yn(Dt.comparator);return this.ve(t$jscomp$0,e$jscomp$0,(t,e)=>{const i=this.be(t,e);n=n.insert(t,i);s=s.insert(t,Di(e))}).next(()=>({documents:n,Se:s}))}ve(t$jscomp$0,e$jscomp$0,n){if(e$jscomp$0.isEmpty())return zs.resolve();const s$jscomp$0=IDBKeyRange.bound(e$jscomp$0.first().path.toArray(),e$jscomp$0.last().path.toArray()),i=e$jscomp$0.getIterator();let r=i.getNext();return Zi(t$jscomp$0).jt({range:s$jscomp$0},(t,e,s)=>{for(t=
Dt.fromSegments(t);r&&0>Dt.comparator(r,t);)n(r,null),r=i.getNext();r&&r.isEqual(t)&&(n(r,e),r=i.hasNext()?i.getNext():null);r?s.Lt(r.path.toArray()):s.done()}).next(()=>{for(;r;)n(r,null),r=i.hasNext()?i.getNext():null})}getDocumentsMatchingQuery(t$jscomp$1,e,n$jscomp$0){let s=An;const i=e.path.length+1,r$jscomp$0={};if(n$jscomp$0.isEqual(ut.min())){var t$jscomp$0=e.path.toArray();r$jscomp$0.range=IDBKeyRange.lowerBound(t$jscomp$0)}else t$jscomp$0=e.path.toArray(),n$jscomp$0=fi(n$jscomp$0),r$jscomp$0.range=
IDBKeyRange.lowerBound([t$jscomp$0,n$jscomp$0],!0),r$jscomp$0.index=Os.collectionReadTimeIndex;return Zi(t$jscomp$1).jt(r$jscomp$0,(t,n,r)=>{t.length===i&&(t=hi(this.k,n),e.path.isPrefixOf(t.key.path)?De(e,t)&&(s=s.insert(t.key,t)):r.done())}).next(()=>s)}newChangeBuffer(t){return new Yi(this,!!t&&t.trackRemovals)}getSize(t$jscomp$0){return this.getMetadata(t$jscomp$0).next(t=>t.byteSize)}getMetadata(t$jscomp$0){return ri(t$jscomp$0,Ms.store).get(Ms.key).next(t=>{t||B();return t})}Re(t,e){return ri(t,
Ms.store).put(Ms.key,e)}be(t,e){return!e||(e=hi(this.k,e),e.isNoDocument()&&e.version.isEqual(ut.min()))?Gt.newInvalidDocument(t):e}}class Yi extends Hi{constructor(t$jscomp$0,e$jscomp$0){super();this.De=t$jscomp$0;this.trackRemovals=e$jscomp$0;this.Ce=new zi(t=>t.toString(),(t,e)=>t.isEqual(e))}applyChanges(t$jscomp$0){const e$jscomp$0=[];let n$jscomp$0=0,s=new En((t,e)=>rt(t.canonicalString(),e.canonicalString()));return this.changes.forEach((i,r)=>{var o=this.Ce.get(i);if(r.document.isValidDocument()){r=
li(this.De.k,r.document,this.getReadTime(i));s=s.add(i.path.popLast());const a=Di(r);n$jscomp$0+=a-o;e$jscomp$0.push(this.De.addEntry(t$jscomp$0,i,r))}else(n$jscomp$0-=o,this.trackRemovals)?(o=li(this.De.k,Gt.newNoDocument(i,ut.min()),this.getReadTime(i)),e$jscomp$0.push(this.De.addEntry(t$jscomp$0,i,o))):e$jscomp$0.push(this.De.removeEntry(t$jscomp$0,i))}),s.forEach(n=>{e$jscomp$0.push(this.De.Jt.addToCollectionParentIndex(t$jscomp$0,n))}),e$jscomp$0.push(this.De.updateMetadata(t$jscomp$0,n$jscomp$0)),
zs.waitFor(e$jscomp$0)}getFromCache(t$jscomp$0,e){return this.De.Pe(t$jscomp$0,e).next(t=>(this.Ce.set(e,t.size),t.document))}getAllFromCache(t$jscomp$1,e$jscomp$1){return this.De.Ve(t$jscomp$1,e$jscomp$1).next(({documents:t$jscomp$0,Se:e$jscomp$0})=>(e$jscomp$0.forEach((t,e)=>{this.Ce.set(t,e)}),t$jscomp$0))}}class er{constructor(t){this.k=t}Nt(t$jscomp$1,e$jscomp$0,n$jscomp$0,s$jscomp$0){n$jscomp$0<s$jscomp$0&&0<=n$jscomp$0&&11>=s$jscomp$0||B();const i=new Hs("createOrUpgrade",e$jscomp$0);1>n$jscomp$0&&
1<=s$jscomp$0&&(t$jscomp$1.createObjectStore(Ds.store),function(t){t.createObjectStore(Cs.store,{keyPath:Cs.keyPath});t.createObjectStore(Ns.store,{keyPath:Ns.keyPath,autoIncrement:!0}).createIndex(Ns.userMutationsIndex,Ns.userMutationsKeyPath,{unique:!0});t.createObjectStore(ks.store)}(t$jscomp$1),nr(t$jscomp$1),t$jscomp$1.createObjectStore(Os.store));let r=zs.resolve();return 3>n$jscomp$0&&3<=s$jscomp$0&&(0!==n$jscomp$0&&(!function(t){t.deleteObjectStore(Ls.store);t.deleteObjectStore(Fs.store);
t.deleteObjectStore(Bs.store)}(t$jscomp$1),nr(t$jscomp$1)),r=r.next(()=>{const e=i.store(Bs.store),n=new Bs(0,0,ut.min().toTimestamp(),0);return e.put(Bs.key,n)})),4>n$jscomp$0&&4<=s$jscomp$0&&(0!==n$jscomp$0&&(r=r.next(()=>function(t$jscomp$0,e){return e.store(Ns.store).Bt().next(n=>{t$jscomp$0.deleteObjectStore(Ns.store);t$jscomp$0.createObjectStore(Ns.store,{keyPath:Ns.keyPath,autoIncrement:!0}).createIndex(Ns.userMutationsIndex,Ns.userMutationsKeyPath,{unique:!0});const s=e.store(Ns.store);n=
n.map(t=>s.put(t));return zs.waitFor(n)})}(t$jscomp$1,i))),r=r.next(()=>{t$jscomp$1.createObjectStore(qs.store,{keyPath:qs.keyPath});!0})),5>n$jscomp$0&&5<=s$jscomp$0&&(r=r.next(()=>this.Ne(i))),6>n$jscomp$0&&6<=s$jscomp$0&&(r=r.next(()=>{t$jscomp$1.createObjectStore(Ms.store);return this.ke(i)})),7>n$jscomp$0&&7<=s$jscomp$0&&(r=r.next(()=>this.xe(i))),8>n$jscomp$0&&8<=s$jscomp$0&&(r=r.next(()=>this.$e(t$jscomp$1,i))),9>n$jscomp$0&&9<=s$jscomp$0&&(r=r.next(()=>{!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&
t.deleteObjectStore("remoteDocumentChanges")}(t$jscomp$1);(function(t){t=t.objectStore(Os.store);t.createIndex(Os.readTimeIndex,Os.readTimeIndexPath,{unique:!1});t.createIndex(Os.collectionReadTimeIndex,Os.collectionReadTimeIndexPath,{unique:!1})})(e$jscomp$0)})),10>n$jscomp$0&&10<=s$jscomp$0&&(r=r.next(()=>this.Oe(i))),11>n$jscomp$0&&11<=s$jscomp$0&&(r=r.next(()=>{t$jscomp$1.createObjectStore(Ks.store,{keyPath:Ks.keyPath});!0;t$jscomp$1.createObjectStore(js.store,{keyPath:js.keyPath})})),r}ke(t$jscomp$0){let e=
0;return t$jscomp$0.store(Os.store).jt((t,n)=>{e+=Di(n)}).next(()=>{const n=new Ms(e);return t$jscomp$0.store(Ms.store).put(Ms.key,n)})}Ne(t){const e$jscomp$1=t.store(Cs.store),n$jscomp$1=t.store(Ns.store);return e$jscomp$1.Bt().next(e$jscomp$0=>zs.forEach(e$jscomp$0,e=>{const s=IDBKeyRange.bound([e.userId,-1],[e.userId,e.lastAcknowledgedBatchId]);return n$jscomp$1.Bt(Ns.userMutationsIndex,s).next(n$jscomp$0=>zs.forEach(n$jscomp$0,n=>{n.userId===e.userId||B();n=mi(this.k,n);return Si(t,e.userId,n).next(()=>
{})}))}))}xe(t$jscomp$0){const e=t$jscomp$0.store(Ls.store),n$jscomp$1=t$jscomp$0.store(Os.store);return t$jscomp$0.store(Bs.store).get(Bs.key).next(t=>{const s=[];return n$jscomp$1.jt((n$jscomp$0,i)=>{const r=new wt(n$jscomp$0);n$jscomp$0=[0,bs(r)];s.push(e.get(n$jscomp$0).next(n=>n?zs.resolve():e.put(new Ls(0,bs(r),t.highestListenSequenceNumber))))}).next(()=>zs.waitFor(s))})}$e(t$jscomp$0,e$jscomp$0){t$jscomp$0.createObjectStore(Us.store,{keyPath:Us.keyPath});const n=e$jscomp$0.store(Us.store),
s$jscomp$0=new Ri,i=t=>{if(s$jscomp$0.add(t)){const e=t.lastSegment();t=t.popLast();return n.put({collectionId:e,parent:bs(t)})}};return e$jscomp$0.store(Os.store).jt({Kt:!0},(t,e)=>{t=new wt(t);return i(t.popLast())}).next(()=>e$jscomp$0.store(ks.store).jt({Kt:!0},([,e],s)=>{e=Vs(e);return i(e.popLast())}))}Oe(t$jscomp$0){const e=t$jscomp$0.store(Fs.store);return e.jt((t,n)=>{t=gi(n);t=yi(this.k,t);return e.put(t)})}}class ir{constructor(t$jscomp$0,e,n,s,i,r,o,c,a,u){if(this.allowTabSynchronization=
t$jscomp$0,this.persistenceKey=e,this.clientId=n,this.Me=i,this.window=r,this.document=o,this.Fe=a,this.Le=u,this.Be=null,this.Ue=!1,this.isPrimary=!1,this.networkEnabled=!0,this.qe=null,this.inForeground=!1,this.Ke=null,this.je=null,this.Qe=Number.NEGATIVE_INFINITY,this.We=t=>Promise.resolve(),!ir.Pt())throw new Q(j.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Wi(this,
s);this.Ge=e+"main";this.k=new ui(c);this.ze=new Js(this.Ge,11,new er(this.k));this.He=new Mi(this.referenceDelegate,this.k);this.Jt=new bi;this.Je=new Ji(this.k,this.Jt);this.Ye=new Ti;this.window&&this.window.localStorage?this.Xe=this.window.localStorage:(this.Xe=null,!1===u&&M("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Ze().then(()=>
{if(!this.isPrimary&&!this.allowTabSynchronization)throw new Q(j.FAILED_PRECONDITION,"Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.");return this.tn(),this.en(),this.nn(),this.runTransaction("getHighestListenSequenceNumber","readonly",t=>this.He.getHighestSequenceNumber(t))}).then(t=>
{this.Be=new nt(t,this.Fe)}).then(()=>{this.Ue=!0}).catch(t=>(this.ze&&this.ze.close(),Promise.reject(t)))}sn(t){return this.We=e=>{const $jscomp$async$this=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){if($jscomp$async$this.started)return t(e)})},t(this.isPrimary)}setDatabaseDeletedListener(t){this.ze.xt(e=>$jscomp.asyncExecutePromiseGeneratorFunction(function*(){null===e.newVersion&&(yield t())}))}setNetworkEnabled(t){this.networkEnabled!==t&&(this.networkEnabled=t,this.Me.enqueueAndForget(()=>
{const $jscomp$async$this=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){$jscomp$async$this.started&&(yield $jscomp$async$this.Ze())})}))}Ze(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",t$jscomp$0=>ri(t$jscomp$0,qs.store).put(new qs(this.clientId,Date.now(),this.networkEnabled,this.inForeground)).next(()=>{if(this.isPrimary)return this.rn(t$jscomp$0).next(t=>{t||(this.isPrimary=!1,this.Me.enqueueRetryable(()=>this.We(!1)))})}).next(()=>this.on(t$jscomp$0)).next(e=>
this.isPrimary&&!e?this.cn(t$jscomp$0).next(()=>!1):!!e&&this.an(t$jscomp$0).next(()=>!0))).catch(t=>{if(Zs(t))return O("IndexedDbPersistence","Failed to extend owner lease: ",t),this.isPrimary;if(!this.allowTabSynchronization)throw t;return O("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1}).then(t=>{this.isPrimary!==t&&this.Me.enqueueRetryable(()=>this.We(t));this.isPrimary=t})}rn(t$jscomp$0){return ri(t$jscomp$0,Ds.store).get(Ds.key).next(t=>zs.resolve(this.un(t)))}hn(t){return ri(t,
qs.store).delete(this.clientId)}ln(){const $jscomp$async$this=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){if($jscomp$async$this.isPrimary&&!$jscomp$async$this.fn($jscomp$async$this.Qe,18E5)){$jscomp$async$this.Qe=Date.now();const t$jscomp$2=yield $jscomp$async$this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t$jscomp$1=>{const e=ri(t$jscomp$1,qs.store);return e.Bt().next(t$jscomp$0=>{const n=$jscomp$async$this.dn(t$jscomp$0,18E5),s=t$jscomp$0.filter(t=>
-1===n.indexOf(t));return zs.forEach(s,t=>e.delete(t.clientId)).next(()=>s)})}).catch(()=>[]);if($jscomp$async$this.Xe)for(const e of t$jscomp$2)$jscomp$async$this.Xe.removeItem($jscomp$async$this.wn(e.clientId))}})}nn(){this.je=this.Me.enqueueAfterDelay("client_metadata_refresh",4E3,()=>this.Ze().then(()=>this.ln()).then(()=>this.nn()))}un(t){return!!t&&t.ownerId===this.clientId}on(t$jscomp$1){return this.Le?zs.resolve(!0):ri(t$jscomp$1,Ds.store).get(Ds.key).next(e=>{if(null!==e&&this.fn(e.leaseTimestampMs,
5E3)&&!this._n(e.ownerId)){if(this.un(e)&&this.networkEnabled)return!0;if(!this.un(e)){if(!e.allowTabSynchronization)throw new Q(j.FAILED_PRECONDITION,"Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.");return!1}}return!(!this.networkEnabled||!this.inForeground)||ri(t$jscomp$1,qs.store).Bt().next(t$jscomp$0=>
void 0===this.dn(t$jscomp$0,5E3).find(t=>{if(this.clientId!==t.clientId){const n=!this.inForeground&&t.inForeground,s=this.networkEnabled===t.networkEnabled;if(!this.networkEnabled&&t.networkEnabled||n&&s)return!0}return!1}))}).next(t=>(this.isPrimary!==t&&O("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){const $jscomp$async$this=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){$jscomp$async$this.Ue=!1;$jscomp$async$this.mn();$jscomp$async$this.je&&
($jscomp$async$this.je.cancel(),$jscomp$async$this.je=null);$jscomp$async$this.gn();$jscomp$async$this.yn();yield $jscomp$async$this.ze.runTransaction("shutdown","readwrite",[Ds.store,qs.store],t=>{const e=new ii(t,nt.I);return $jscomp$async$this.cn(e).next(()=>$jscomp$async$this.hn(e))});$jscomp$async$this.ze.close();$jscomp$async$this.pn()})}dn(t$jscomp$0,e){return t$jscomp$0.filter(t=>this.fn(t.updateTimeMs,e)&&!this._n(t.clientId))}Tn(){return this.runTransaction("getActiveClients","readonly",
t$jscomp$1=>ri(t$jscomp$1,qs.store).Bt().next(t$jscomp$0=>this.dn(t$jscomp$0,18E5).map(t=>t.clientId)))}get started(){return this.Ue}getMutationQueue(t){return Ci.Xt(t,this.k,this.Jt,this.referenceDelegate)}getTargetCache(){return this.He}getRemoteDocumentCache(){return this.Je}getIndexManager(){return this.Jt}getBundleCache(){return this.Ye}runTransaction(t$jscomp$0,e$jscomp$0,n){O("IndexedDbPersistence","Starting transaction:",t$jscomp$0);let i;return this.ze.runTransaction(t$jscomp$0,"readonly"===
e$jscomp$0?"readonly":"readwrite",Qs,s=>(i=new ii(s,this.Be?this.Be.next():nt.I),"readwrite-primary"===e$jscomp$0?this.rn(i).next(t=>!!t||this.on(i)).next(e=>{if(!e)throw M(`Failed to obtain primary lease for action '${t$jscomp$0}'.`),this.isPrimary=!1,this.Me.enqueueRetryable(()=>this.We(!1)),new Q(j.FAILED_PRECONDITION,"The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.");return n(i)}).next(t=>this.an(i).next(()=>t)):this.En(i).next(()=>
n(i)))).then(t=>(i.raiseOnCommittedEvent(),t))}En(t$jscomp$0){return ri(t$jscomp$0,Ds.store).get(Ds.key).next(t=>{if(!(null===t||!this.fn(t.leaseTimestampMs,5E3)||this._n(t.ownerId)||this.un(t)||this.Le||this.allowTabSynchronization&&t.allowTabSynchronization))throw new Q(j.FAILED_PRECONDITION,"Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.");
})}an(t){const e=new Ds(this.clientId,this.allowTabSynchronization,Date.now());return ri(t,Ds.store).put(Ds.key,e)}static Pt(){return Js.Pt()}cn(t$jscomp$0){const e=ri(t$jscomp$0,Ds.store);return e.get(Ds.key).next(t=>this.un(t)?(O("IndexedDbPersistence","Releasing primary lease."),e.delete(Ds.key)):zs.resolve())}fn(t,e){const n=Date.now();return!(t<n-e)&&(!(t>n)||(M(`Detected an update time that is in the future: ${t} > ${n}`),!1))}tn(){null!==this.document&&"function"==typeof this.document.addEventListener&&
(this.Ke=()=>{this.Me.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.Ze()))},this.document.addEventListener("visibilitychange",this.Ke),this.inForeground="visible"===this.document.visibilityState)}gn(){this.Ke&&(this.document.removeEventListener("visibilitychange",this.Ke),this.Ke=null)}en(){var t;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.qe=()=>{this.mn();(0,_util.isSafari)()&&navigator.appVersion.match(/Version\/1[45]/)&&
this.Me.enterRestrictedMode(!0);this.Me.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.qe))}yn(){this.qe&&(this.window.removeEventListener("pagehide",this.qe),this.qe=null)}_n(t$jscomp$0){var e;try{const n=null!==(null===(e=this.Xe)||void 0===e?void 0:e.getItem(this.wn(t$jscomp$0)));return O("IndexedDbPersistence",`Client '${t$jscomp$0}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(t){return M("IndexedDbPersistence","Failed to get zombied client id.",t),
!1}}mn(){if(this.Xe)try{this.Xe.setItem(this.wn(this.clientId),String(Date.now()))}catch(t){M("Failed to set zombie client id.",t)}}pn(){if(this.Xe)try{this.Xe.removeItem(this.wn(this.clientId))}catch(t){}}wn(t){return`firestore_zombie_${this.persistenceKey}_${t}`}}class ar{constructor(t,e){this.progress=t;this.In=e}}class ur{constructor(t,e,n){this.Je=t;this.An=e;this.Jt=n}Rn(t,e){return this.An.getAllMutationBatchesAffectingDocumentKey(t,e).next(n=>this.bn(t,e,n))}bn(t$jscomp$0,e$jscomp$0,n){return this.Je.getEntry(t$jscomp$0,
e$jscomp$0).next(t=>{for(const e of n)e.applyToLocalView(t);return t})}Pn(t$jscomp$1,e){t$jscomp$1.forEach((t$jscomp$0,n)=>{for(const t of e)t.applyToLocalView(n)})}vn(t,e$jscomp$0){return this.Je.getEntries(t,e$jscomp$0).next(e=>this.Vn(t,e).next(()=>e))}Vn(t$jscomp$0,e){return this.An.getAllMutationBatchesAffectingDocumentKeys(t$jscomp$0,e).next(t=>this.Pn(e,t))}getDocumentsMatchingQuery(t,e,n){return Dt.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length?this.Sn(t,e.path):null!==
e.collectionGroup?this.Dn(t,e,n):this.Cn(t,e,n)}Sn(t$jscomp$0,e$jscomp$0){return this.Rn(t$jscomp$0,new Dt(e$jscomp$0)).next(t=>{let e=bn;return t.isFoundDocument()&&(e=e.insert(t.key,t)),e})}Dn(t$jscomp$1,e$jscomp$0,n){const s=e$jscomp$0.collectionGroup;let i=bn;return this.Jt.getCollectionParents(t$jscomp$1,s).next(r$jscomp$0=>zs.forEach(r$jscomp$0,r=>{r=function(t,e){return new me(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e$jscomp$0,r.child(s));
return this.Cn(t$jscomp$1,r,n).next(t$jscomp$0=>{t$jscomp$0.forEach((t,e)=>{i=i.insert(t,e)})})}).next(()=>i))}Cn(t$jscomp$1,e$jscomp$1,n$jscomp$0){let s,i$jscomp$0;return this.Je.getDocumentsMatchingQuery(t$jscomp$1,e$jscomp$1,n$jscomp$0).next(n=>(s=n,this.An.getAllMutationBatchesAffectingQuery(t$jscomp$1,e$jscomp$1))).next(e$jscomp$0=>(i$jscomp$0=e$jscomp$0,this.Nn(t$jscomp$1,i$jscomp$0,s).next(t$jscomp$0=>{s=t$jscomp$0;for(const t of i$jscomp$0)for(const e of t.mutations){t$jscomp$0=e.key;let i=
s.get(t$jscomp$0);null==i&&(i=Gt.newInvalidDocument(t$jscomp$0),s=s.insert(t$jscomp$0,i));en(e,i,t.localWriteTime);i.isFoundDocument()||(s=s.remove(t$jscomp$0))}}))).next(()=>(s.forEach((t,n)=>{De(e$jscomp$1,n)||(s=s.remove(t))}),s))}Nn(t$jscomp$1,e$jscomp$0,n){let s=Dn();for(const t of e$jscomp$0)for(const e of t.mutations)e instanceof cn&&null===n.get(e.key)&&(s=s.add(e.key));let i=n;return this.Je.getEntries(t$jscomp$1,s).next(t$jscomp$0=>(t$jscomp$0.forEach((t,e)=>{e.isFoundDocument()&&(i=i.insert(t,
e))}),i))}}class hr{constructor(t,e,n,s){this.targetId=t;this.fromCache=e;this.kn=n;this.xn=s}static $n(t$jscomp$0,e){let n=Dn(),s=Dn();for(const t of e.docChanges)switch(t.type){case 0:n=n.add(t.doc.key);break;case 1:s=s.add(t.doc.key)}return new hr(t$jscomp$0,e.fromCache,n,s)}}class lr{On(t){this.Mn=t}getDocumentsMatchingQuery(t$jscomp$0,e$jscomp$0,n,s){return 0===e$jscomp$0.filters.length&&null===e$jscomp$0.limit&&null==e$jscomp$0.startAt&&null==e$jscomp$0.endAt&&(0===e$jscomp$0.explicitOrderBy.length||
1===e$jscomp$0.explicitOrderBy.length&&e$jscomp$0.explicitOrderBy[0].field.isKeyField())||n.isEqual(ut.min())?this.Fn(t$jscomp$0,e$jscomp$0):this.Mn.vn(t$jscomp$0,s).next(i=>{const r=this.Ln(e$jscomp$0,i);return(pe(e$jscomp$0)||Te(e$jscomp$0))&&this.Bn(e$jscomp$0.limitType,r,s,n)?this.Fn(t$jscomp$0,e$jscomp$0):(k.logLevel<=_logger.LogLevel.DEBUG&&O("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),Se(e$jscomp$0)),this.Mn.getDocumentsMatchingQuery(t$jscomp$0,e$jscomp$0,
n).next(t=>(r.forEach(e=>{t=t.insert(e.key,e)}),t)))})}Ln(t,e$jscomp$0){let n=new En(Ce(t));return e$jscomp$0.forEach((e,s)=>{De(t,s)&&(n=n.add(s))}),n}Bn(t,e,n,s){if(n.size!==e.size)return!0;t="F"===t?e.last():e.first();return!!t&&(t.hasPendingWrites||0<t.version.compareTo(s))}Fn(t,e){return k.logLevel<=_logger.LogLevel.DEBUG&&O("QueryEngine","Using full collection scan to execute query:",Se(e)),this.Mn.getDocumentsMatchingQuery(t,e,ut.min())}}class fr{constructor(t$jscomp$0,e,n,s){this.persistence=
t$jscomp$0;this.Un=e;this.k=s;this.qn=new yn(rt);this.Kn=new zi(t=>Jt(t),Xt);this.jn=ut.min();this.An=t$jscomp$0.getMutationQueue(n);this.Qn=t$jscomp$0.getRemoteDocumentCache();this.He=t$jscomp$0.getTargetCache();this.Wn=new ur(this.Qn,this.An,this.persistence.getIndexManager());this.Ye=t$jscomp$0.getBundleCache();this.Un.On(this.Wn)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.qn))}}class Vr{constructor(t){this.k=t;this.Xn=new Map;
this.Zn=new Map}getBundleMetadata(t,e){return zs.resolve(this.Xn.get(e))}saveBundleMetadata(t,e){return this.Xn.set(e.id,{id:e.id,version:e.version,createTime:zn(e.createTime)}),zs.resolve()}getNamedQuery(t,e){return zs.resolve(this.Zn.get(e))}saveNamedQuery(t,e){t=this.Zn;var JSCompiler_temp_const=t.set,JSCompiler_temp_const$jscomp$0=e.name;e={name:e.name,query:pi(e.bundledQuery),readTime:zn(e.readTime)};return JSCompiler_temp_const.call(t,JSCompiler_temp_const$jscomp$0,e),zs.resolve()}}class Sr{constructor(){this.ts=
new En(Dr.es);this.ns=new En(Dr.ss)}isEmpty(){return this.ts.isEmpty()}addReference(t,e){t=new Dr(t,e);this.ts=this.ts.add(t);this.ns=this.ns.add(t)}rs(t$jscomp$0,e){t$jscomp$0.forEach(t=>this.addReference(t,e))}removeReference(t,e){this.os(new Dr(t,e))}cs(t$jscomp$0,e){t$jscomp$0.forEach(t=>this.removeReference(t,e))}us(t$jscomp$0){const e=new Dt(new wt([])),n=new Dr(e,t$jscomp$0);t$jscomp$0=new Dr(e,t$jscomp$0+1);const i=[];return this.ns.forEachInRange([n,t$jscomp$0],t=>{this.os(t);i.push(t.key)}),
i}hs(){this.ts.forEach(t=>this.os(t))}os(t){this.ts=this.ts.delete(t);this.ns=this.ns.delete(t)}ls(t$jscomp$0){const e=new Dt(new wt([])),n=new Dr(e,t$jscomp$0);t$jscomp$0=new Dr(e,t$jscomp$0+1);let i=Dn();return this.ns.forEachInRange([n,t$jscomp$0],t=>{i=i.add(t.key)}),i}containsKey(t){var e=new Dr(t,0);e=this.ts.firstAfterOrEqual(e);return null!==e&&t.isEqual(e.key)}}class Dr{constructor(t,e){this.key=t;this.fs=e}static es(t,e){return Dt.comparator(t.key,e.key)||rt(t.fs,e.fs)}static ss(t,e){return rt(t.fs,
e.fs)||Dt.comparator(t.key,e.key)}}class Cr{constructor(t,e){this.Jt=t;this.referenceDelegate=e;this.An=[];this.ds=1;this.ws=new En(Dr.es)}checkEmpty(t){return zs.resolve(0===this.An.length)}addMutationBatch(t,e$jscomp$0,n,s){const i=this.ds;this.ds++;0<this.An.length&&this.An[this.An.length-1];e$jscomp$0=new oi(i,e$jscomp$0,n,s);this.An.push(e$jscomp$0);for(const e of s)this.ws=this.ws.add(new Dr(e.key,i)),this.Jt.addToCollectionParentIndex(t,e.key.path.popLast());return zs.resolve(e$jscomp$0)}lookupMutationBatch(t,
e){return zs.resolve(this._s(e))}getNextMutationBatchAfterBatchId(t,e){t=this.gs(e+1);t=0>t?0:t;return zs.resolve(this.An.length>t?this.An[t]:null)}getHighestUnacknowledgedBatchId(){return zs.resolve(0===this.An.length?-1:this.ds-1)}getAllMutationBatches(t){return zs.resolve(this.An.slice())}getAllMutationBatchesAffectingDocumentKey(t$jscomp$0,e){t$jscomp$0=new Dr(e,0);e=new Dr(e,Number.POSITIVE_INFINITY);const i=[];return this.ws.forEachInRange([t$jscomp$0,e],t=>{t=this._s(t.fs);i.push(t)}),zs.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(t$jscomp$1,
e$jscomp$0){let n=new En(rt);return e$jscomp$0.forEach(t$jscomp$0=>{const e=new Dr(t$jscomp$0,0);t$jscomp$0=new Dr(t$jscomp$0,Number.POSITIVE_INFINITY);this.ws.forEachInRange([e,t$jscomp$0],t=>{n=n.add(t.fs)})}),zs.resolve(this.ys(n))}getAllMutationBatchesAffectingQuery(t$jscomp$0,e$jscomp$0){const n=e$jscomp$0.path,s=n.length+1;t$jscomp$0=n;Dt.isDocumentKey(t$jscomp$0)||(t$jscomp$0=t$jscomp$0.child(""));t$jscomp$0=new Dr(new Dt(t$jscomp$0),0);let o=new En(rt);return this.ws.forEachWhile(t=>{const e=
t.key.path;return!!n.isPrefixOf(e)&&(e.length===s&&(o=o.add(t.fs)),!0)},t$jscomp$0),zs.resolve(this.ys(o))}ys(t$jscomp$0){const e=[];return t$jscomp$0.forEach(t=>{t=this._s(t);null!==t&&e.push(t)}),e}removeMutationBatch(t,e){U(0===this.ps(e.batchId,"removed"));this.An.shift();let n=this.ws;return zs.forEach(e.mutations,s=>{const i=new Dr(s.key,e.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(t,s.key)}).next(()=>{this.ws=n})}ee(t){}containsKey(t,e){t=new Dr(e,0);t=this.ws.firstAfterOrEqual(t);
return zs.resolve(e.isEqual(t&&t.key))}performConsistencyCheck(t){return this.An.length,zs.resolve()}ps(t,e){return this.gs(t)}gs(t){return 0===this.An.length?0:t-this.An[0].batchId}_s(t){t=this.gs(t);return 0>t||t>=this.An.length?null:this.An[t]}}class Nr{constructor(t,e){this.Jt=t;this.Ts=e;this.docs=new yn(Dt.comparator);this.size=0}addEntry(t,e,n){const s=e.key;var i=this.docs.get(s);i=i?i.size:0;const o=this.Ts(e);return this.docs=this.docs.insert(s,{document:e.mutableCopy(),size:o,readTime:n}),
this.size+=o-i,this.Jt.addToCollectionParentIndex(t,s.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){t=this.docs.get(e);return zs.resolve(t?t.document.mutableCopy():Gt.newInvalidDocument(e))}getEntries(t$jscomp$0,e$jscomp$0){let n=An;return e$jscomp$0.forEach(t=>{const e=this.docs.get(t);n=n.insert(t,e?e.document.mutableCopy():Gt.newInvalidDocument(t))}),zs.resolve(n)}getDocumentsMatchingQuery(t$jscomp$0,e,n){t$jscomp$0=An;
var i$jscomp$0=new Dt(e.path.child(""));for(i$jscomp$0=this.docs.getIteratorFrom(i$jscomp$0);i$jscomp$0.hasNext();){const {key:t,value:{document:i,readTime:o}}=i$jscomp$0.getNext();if(!e.path.isPrefixOf(t.path))break;0>=o.compareTo(n)||De(e,i)&&(t$jscomp$0=t$jscomp$0.insert(i.key,i.mutableCopy()))}return zs.resolve(t$jscomp$0)}Es(t$jscomp$0,e){return zs.forEach(this.docs,t=>e(t))}newChangeBuffer(t){return new kr(this)}getSize(t){return zs.resolve(this.size)}}class kr extends Hi{constructor(t){super();
this.De=t}applyChanges(t){const e=[];return this.changes.forEach((n,s)=>{s.document.isValidDocument()?e.push(this.De.addEntry(t,s.document,this.getReadTime(n))):this.De.removeEntry(n)}),zs.waitFor(e)}getFromCache(t,e){return this.De.getEntry(t,e)}getAllFromCache(t,e){return this.De.getEntries(t,e)}}class xr{constructor(t$jscomp$0){this.persistence=t$jscomp$0;this.Is=new zi(t=>Jt(t),Xt);this.lastRemoteSnapshotVersion=ut.min();this.As=this.highestTargetId=0;this.Rs=new Sr;this.targetCount=0;this.bs=
Oi.ie()}forEachTarget(t$jscomp$0,e){return this.Is.forEach((t,n)=>e(n)),zs.resolve()}getLastRemoteSnapshotVersion(t){return zs.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return zs.resolve(this.As)}allocateTargetId(t){return this.highestTargetId=this.bs.next(),zs.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.As&&(this.As=e),zs.resolve()}ae(t){this.Is.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.bs=
new Oi(e),this.highestTargetId=e);t.sequenceNumber>this.As&&(this.As=t.sequenceNumber)}addTargetData(t,e){return this.ae(e),this.targetCount+=1,zs.resolve()}updateTargetData(t,e){return this.ae(e),zs.resolve()}removeTargetData(t,e){return this.Is.delete(e.target),this.Rs.us(e.targetId),--this.targetCount,zs.resolve()}removeTargets(t,e,n){let s=0;const i=[];return this.Is.forEach((r,o)=>{o.sequenceNumber<=e&&null===n.get(o.targetId)&&(this.Is.delete(r),i.push(this.removeMatchingKeysForTargetId(t,o.targetId)),
s++)}),zs.waitFor(i).next(()=>s)}getTargetCount(t){return zs.resolve(this.targetCount)}getTargetData(t,e){t=this.Is.get(e)||null;return zs.resolve(t)}addMatchingKeys(t,e,n){return this.Rs.rs(e,n),zs.resolve()}removeMatchingKeys(t,e$jscomp$0,n){this.Rs.cs(e$jscomp$0,n);const s=this.persistence.referenceDelegate,i=[];return s&&e$jscomp$0.forEach(e=>{i.push(s.markPotentiallyOrphaned(t,e))}),zs.waitFor(i)}removeMatchingKeysForTargetId(t,e){return this.Rs.us(e),zs.resolve()}getMatchingKeysForTargetId(t,
e){t=this.Rs.ls(e);return zs.resolve(t)}containsKey(t,e){return zs.resolve(this.Rs.containsKey(e))}}class $r{constructor(t$jscomp$0,e$jscomp$0){this.Ps={};this.Be=new nt(0);this.Ue=!1;this.Ue=!0;this.referenceDelegate=t$jscomp$0(this);this.He=new xr(this);this.Jt=new Ai;this.Je=function(t,e){return new Nr(t,e)}(this.Jt,t=>this.referenceDelegate.vs(t));this.k=new ui(e$jscomp$0);this.Ye=new Vr(this.k)}start(){return Promise.resolve()}shutdown(){return this.Ue=!1,Promise.resolve()}get started(){return this.Ue}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(){return this.Jt}getMutationQueue(t){let e=
this.Ps[t.toKey()];return e||(e=new Cr(this.Jt,this.referenceDelegate),this.Ps[t.toKey()]=e),e}getTargetCache(){return this.He}getRemoteDocumentCache(){return this.Je}getBundleCache(){return this.Ye}runTransaction(t$jscomp$0,e,n){O("MemoryPersistence","Starting transaction:",t$jscomp$0);const s=new Or(this.Be.next());return this.referenceDelegate.Vs(),n(s).next(t=>this.referenceDelegate.Ss(s).next(()=>t)).toPromise().then(t=>(s.raiseOnCommittedEvent(),t))}Ds(t,e){return zs.or(Object.values(this.Ps).map(n=>
()=>n.containsKey(t,e)))}}class Or extends Gs{constructor(t){super();this.currentSequenceNumber=t}}class Mr{constructor(t){this.persistence=t;this.Cs=new Sr;this.Ns=null}static ks(t){return new Mr(t)}get xs(){if(this.Ns)return this.Ns;throw B();}addReference(t,e,n){return this.Cs.addReference(n,e),this.xs.delete(n.toString()),zs.resolve()}removeReference(t,e,n){return this.Cs.removeReference(n,e),this.xs.add(n.toString()),zs.resolve()}markPotentiallyOrphaned(t,e){return this.xs.add(e.toString()),
zs.resolve()}removeTarget(t$jscomp$1,e){this.Cs.us(e.targetId).forEach(t=>this.xs.add(t.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t$jscomp$1,e.targetId).next(t$jscomp$0=>{t$jscomp$0.forEach(t=>this.xs.add(t.toString()))}).next(()=>n.removeTargetData(t$jscomp$1,e))}Vs(){this.Ns=new Set}Ss(t$jscomp$0){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return zs.forEach(this.xs,n=>{const s=Dt.fromPath(n);return this.$s(t$jscomp$0,s).next(t=>
{t||e.removeEntry(s)})}).next(()=>(this.Ns=null,e.apply(t$jscomp$0)))}updateLimboDocument(t$jscomp$0,e){return this.$s(t$jscomp$0,e).next(t=>{t?this.xs.delete(e.toString()):this.xs.add(e.toString())})}vs(t){return 0}$s(t,e){return zs.or([()=>zs.resolve(this.Cs.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Ds(t,e)])}}class Ur{constructor(t,e,n,s){this.user=t;this.batchId=e;this.state=n;this.error=s}static Os(t,e,n){const s=JSON.parse(n);let i,r="object"==
typeof s&&-1!==["pending","acknowledged","rejected"].indexOf(s.state)&&(void 0===s.error||"object"==typeof s.error);return r&&s.error&&(r="string"==typeof s.error.message&&"string"==typeof s.error.code,r&&(i=new Q(s.error.code,s.error.message))),r?new Ur(t,e,s.state,i):(M("SharedClientState",`Failed to parse mutation state for ID '${e}': ${n}`),null)}Ms(){const t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}}
class qr{constructor(t,e,n){this.targetId=t;this.state=e;this.error=n}static Os(t,e){const n=JSON.parse(e);let s,i="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return i&&n.error&&(i="string"==typeof n.error.message&&"string"==typeof n.error.code,i&&(s=new Q(n.error.code,n.error.message))),i?new qr(t,n.state,s):(M("SharedClientState",`Failed to parse target state for ID '${t}': ${e}`),null)}Ms(){const t={state:this.state,
updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}}class Kr{constructor(t,e){this.clientId=t;this.activeTargetIds=e}static Os(t$jscomp$0,e){const n=JSON.parse(e);let s="object"==typeof n&&n.activeTargetIds instanceof Array,i=Cn;for(let t=0;s&&t<n.activeTargetIds.length;++t)s=St(n.activeTargetIds[t]),i=i.add(n.activeTargetIds[t]);return s?new Kr(t$jscomp$0,i):(M("SharedClientState",`Failed to parse client data for instance '${t$jscomp$0}': ${e}`),
null)}}class jr{constructor(t,e){this.clientId=t;this.onlineState=e}static Os(t){const e=JSON.parse(t);return"object"==typeof e&&-1!==["Unknown","Online","Offline"].indexOf(e.onlineState)&&"string"==typeof e.clientId?new jr(e.clientId,e.onlineState):(M("SharedClientState",`Failed to parse online state: ${t}`),null)}}class Qr{constructor(){this.activeTargetIds=Cn}Fs(t){this.activeTargetIds=this.activeTargetIds.add(t)}Ls(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Ms(){const t={activeTargetIds:this.activeTargetIds.toArray(),
updateTimeMs:Date.now()};return JSON.stringify(t)}}class Wr{constructor(t,e,n,s,i){this.window=t;this.Me=e;this.persistenceKey=n;this.Bs=s;this.sequenceNumberHandler=this.onlineStateHandler=this.syncEngine=null;this.Us=this.qs.bind(this);this.Ks=new yn(rt);this.started=!1;this.js=[];t=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$\x26");this.storage=this.window.localStorage;this.currentUser=i;this.Qs=`firestore_clients_${this.persistenceKey}_${this.Bs}`;this.Ws=`firestore_sequence_number_${this.persistenceKey}`;
this.Ks=this.Ks.insert(this.Bs,new Qr);this.Gs=new RegExp(`^firestore_clients_${t}_([^_]*)$`);this.zs=new RegExp(`^firestore_mutations_${t}_(\\d+)(?:_(.*))?$`);this.Hs=new RegExp(`^firestore_targets_${t}_(\\d+)$`);this.Js=`firestore_online_state_${this.persistenceKey}`;this.Ys=`firestore_bundle_loaded_${this.persistenceKey}`;this.window.addEventListener("storage",this.Us)}static Pt(t){return!(!t||!t.localStorage)}start(){const $jscomp$async$this=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){var t$jscomp$0=
yield $jscomp$async$this.syncEngine.Tn();for(var e of t$jscomp$0)e!==$jscomp$async$this.Bs&&(t$jscomp$0=$jscomp$async$this.getItem(`firestore_clients_${$jscomp$async$this.persistenceKey}_${e}`))&&(t$jscomp$0=Kr.Os(e,t$jscomp$0))&&($jscomp$async$this.Ks=$jscomp$async$this.Ks.insert(t$jscomp$0.clientId,t$jscomp$0));$jscomp$async$this.Xs();(e=$jscomp$async$this.storage.getItem($jscomp$async$this.Js))&&(e=$jscomp$async$this.Zs(e))&&$jscomp$async$this.ti(e);for(const t of $jscomp$async$this.js)$jscomp$async$this.qs(t);
$jscomp$async$this.js=[];$jscomp$async$this.window.addEventListener("pagehide",()=>$jscomp$async$this.shutdown());$jscomp$async$this.started=!0})}writeSequenceNumber(t){this.setItem(this.Ws,JSON.stringify(t))}getAllActiveQueryTargets(){return this.ei(this.Ks)}isActiveQueryTarget(t){let e=!1;return this.Ks.forEach((n,s)=>{s.activeTargetIds.has(t)&&(e=!0)}),e}addPendingMutation(t){this.ni(t,"pending")}updateMutationState(t,e,n){this.ni(t,e,n);this.si(t)}addLocalQueryTarget(t){let e="not-current";if(this.isActiveQueryTarget(t)){var n=
this.storage.getItem(Br(this.persistenceKey,t));n&&(n=qr.Os(t,n))&&(e=n.state)}return this.ii.Fs(t),this.Xs(),e}removeLocalQueryTarget(t){this.ii.Ls(t);this.Xs()}isLocalQueryTarget(t){return this.ii.activeTargetIds.has(t)}clearQueryState(t){this.removeItem(Br(this.persistenceKey,t))}updateQueryState(t,e,n){this.ri(t,e,n)}handleUserChange(t$jscomp$0,e,n){e.forEach(t=>{this.si(t)});this.currentUser=t$jscomp$0;n.forEach(t=>{this.addPendingMutation(t)})}setOnlineState(t){this.oi(t)}notifyBundleLoaded(){this.ci()}shutdown(){this.started&&
(this.window.removeEventListener("storage",this.Us),this.removeItem(this.Qs),this.started=!1)}getItem(t){const e=this.storage.getItem(t);return O("SharedClientState","READ",t,e),e}setItem(t,e){O("SharedClientState","SET",t,e);this.storage.setItem(t,e)}removeItem(t){O("SharedClientState","REMOVE",t);this.storage.removeItem(t)}qs(t$jscomp$1){if(t$jscomp$1.storageArea===this.storage){if(O("SharedClientState","EVENT",t$jscomp$1.key,t$jscomp$1.newValue),t$jscomp$1.key===this.Qs)return void M("Received WebStorage notification for local change. Another client might have garbage-collected our state");
this.Me.enqueueRetryable(()=>{const $jscomp$async$this=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){if($jscomp$async$this.started){if(null!==t$jscomp$1.key)if($jscomp$async$this.Gs.test(t$jscomp$1.key)){if(null==t$jscomp$1.newValue){var t$jscomp$0=$jscomp$async$this.ai(t$jscomp$1.key);return $jscomp$async$this.ui(t$jscomp$0,null)}if(t$jscomp$0=$jscomp$async$this.hi(t$jscomp$1.key,t$jscomp$1.newValue))return $jscomp$async$this.ui(t$jscomp$0.clientId,t$jscomp$0)}else if($jscomp$async$this.zs.test(t$jscomp$1.key)){if(null!==
t$jscomp$1.newValue&&(t$jscomp$0=$jscomp$async$this.li(t$jscomp$1.key,t$jscomp$1.newValue)))return $jscomp$async$this.fi(t$jscomp$0)}else if($jscomp$async$this.Hs.test(t$jscomp$1.key)){if(null!==t$jscomp$1.newValue&&(t$jscomp$0=$jscomp$async$this.di(t$jscomp$1.key,t$jscomp$1.newValue)))return $jscomp$async$this.wi(t$jscomp$0)}else if(t$jscomp$1.key===$jscomp$async$this.Js){if(null!==t$jscomp$1.newValue&&(t$jscomp$0=$jscomp$async$this.Zs(t$jscomp$1.newValue)))return $jscomp$async$this.ti(t$jscomp$0)}else if(t$jscomp$1.key===
$jscomp$async$this.Ws){t$jscomp$0=t$jscomp$1.newValue;let e=nt.I;if(null!=t$jscomp$0)try{const n=JSON.parse(t$jscomp$0);"number"==typeof n||B();e=n}catch(t){M("SharedClientState","Failed to read sequence number from WebStorage",t)}t$jscomp$0=e;t$jscomp$0!==nt.I&&$jscomp$async$this.sequenceNumberHandler(t$jscomp$0)}else if(t$jscomp$1.key===$jscomp$async$this.Ys)return $jscomp$async$this.syncEngine._i()}else $jscomp$async$this.js.push(t$jscomp$1)})})}}get ii(){return this.Ks.get(this.Bs)}Xs(){this.setItem(this.Qs,
this.ii.Ms())}ni(t,e,n){e=new Ur(this.currentUser,t,e,n);t=Lr(this.persistenceKey,this.currentUser,t);this.setItem(t,e.Ms())}si(t){t=Lr(this.persistenceKey,this.currentUser,t);this.removeItem(t)}oi(t){this.storage.setItem(this.Js,JSON.stringify({clientId:this.Bs,onlineState:t}))}ri(t,e,n){const s=Br(this.persistenceKey,t);t=new qr(t,e,n);this.setItem(s,t.Ms())}ci(){this.setItem(this.Ys,"value-not-used")}ai(t){return(t=this.Gs.exec(t))?t[1]:null}hi(t,e){t=this.ai(t);return Kr.Os(t,e)}li(t,e){t=this.zs.exec(t);
const s=Number(t[1]);return Ur.Os(new C(void 0!==t[2]?t[2]:null),s,e)}di(t,e){t=this.Hs.exec(t);return qr.Os(Number(t[1]),e)}Zs(t){return jr.Os(t)}fi(t){const $jscomp$async$this=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){if(t.user.uid===$jscomp$async$this.currentUser.uid)return $jscomp$async$this.syncEngine.mi(t.batchId,t.state,t.error);O("SharedClientState",`Ignoring mutation for non-active user ${t.user.uid}`)})}wi(t){return this.syncEngine.gi(t.targetId,t.state,t.error)}ui(t$jscomp$0,
e){const n=e?this.Ks.insert(t$jscomp$0,e):this.Ks.remove(t$jscomp$0),s=this.ei(this.Ks),i=this.ei(n),r=[],o=[];return i.forEach(t=>{s.has(t)||r.push(t)}),s.forEach(t=>{i.has(t)||o.push(t)}),this.syncEngine.yi(r,o).then(()=>{this.Ks=n})}ti(t){this.Ks.get(t.clientId)&&this.onlineStateHandler(t.onlineState)}ei(t$jscomp$0){let e=Cn;return t$jscomp$0.forEach((t,n)=>{e=e.unionWith(n.activeTargetIds)}),e}}class Gr{constructor(){this.pi=new Qr;this.Ti={};this.sequenceNumberHandler=this.onlineStateHandler=
null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t){return this.pi.Fs(t),this.Ti[t]||"not-current"}updateQueryState(t,e,n){this.Ti[t]=e}removeLocalQueryTarget(t){this.pi.Ls(t)}isLocalQueryTarget(t){return this.pi.activeTargetIds.has(t)}clearQueryState(t){delete this.Ti[t]}getAllActiveQueryTargets(){return this.pi.activeTargetIds}isActiveQueryTarget(t){return this.pi.activeTargetIds.has(t)}start(){return this.pi=new Qr,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(){}}
class zr{Ei(t){}shutdown(){}}class Hr{constructor(){this.Ii=()=>this.Ai();this.Ri=()=>this.bi();this.Pi=[];this.vi()}Ei(t){this.Pi.push(t)}shutdown(){window.removeEventListener("online",this.Ii);window.removeEventListener("offline",this.Ri)}vi(){window.addEventListener("online",this.Ii);window.addEventListener("offline",this.Ri)}Ai(){O("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.Pi)t(0)}bi(){O("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");
for(const t of this.Pi)t(1)}static Pt(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const Jr={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};class Yr{constructor(t){this.Vi=t.Vi;this.Si=t.Si}Di(t){this.Ci=t}Ni(t){this.ki=t}onMessage(t){this.xi=t}close(){this.Si()}send(t){this.Vi(t)}$i(){this.Ci()}Oi(t){this.ki(t)}Mi(t){this.xi(t)}}class Xr extends class{constructor(t){this.databaseInfo=t;this.databaseId=t.databaseId;this.Fi=
(t.ssl?"https":"http")+"://"+t.host;this.Li="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}Bi(t$jscomp$0,e$jscomp$0,n,s,i){const r=this.Ui(t$jscomp$0,e$jscomp$0);O("RestConnection","Sending: ",r,n);e$jscomp$0={};return this.qi(e$jscomp$0,s,i),this.Ki(t$jscomp$0,r,e$jscomp$0,n).then(t=>(O("RestConnection","Received: ",t),t),e=>{throw F("RestConnection",`${t$jscomp$0} failed with error: `,e,"url: ",r,"request:",n),e;})}ji(t,e,n,s,i){return this.Bi(t,e,n,s,
i)}qi(t,e$jscomp$0,n$jscomp$0){t["X-Goog-Api-Client"]="gl-js/ fire/"+N;t["Content-Type"]="text/plain";this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId);e$jscomp$0&&e$jscomp$0.headers.forEach((e,n)=>t[n]=e);n$jscomp$0&&n$jscomp$0.headers.forEach((e,n)=>t[n]=e)}Ui(t,e){return`${this.Fi}/v1/${e}:${Jr[t]}`}}{constructor(t){super(t);this.forceLongPolling=t.forceLongPolling;this.autoDetectLongPolling=t.autoDetectLongPolling;this.useFetchStreams=t.useFetchStreams}Ki(t$jscomp$0,e$jscomp$1,
n$jscomp$0,s){return new Promise((i,r)=>{const o=new _webchannelWrapper.XhrIo;o.listenOnce(_webchannelWrapper.EventType.COMPLETE,()=>{try{switch(o.getLastErrorCode()){case _webchannelWrapper.ErrorCode.NO_ERROR:const e$jscomp$0=o.getResponseJson();O("Connection","XHR received:",JSON.stringify(e$jscomp$0));i(e$jscomp$0);break;case _webchannelWrapper.ErrorCode.TIMEOUT:O("Connection",'RPC "'+t$jscomp$0+'" timed out');r(new Q(j.DEADLINE_EXCEEDED,"Request time out"));break;case _webchannelWrapper.ErrorCode.HTTP_ERROR:const n=
o.getStatus();if(O("Connection",'RPC "'+t$jscomp$0+'" failed with status:',n,"response text:",o.getResponseText()),0<n){const t=o.getResponseJson().error;if(t&&t.status&&t.message){const e=t.status.toLowerCase().replace(/_/g,"-");var JSCompiler_inline_result=0<=Object.values(j).indexOf(e)?e:j.UNKNOWN;r(new Q(JSCompiler_inline_result,t.message))}else r(new Q(j.UNKNOWN,"Server responded with status "+o.getStatus()))}else r(new Q(j.UNAVAILABLE,"Connection failed."));break;default:B()}}finally{O("Connection",
'RPC "'+t$jscomp$0+'" completed.')}});const c=JSON.stringify(s);o.send(e$jscomp$1,"POST",c,n$jscomp$0,15)})}Qi(t$jscomp$2,e$jscomp$0,n$jscomp$1){const s=[this.Fi,"/","google.firestore.v1.Firestore","/",t$jscomp$2,"/channel"],i=(0,_webchannelWrapper.createWebChannelTransport)();t$jscomp$2=(0,_webchannelWrapper.getStatEventTarget)();const o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},
sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6E5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(o.xmlHttpFactory=new _webchannelWrapper.FetchXmlHttpFactory({}));this.qi(o.initMessageHeaders,e$jscomp$0,n$jscomp$1);(0,_util.isMobileCordova)()||(0,_util.isReactNative)()||(0,_util.isElectron)()||(0,_util.isIE)()||(0,_util.isUWP)()||(0,_util.isBrowserExtension)()||(o.httpHeadersOverwriteParam=
"$httpHeaders");e$jscomp$0=s.join("");O("Connection","Creating WebChannel: "+e$jscomp$0,o);const a=i.createWebChannel(e$jscomp$0,o);let u=!1,h=!1;const l=new Yr({Vi:t=>{h?O("Connection","Not sending because WebChannel is closed:",t):(u||(O("Connection","Opening WebChannel transport."),a.open(),u=!0),O("Connection","WebChannel sending:",t),a.send(t))},Si:()=>a.close()});e$jscomp$0=(t$jscomp$1,e,n)=>{t$jscomp$1.listen(e,t$jscomp$0=>{try{n(t$jscomp$0)}catch(t){setTimeout(()=>{throw t;},0)}})};return e$jscomp$0(a,
_webchannelWrapper.WebChannel.EventType.OPEN,()=>{h||O("Connection","WebChannel transport opened.")}),e$jscomp$0(a,_webchannelWrapper.WebChannel.EventType.CLOSE,()=>{h||(h=!0,O("Connection","WebChannel transport closed"),l.Oi())}),e$jscomp$0(a,_webchannelWrapper.WebChannel.EventType.ERROR,t=>{h||(h=!0,F("Connection","WebChannel transport errored:",t),l.Oi(new Q(j.UNAVAILABLE,"The operation could not be completed")))}),e$jscomp$0(a,_webchannelWrapper.WebChannel.EventType.MESSAGE,t=>{var e;if(!h){var n$jscomp$0=
t.data[0];n$jscomp$0||B();if(t=n$jscomp$0.error||(null===(e=n$jscomp$0[0])||void 0===e?void 0:e.error)){O("Connection","WebChannel received error:",t);e=t.status;n$jscomp$0=wn[e];n$jscomp$0=void 0!==n$jscomp$0?gn(n$jscomp$0):void 0;let n=t.message;void 0===n$jscomp$0&&(n$jscomp$0=j.INTERNAL,n="Unknown error status: "+e+" with message "+t.message);h=!0;l.Oi(new Q(n$jscomp$0,n));a.close()}else O("Connection","WebChannel received:",n$jscomp$0),l.Mi(n$jscomp$0)}}),e$jscomp$0(t$jscomp$2,_webchannelWrapper.Event.STAT_EVENT,
t=>{t.stat===_webchannelWrapper.Stat.PROXY?O("Connection","Detected buffering proxy"):t.stat===_webchannelWrapper.Stat.NOPROXY&&O("Connection","Detected no buffering proxy")}),setTimeout(()=>{l.$i()},0),l}}class no{constructor(t,e,n=1E3,s=1.5,i=6E4){this.Me=t;this.timerId=e;this.Wi=n;this.Gi=s;this.zi=i;this.Hi=0;this.Ji=null;this.Yi=Date.now();this.reset()}reset(){this.Hi=0}Xi(){this.Hi=this.zi}Zi(t){this.cancel();const e=Math.floor(this.Hi+this.tr()),n=Math.max(0,Date.now()-this.Yi),s=Math.max(0,
e-n);0<s&&O("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Hi} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`);this.Ji=this.Me.enqueueAfterDelay(this.timerId,s,()=>(this.Yi=Date.now(),t()));this.Hi*=this.Gi;this.Hi<this.Wi&&(this.Hi=this.Wi);this.Hi>this.zi&&(this.Hi=this.zi)}er(){null!==this.Ji&&(this.Ji.skipDelay(),this.Ji=null)}cancel(){null!==this.Ji&&(this.Ji.cancel(),this.Ji=null)}tr(){return(Math.random()-.5)*this.Hi}}class so{constructor(t,e,n,s,i,r,o,c){this.Me=
t;this.nr=n;this.sr=s;this.ir=i;this.authCredentialsProvider=r;this.appCheckCredentialsProvider=o;this.listener=c;this.rr=this.state=0;this.stream=this.ar=this.cr=null;this.ur=new no(t,e)}hr(){return 1===this.state||5===this.state||this.lr()}lr(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.dr()}stop(){const $jscomp$async$this=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){$jscomp$async$this.hr()&&(yield $jscomp$async$this.close(0))})}wr(){this.state=
0;this.ur.reset()}_r(){this.lr()&&null===this.cr&&(this.cr=this.Me.enqueueAfterDelay(this.nr,6E4,()=>this.mr()))}gr(t){this.yr();this.stream.send(t)}mr(){const $jscomp$async$this=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){if($jscomp$async$this.lr())return $jscomp$async$this.close(0)})}yr(){this.cr&&(this.cr.cancel(),this.cr=null)}pr(){this.ar&&(this.ar.cancel(),this.ar=null)}close(t,e){const $jscomp$async$this=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){$jscomp$async$this.yr();
$jscomp$async$this.pr();$jscomp$async$this.ur.cancel();$jscomp$async$this.rr++;4!==t?$jscomp$async$this.ur.reset():e&&e.code===j.RESOURCE_EXHAUSTED?(M(e.toString()),M("Using maximum backoff delay to prevent overloading the backend."),$jscomp$async$this.ur.Xi()):e&&e.code===j.UNAUTHENTICATED&&3!==$jscomp$async$this.state&&($jscomp$async$this.authCredentialsProvider.invalidateToken(),$jscomp$async$this.appCheckCredentialsProvider.invalidateToken());null!==$jscomp$async$this.stream&&($jscomp$async$this.Tr(),
$jscomp$async$this.stream.close(),$jscomp$async$this.stream=null);$jscomp$async$this.state=t;yield $jscomp$async$this.listener.Ni(e)})}Tr(){}auth(){this.state=1;const t$jscomp$0=this.Er(this.rr),e$jscomp$0=this.rr;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([t,n])=>{this.rr===e$jscomp$0&&this.Ir(t,n)},e=>{t$jscomp$0(()=>{const t=new Q(j.UNKNOWN,"Fetching auth token failed: "+e.message);return this.Ar(t)})})}Ir(t$jscomp$0,e){const n=this.Er(this.rr);
this.stream=this.Rr(t$jscomp$0,e);this.stream.Di(()=>{n(()=>(this.state=2,this.ar=this.Me.enqueueAfterDelay(this.sr,1E4,()=>(this.lr()&&(this.state=3),Promise.resolve())),this.listener.Di()))});this.stream.Ni(t=>{n(()=>this.Ar(t))});this.stream.onMessage(t=>{n(()=>this.onMessage(t))})}dr(){this.state=5;this.ur.Zi(()=>{const $jscomp$async$this=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){$jscomp$async$this.state=0;$jscomp$async$this.start()})})}Ar(t){return O("PersistentStream",
`close with error: ${t}`),this.stream=null,this.close(4,t)}Er(t){return e=>{this.Me.enqueueAndForget(()=>this.rr===t?e():(O("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class io extends so{constructor(t,e,n,s,i,r){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,s,r);this.k=i}Rr(t,e){return this.ir.Qi("Listen",t,e)}onMessage(t){this.ur.reset();const e=os(this.k,t);"targetChange"in t?(t=t.targetChange,t=
t.targetIds&&t.targetIds.length?ut.min():t.readTime?zn(t.readTime):ut.min()):t=ut.min();return this.listener.br(e,t)}Pr(t$jscomp$0){const e={};e.database=es(this.k);var t=this.k;let n;var JSCompiler_inline_result=t$jscomp$0.target;JSCompiler_inline_result=(n=Zt(JSCompiler_inline_result)?{documents:{documents:[Zn(t,JSCompiler_inline_result.path)]}}:{query:ls(t,JSCompiler_inline_result)},n.targetId=t$jscomp$0.targetId,0<t$jscomp$0.resumeToken.approximateByteSize()?n.resumeToken=Wn(t,t$jscomp$0.resumeToken):
0<t$jscomp$0.snapshotVersion.compareTo(ut.min())&&(n.readTime=Qn(t,t$jscomp$0.snapshotVersion.toTimestamp())),n);e.addTarget=JSCompiler_inline_result;(t$jscomp$0=ds(this.k,t$jscomp$0))&&(e.labels=t$jscomp$0);this.gr(e)}vr(t){const e={};e.database=es(this.k);e.removeTarget=t;this.gr(e)}}class ro extends so{constructor(t,e,n,s,i,r){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,n,s,r);this.k=i;this.Vr=!1}get Sr(){return this.Vr}start(){this.Vr=!1;this.lastStreamToken=
void 0;super.start()}Tr(){this.Vr&&this.Dr([])}Rr(t,e){return this.ir.Qi("Write",t,e)}onMessage(t){t.streamToken||B();if(this.lastStreamToken=t.streamToken,this.Vr){this.ur.reset();const e=us(t.writeResults,t.commitTime);t=zn(t.commitTime);return this.listener.Cr(t,e)}!t.writeResults||0===t.writeResults.length||B();return this.Vr=!0,this.listener.Nr()}kr(){const t={};t.database=es(this.k);this.gr(t)}Dr(t$jscomp$0){t$jscomp$0={streamToken:this.lastStreamToken,writes:t$jscomp$0.map(t=>cs(this.k,t))};
this.gr(t$jscomp$0)}}class oo extends class{}{constructor(t,e,n,s){super();this.authCredentials=t;this.appCheckCredentials=e;this.ir=n;this.k=s;this.$r=!1}Or(){if(this.$r)throw new Q(j.FAILED_PRECONDITION,"The client has already been terminated.");}Bi(t$jscomp$0,e,n){return this.Or(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,i])=>this.ir.Bi(t$jscomp$0,e,n,s,i)).catch(t=>{throw"FirebaseError"===t.name?(t.code===j.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),
this.appCheckCredentials.invalidateToken()),t):new Q(j.UNKNOWN,t.toString());})}ji(t$jscomp$0,e,n){return this.Or(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,i])=>this.ir.ji(t$jscomp$0,e,n,s,i)).catch(t=>{throw"FirebaseError"===t.name?(t.code===j.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new Q(j.UNKNOWN,t.toString());})}terminate(){this.$r=!0}}class co{constructor(t,e){this.asyncQueue=t;
this.onlineStateHandler=e;this.state="Unknown";this.Mr=0;this.Fr=null;this.Lr=!0}Br(){0===this.Mr&&(this.Ur("Unknown"),this.Fr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1E4,()=>(this.Fr=null,this.qr("Backend didn't respond within 10 seconds."),this.Ur("Offline"),Promise.resolve())))}Kr(t){"Online"===this.state?this.Ur("Unknown"):(this.Mr++,1<=this.Mr&&(this.jr(),this.qr(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.Ur("Offline")))}set(t){this.jr();this.Mr=0;
"Online"===t&&(this.Lr=!1);this.Ur(t)}Ur(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}qr(t){t=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.Lr?(M(t),this.Lr=!1):O("OnlineStateTracker",t)}jr(){null!==this.Fr&&(this.Fr.cancel(),this.Fr=null)}}class ao{constructor(t$jscomp$1,e,n,s,
i){this.localStore=t$jscomp$1;this.datastore=e;this.asyncQueue=n;this.remoteSyncer={};this.Qr=[];this.Wr=new Map;this.Gr=new Set;this.zr=[];this.Hr=i;this.Hr.Ei(t$jscomp$0=>{n.enqueueAndForget(()=>{const $jscomp$async$this=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){yo($jscomp$async$this)&&(O("RemoteStore","Restarting streams for network reachability change."),yield function(t){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){t.Gr.add(4);yield ho(t);t.Jr.set("Unknown");
t.Gr.delete(4);yield uo(t)})}($jscomp$async$this))})})});this.Jr=new co(n,s)}}class Fo{constructor(t$jscomp$0,e,n,s,i){this.asyncQueue=t$jscomp$0;this.timerId=e;this.targetTimeMs=n;this.op=s;this.removalCallback=i;this.deferred=new W;this.then=this.deferred.promise.then.bind(this.deferred.promise);this.deferred.promise.catch(t=>{})}static createAndSchedule(t,e,n,s,i){const r=Date.now()+n;t=new Fo(t,e,r,s,i);return t.start(n),t}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==
this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Q(j.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}class Bo{constructor(t$jscomp$0){this.comparator=t$jscomp$0?(e,n)=>t$jscomp$0(e,n)||Dt.comparator(e.key,
n.key):(t,e)=>Dt.comparator(t.key,e.key);this.keyedMap=bn;this.sortedSet=new yn(this.comparator)}static emptySet(t){return new Bo(t.comparator)}has(t){return null!=this.keyedMap.get(t)}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){return(t=this.keyedMap.get(t))?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal((e,n)=>(t(e),
!1))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t$jscomp$0){if(!(t$jscomp$0 instanceof Bo)||this.size!==t$jscomp$0.size)return!1;const e=this.sortedSet.getIterator();for(t$jscomp$0=t$jscomp$0.sortedSet.getIterator();e.hasNext();){const t=e.getNext().key,s=t$jscomp$0.getNext().key;if(!t.isEqual(s))return!1}return!0}toString(){const t=
[];return this.forEach(e=>{t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const n=new Bo;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}}class Uo{constructor(){this.eo=new yn(Dt.comparator)}track(t){const e=t.doc.key,n=this.eo.get(e);n?0!==t.type&&3===n.type?this.eo=this.eo.insert(e,t):3===t.type&&1!==n.type?this.eo=this.eo.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.eo=this.eo.insert(e,{type:2,doc:t.doc}):
2===t.type&&0===n.type?this.eo=this.eo.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.eo=this.eo.remove(e):1===t.type&&2===n.type?this.eo=this.eo.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.eo=this.eo.insert(e,{type:2,doc:t.doc}):B():this.eo=this.eo.insert(e,t)}no(){const t=[];return this.eo.inorderTraversal((e,n)=>{t.push(n)}),t}}class qo{constructor(t,e,n,s,i,r,o,c){this.query=t;this.docs=e;this.oldDocs=n;this.docChanges=s;this.mutatedKeys=i;this.fromCache=r;this.syncStateChanged=
o;this.excludesMetadataChanges=c}static fromInitialDocuments(t$jscomp$0,e,n,s){const i=[];return e.forEach(t=>{i.push({type:0,doc:t})}),new qo(t$jscomp$0,e,Bo.emptySet(e),i,n,s,!0,!1)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t$jscomp$0){if(!(this.fromCache===t$jscomp$0.fromCache&&this.syncStateChanged===t$jscomp$0.syncStateChanged&&this.mutatedKeys.isEqual(t$jscomp$0.mutatedKeys)&&ve(this.query,t$jscomp$0.query)&&this.docs.isEqual(t$jscomp$0.docs)&&this.oldDocs.isEqual(t$jscomp$0.oldDocs)))return!1;
const e=this.docChanges;t$jscomp$0=t$jscomp$0.docChanges;if(e.length!==t$jscomp$0.length)return!1;for(let t=0;t<e.length;t++)if(e[t].type!==t$jscomp$0[t].type||!e[t].doc.isEqual(t$jscomp$0[t].doc))return!1;return!0}}class Ko{constructor(){this.so=void 0;this.listeners=[]}}class jo{constructor(){this.queries=new zi(t=>Ve(t),ve);this.onlineState="Unknown";this.io=new Set}}class Jo{constructor(t,e,n){this.query=t;this.co=e;this.ao=!1;this.uo=null;this.onlineState="Unknown";this.options=n||{}}oo(t){if(!this.options.includeMetadataChanges){var e=
[];for(const n of t.docChanges)3!==n.type&&e.push(n);t=new qo(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}e=!1;return this.ao?this.ho(t)&&(this.co.next(t),e=!0):this.lo(t,this.onlineState)&&(this.fo(t),e=!0),this.uo=t,e}onError(t){this.co.error(t)}ro(t){this.onlineState=t;let e=!1;return this.uo&&!this.ao&&this.lo(this.uo,t)&&(this.fo(this.uo),e=!0),e}lo(t,e){return t.fromCache?(!this.options.wo||"Offline"===e)&&(!t.docs.isEmpty()||"Offline"===e):!0}ho(t){if(0<t.docChanges.length)return!0;
const e=this.uo&&this.uo.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges}fo(t){t=qo.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache);this.ao=!0;this.co.next(t)}}class Yo{constructor(t,e){this.payload=t;this.byteLength=e}_o(){return"metadata"in this.payload}}class Xo{constructor(t){this.k=t}Hn(t){return Xn(this.k,t)}Jn(t){return t.metadata.exists?is(this.k,t.document,!1):Gt.newNoDocument(this.Hn(t.metadata.name),this.Yn(t.metadata.readTime))}Yn(t){return zn(t)}}
class Zo{constructor(t,e,n){this.mo=t;this.localStore=e;this.k=n;this.queries=[];this.documents=[];this.progress=tc(t)}yo(t){this.progress.bytesLoaded+=t.byteLength;let e=this.progress.documentsLoaded;return t.payload.namedQuery?this.queries.push(t.payload.namedQuery):t.payload.documentMetadata?(this.documents.push({metadata:t.payload.documentMetadata}),t.payload.documentMetadata.exists||++e):t.payload.document&&(this.documents[this.documents.length-1].document=t.payload.document,++e),e!==this.progress.documentsLoaded?
(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null}po(t){const e=new Map,n$jscomp$0=new Xo(this.k);for(const s$jscomp$0 of t)if(s$jscomp$0.metadata.queries){t=n$jscomp$0.Hn(s$jscomp$0.metadata.name);for(const n of s$jscomp$0.metadata.queries){const s=(e.get(n)||Dn()).add(t);e.set(n,s)}}return e}complete(){const $jscomp$async$this=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){const t$jscomp$0=yield Pr($jscomp$async$this.localStore,new Xo($jscomp$async$this.k),
$jscomp$async$this.documents,$jscomp$async$this.mo.id),e=$jscomp$async$this.po($jscomp$async$this.documents);for(const t of $jscomp$async$this.queries)yield vr($jscomp$async$this.localStore,t,e.get(t.name));return $jscomp$async$this.progress.taskState="Success",new ar(Object.assign({},$jscomp$async$this.progress),t$jscomp$0)})}}class ec{constructor(t){this.key=t}}class nc{constructor(t){this.key=t}}class sc{constructor(t,e){this.query=t;this.To=e;this.Eo=null;this.current=!1;this.Io=Dn();this.mutatedKeys=
Dn();this.Ao=Ce(t);this.Ro=new Bo(this.Ao)}get bo(){return this.To}Po(t$jscomp$0,e$jscomp$0){const n=e$jscomp$0?e$jscomp$0.vo:new Uo,s=e$jscomp$0?e$jscomp$0.Ro:this.Ro;let i=e$jscomp$0?e$jscomp$0.mutatedKeys:this.mutatedKeys,r=s,o=!1;const c=pe(this.query)&&s.size===this.query.limit?s.last():null,a=Te(this.query)&&s.size===this.query.limit?s.first():null;if(t$jscomp$0.inorderTraversal((t,e)=>{const u=s.get(t);e=De(this.query,e)?e:null;const l=!!u&&this.mutatedKeys.has(u.key),f=!!e&&(e.hasLocalMutations||
this.mutatedKeys.has(e.key)&&e.hasCommittedMutations);let d=!1;u&&e?u.data.isEqual(e.data)?l!==f&&(n.track({type:3,doc:e}),d=!0):this.Vo(u,e)||(n.track({type:2,doc:e}),d=!0,(c&&0<this.Ao(e,c)||a&&0>this.Ao(e,a))&&(o=!0)):!u&&e?(n.track({type:0,doc:e}),d=!0):u&&!e&&(n.track({type:1,doc:u}),d=!0,(c||a)&&(o=!0));d&&(e?(r=r.add(e),i=f?i.add(t):i.delete(t)):(r=r.delete(t),i=i.delete(t)))}),pe(this.query)||Te(this.query))for(;r.size>this.query.limit;)t$jscomp$0=pe(this.query)?r.last():r.first(),r=r.delete(t$jscomp$0.key),
i=i.delete(t$jscomp$0.key),n.track({type:1,doc:t$jscomp$0});return{Ro:r,vo:n,Bn:o,mutatedKeys:i}}Vo(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t$jscomp$2,e$jscomp$1,n$jscomp$0){const s=this.Ro;this.Ro=t$jscomp$2.Ro;this.mutatedKeys=t$jscomp$2.mutatedKeys;const i=t$jscomp$2.vo.no();i.sort((t$jscomp$1,e$jscomp$0)=>function(t$jscomp$0,e){const n=t=>{switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return B()}};return n(t$jscomp$0)-
n(e)}(t$jscomp$1.type,e$jscomp$0.type)||this.Ao(t$jscomp$1.doc,e$jscomp$0.doc));this.So(n$jscomp$0);e$jscomp$1=e$jscomp$1?this.Do():[];n$jscomp$0=0===this.Io.size&&this.current?1:0;const c=n$jscomp$0!==this.Eo;return(this.Eo=n$jscomp$0,0!==i.length||c)?{snapshot:new qo(this.query,t$jscomp$2.Ro,s,i,t$jscomp$2.mutatedKeys,0===n$jscomp$0,c,!1),Co:e$jscomp$1}:{Co:e$jscomp$1}}ro(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({Ro:this.Ro,vo:new Uo,mutatedKeys:this.mutatedKeys,
Bn:!1},!1)):{Co:[]}}No(t){return!this.To.has(t)&&!!this.Ro.has(t)&&!this.Ro.get(t).hasLocalMutations}So(t$jscomp$0){t$jscomp$0&&(t$jscomp$0.addedDocuments.forEach(t=>this.To=this.To.add(t)),t$jscomp$0.modifiedDocuments.forEach(t=>{}),t$jscomp$0.removedDocuments.forEach(t=>this.To=this.To.delete(t)),this.current=t$jscomp$0.current)}Do(){if(!this.current)return[];const t$jscomp$0=this.Io;this.Io=Dn();this.Ro.forEach(t=>{this.No(t.key)&&(this.Io=this.Io.add(t.key))});const e=[];return t$jscomp$0.forEach(t=>
{this.Io.has(t)||e.push(new nc(t))}),this.Io.forEach(n=>{t$jscomp$0.has(n)||e.push(new ec(n))}),e}ko(t){this.To=t.zn;this.Io=Dn();t=this.Po(t.documents);return this.applyChanges(t,!0)}xo(){return qo.fromInitialDocuments(this.query,this.Ro,this.mutatedKeys,0===this.Eo)}}class ic{constructor(t,e,n){this.query=t;this.targetId=e;this.view=n}}class rc{constructor(t){this.key=t;this.$o=!1}}class oc{constructor(t$jscomp$0,e,n,s,i,r){this.localStore=t$jscomp$0;this.remoteStore=e;this.eventManager=n;this.sharedClientState=
s;this.currentUser=i;this.maxConcurrentLimboResolutions=r;this.Oo={};this.Mo=new zi(t=>Ve(t),ve);this.Fo=new Map;this.Lo=new Set;this.Bo=new yn(Dt.comparator);this.Uo=new Map;this.qo=new Sr;this.Ko={};this.jo=new Map;this.Qo=Oi.re();this.onlineState="Unknown";this.Wo=void 0}get isPrimaryClient(){return!0===this.Wo}}class Lc{constructor(){this.synchronizeTabs=!1}initialize(t){const $jscomp$async$this=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){$jscomp$async$this.k=new jn(t.databaseInfo.databaseId,
!0);$jscomp$async$this.sharedClientState=$jscomp$async$this.Jo(t);$jscomp$async$this.persistence=$jscomp$async$this.Yo(t);yield $jscomp$async$this.persistence.start();$jscomp$async$this.gcScheduler=$jscomp$async$this.Xo(t);$jscomp$async$this.localStore=$jscomp$async$this.Zo(t)})}Xo(t){return null}Zo(t){var e=new lr;return new fr(this.persistence,e,t.initialUser,this.k)}Yo(t){return new $r(Mr.ks,this.k)}Jo(t){return new Gr}terminate(){const $jscomp$async$this=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){$jscomp$async$this.gcScheduler&&
$jscomp$async$this.gcScheduler.stop();yield $jscomp$async$this.sharedClientState.shutdown();yield $jscomp$async$this.persistence.shutdown()})}}class Bc extends Lc{constructor(t,e,n){super();this.tc=t;this.cacheSizeBytes=e;this.forceOwnership=n;this.synchronizeTabs=!1}initialize(t){const $jscomp$async$this=this,$jscomp$async$super$get$initialize=()=>super.initialize;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){yield $jscomp$async$super$get$initialize().call($jscomp$async$this,t);
yield br($jscomp$async$this.localStore);yield $jscomp$async$this.tc.initialize($jscomp$async$this,t);yield Mc($jscomp$async$this.tc.syncEngine);yield bo($jscomp$async$this.tc.remoteStore);yield $jscomp$async$this.persistence.sn(()=>($jscomp$async$this.gcScheduler&&!$jscomp$async$this.gcScheduler.started&&$jscomp$async$this.gcScheduler.start($jscomp$async$this.localStore),Promise.resolve()))})}Zo(t){var e=new lr;return new fr(this.persistence,e,t.initialUser,this.k)}Xo(t){return new ji(this.persistence.referenceDelegate.garbageCollector,
t.asyncQueue)}Yo(t){const e=cr(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?Vi.withCacheSize(this.cacheSizeBytes):Vi.DEFAULT;return new ir(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,"undefined"!=typeof window?window:null,to(),this.k,this.sharedClientState,!!this.forceOwnership)}Jo(t){return new Gr}}class Uc extends Bc{constructor(t,e){super(t,e,!1);this.tc=t;this.cacheSizeBytes=e;this.synchronizeTabs=!0}initialize(t$jscomp$0){const $jscomp$async$this=
this,$jscomp$async$super$get$initialize=()=>super.initialize;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){yield $jscomp$async$super$get$initialize().call($jscomp$async$this,t$jscomp$0);const e=$jscomp$async$this.tc.syncEngine;$jscomp$async$this.sharedClientState instanceof Wr&&($jscomp$async$this.sharedClientState.syncEngine={mi:Sc.bind(null,e),gi:xc.bind(null,e),yi:$c.bind(null,e),Tn:kc.bind(null,e),_i:Vc.bind(null,e)},yield $jscomp$async$this.sharedClientState.start());yield $jscomp$async$this.persistence.sn(t=>
$jscomp.asyncExecutePromiseGeneratorFunction(function*(){yield Dc($jscomp$async$this.tc.syncEngine,t);$jscomp$async$this.gcScheduler&&(t&&!$jscomp$async$this.gcScheduler.started?$jscomp$async$this.gcScheduler.start($jscomp$async$this.localStore):t||$jscomp$async$this.gcScheduler.stop())}))})}Jo(t){const e="undefined"!=typeof window?window:null;if(!Wr.Pt(e))throw new Q(j.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const n=cr(t.databaseInfo.databaseId,
t.databaseInfo.persistenceKey);return new Wr(e,t.asyncQueue,n,t.clientId,t.initialUser)}}class qc{initialize(t$jscomp$0,e){const $jscomp$async$this=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){$jscomp$async$this.localStore||($jscomp$async$this.localStore=t$jscomp$0.localStore,$jscomp$async$this.sharedClientState=t$jscomp$0.sharedClientState,$jscomp$async$this.datastore=$jscomp$async$this.createDatastore(e),$jscomp$async$this.remoteStore=$jscomp$async$this.createRemoteStore(e),
$jscomp$async$this.eventManager=$jscomp$async$this.createEventManager(e),$jscomp$async$this.syncEngine=$jscomp$async$this.createSyncEngine(e,!t$jscomp$0.synchronizeTabs),$jscomp$async$this.sharedClientState.onlineStateHandler=t=>fc($jscomp$async$this.syncEngine,t,1),$jscomp$async$this.remoteStore.remoteSyncer.handleCredentialChange=bc.bind(null,$jscomp$async$this.syncEngine),yield $o($jscomp$async$this.remoteStore,$jscomp$async$this.syncEngine.isPrimaryClient))})}createEventManager(t){return new jo}createDatastore(t){const e=
new jn(t.databaseInfo.databaseId,!0),n=(s=t.databaseInfo,new Xr(s));var s;return new oo(t.authCredentials,t.appCheckCredentials,n,e)}createRemoteStore(t$jscomp$0){return e=this.localStore,n=this.datastore,s=t$jscomp$0.asyncQueue,i=t=>fc(this.syncEngine,t,0),r=Hr.Pt()?new Hr:new zr,new ao(e,n,s,i,r);var e,n,s,i,r}createSyncEngine(t,e){t=new oc(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions);return e&&(t.Wo=!0),t}terminate(){return function(t){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){O("RemoteStore",
"RemoteStore shutting down.");t.Gr.add(5);yield ho(t);t.Hr.shutdown();t.Jr.set("Unknown")})}(this.remoteStore)}}class jc{constructor(t){this.observer=t;this.muted=!1}next(t){this.observer.next&&this.ec(this.observer.next,t)}error(t){this.observer.error?this.ec(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)}nc(){this.muted=!0}ec(t,e){this.muted||setTimeout(()=>{this.muted||t(e)},0)}}class Qc{constructor(t$jscomp$0,e){this.sc=t$jscomp$0;this.k=e;this.metadata=new W;this.buffer=
new Uint8Array;this.ic=new TextDecoder("utf-8");this.rc().then(t=>{t&&t._o()?this.metadata.resolve(t.payload.metadata):this.metadata.reject(Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==t?void 0:t.payload)}`))},t=>this.metadata.reject(t))}close(){return this.sc.cancel()}getMetadata(){const $jscomp$async$this=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){return $jscomp$async$this.metadata.promise})}Ho(){const $jscomp$async$this=
this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){return yield $jscomp$async$this.getMetadata(),$jscomp$async$this.rc()})}rc(){const $jscomp$async$this=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){const t=yield $jscomp$async$this.oc();if(null===t)return null;var e=$jscomp$async$this.ic.decode(t);const n=Number(e);isNaN(n)&&$jscomp$async$this.cc(`length string (${e}) is not valid number`);e=yield $jscomp$async$this.ac(n);return new Yo(JSON.parse(e),t.length+
n)})}uc(){return this.buffer.findIndex(t=>123===t)}oc(){const $jscomp$async$this=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){for(;0>$jscomp$async$this.uc()&&!(yield $jscomp$async$this.hc()););if(0===$jscomp$async$this.buffer.length)return null;const t=$jscomp$async$this.uc();0>t&&$jscomp$async$this.cc("Reached the end of bundle when a length string is expected.");const e=$jscomp$async$this.buffer.slice(0,t);return $jscomp$async$this.buffer=$jscomp$async$this.buffer.slice(t),
e})}ac(t){const $jscomp$async$this=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){for(;$jscomp$async$this.buffer.length<t;)(yield $jscomp$async$this.hc())&&$jscomp$async$this.cc("Reached the end of bundle when more is expected.");const e=$jscomp$async$this.ic.decode($jscomp$async$this.buffer.slice(0,t));return $jscomp$async$this.buffer=$jscomp$async$this.buffer.slice(t),e})}cc(t){throw this.sc.cancel(),Error(`Invalid bundle format: ${t}`);}hc(){const $jscomp$async$this=this;
return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){const t=yield $jscomp$async$this.sc.read();if(!t.done){const e=new Uint8Array($jscomp$async$this.buffer.length+t.value.length);e.set($jscomp$async$this.buffer);e.set(t.value,$jscomp$async$this.buffer.length);$jscomp$async$this.buffer=e}return t.done})}}class Wc{constructor(t){this.datastore=t;this.readVersions=new Map;this.mutations=[];this.committed=!1;this.lastWriteError=null;this.writtenDocs=new Set}lookup(t$jscomp$1){const $jscomp$async$this=
this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){if($jscomp$async$this.ensureCommitNotCalled(),0<$jscomp$async$this.mutations.length)throw new Q(j.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const e$jscomp$0=yield function(t$jscomp$0,e){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){var s=es(t$jscomp$0.k)+"/documents";const i={documents:e.map(t=>Hn(t$jscomp$0.k.databaseId,t.path))};s=yield t$jscomp$0.ji("BatchGetDocuments",
s,i);const o=new Map;s.forEach(t=>{t=rs(t$jscomp$0.k,t);o.set(t.key.toString(),t)});const c=[];return e.forEach(t=>{(t=o.get(t.toString()))||B();c.push(t)}),c})}($jscomp$async$this.datastore,t$jscomp$1);return e$jscomp$0.forEach(t=>$jscomp$async$this.recordVersion(t)),e$jscomp$0})}set(t,e){this.write(e.toMutation(t,this.precondition(t)));this.writtenDocs.add(t.toString())}update(t$jscomp$0,e){try{this.write(e.toMutation(t$jscomp$0,this.preconditionForUpdate(t$jscomp$0)))}catch(t){this.lastWriteError=
t}this.writtenDocs.add(t$jscomp$0.toString())}delete(t){this.write(new ln(t,this.precondition(t)));this.writtenDocs.add(t.toString())}commit(){const $jscomp$async$this=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){if($jscomp$async$this.ensureCommitNotCalled(),$jscomp$async$this.lastWriteError)throw $jscomp$async$this.lastWriteError;const t$jscomp$1=$jscomp$async$this.readVersions;$jscomp$async$this.mutations.forEach(e=>{t$jscomp$1.delete(e.key.toString())});t$jscomp$1.forEach((t,
e)=>{t=Dt.fromPath(e);$jscomp$async$this.mutations.push(new fn(t,$jscomp$async$this.precondition(t)))});yield function(t$jscomp$0,e){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){const s=es(t$jscomp$0.k)+"/documents",i={writes:e.map(t=>cs(t$jscomp$0.k,t))};yield t$jscomp$0.Bi("Commit",s,i)})}($jscomp$async$this.datastore,$jscomp$async$this.mutations);$jscomp$async$this.committed=!0})}recordVersion(t){let e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw B();e=
ut.min()}const n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new Q(j.ABORTED,"Document version changed between two reads.");}else this.readVersions.set(t.key.toString(),e)}precondition(t){const e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?Ye.updateTime(e):Ye.none()}preconditionForUpdate(t){const e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(ut.min()))throw new Q(j.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");
return Ye.updateTime(e)}return Ye.exists(!0)}write(t){this.ensureCommitNotCalled();this.mutations.push(t)}ensureCommitNotCalled(){}}class Gc{constructor(t,e,n,s){this.asyncQueue=t;this.datastore=e;this.updateFunction=n;this.deferred=s;this.lc=5;this.ur=new no(this.asyncQueue,"transaction_retry")}run(){--this.lc;this.fc()}fc(){this.ur.Zi(()=>{const $jscomp$async$this=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){const t$jscomp$0=new Wc($jscomp$async$this.datastore),e$jscomp$0=
$jscomp$async$this.dc(t$jscomp$0);e$jscomp$0&&e$jscomp$0.then(e=>{$jscomp$async$this.asyncQueue.enqueueAndForget(()=>t$jscomp$0.commit().then(()=>{$jscomp$async$this.deferred.resolve(e)}).catch(t=>{$jscomp$async$this.wc(t)}))}).catch(t=>{$jscomp$async$this.wc(t)})})})}dc(t$jscomp$0){try{const e=this.updateFunction(t$jscomp$0);return null!=e&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}wc(t){0<this.lc&&
this._c(t)?(--this.lc,this.asyncQueue.enqueueAndForget(()=>(this.fc(),Promise.resolve()))):this.deferred.reject(t)}_c(t){return"FirebaseError"===t.name?(t=t.code,"aborted"===t||"failed-precondition"===t||!mn(t)):!1}}class zc{constructor(t$jscomp$0,e,n,s){this.authCredentials=t$jscomp$0;this.appCheckCredentials=e;this.asyncQueue=n;this.databaseInfo=s;this.user=C.UNAUTHENTICATED;this.clientId=it.A();this.authCredentialListener=()=>Promise.resolve();this.appCheckCredentialListener=()=>Promise.resolve();
this.authCredentials.start(n,t=>{const $jscomp$async$this=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){O("FirestoreClient","Received user\x3d",t.uid);yield $jscomp$async$this.authCredentialListener(t);$jscomp$async$this.user=t})});this.appCheckCredentials.start(n,t=>(O("FirestoreClient","Received new app check token\x3d",t),this.appCheckCredentialListener(t,this.user)))}getConfiguration(){const $jscomp$async$this=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){return{asyncQueue:$jscomp$async$this.asyncQueue,
databaseInfo:$jscomp$async$this.databaseInfo,clientId:$jscomp$async$this.clientId,authCredentials:$jscomp$async$this.authCredentials,appCheckCredentials:$jscomp$async$this.appCheckCredentials,initialUser:$jscomp$async$this.user,maxConcurrentLimboResolutions:100}})}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new Q(j.FAILED_PRECONDITION,"The client has already been terminated.");
}terminate(){this.asyncQueue.enterRestrictedMode();const t=new W;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>{const $jscomp$async$this=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){try{$jscomp$async$this.onlineComponents&&(yield $jscomp$async$this.onlineComponents.terminate()),$jscomp$async$this.offlineComponents&&(yield $jscomp$async$this.offlineComponents.terminate()),$jscomp$async$this.authCredentials.shutdown(),$jscomp$async$this.appCheckCredentials.shutdown(),
t.resolve()}catch(e){const n=Lo(e,"Failed to shutdown persistence");t.reject(n)}})}),t.promise}}class wa{constructor(t,e,n,s,i,r,o,c){this.databaseId=t;this.appId=e;this.persistenceKey=n;this.host=s;this.ssl=i;this.forceLongPolling=r;this.autoDetectLongPolling=o;this.useFetchStreams=c}}class _a{constructor(t,e){this.projectId=t;this.database=e||"(default)"}get isDefaultDatabase(){return"(default)"===this.database}isEqual(t){return t instanceof _a&&t.projectId===this.projectId&&t.database===this.database}}
exports._DatabaseId=_a;const ma=new Map;class Ra{constructor(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new Q(j.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com";this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&1048576>t.cacheSizeBytes)throw new Q(j.INVALID_ARGUMENT,
"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling;this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling;this.useFetchStreams=!!t.useFetchStreams;ya("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===
t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class ba{constructor(t,e,n){this._authCredentials=e;this._appCheckCredentials=n;this.type="firestore-lite";this._persistenceKey="(lite)";this._settings=new Ra({});this._settingsFrozen=!1;if(t instanceof _a)this._databaseId=t;else{this._app=
t;if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new Q(j.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');this._databaseId=new _a(t.options.projectId)}}get app(){if(!this._app)throw new Q(j.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new Q(j.FAILED_PRECONDITION,
"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Ra(t);if(void 0!==t.credentials){a:if(t=t.credentials)switch(t.type){case "gapi":const e=t.client;"object"==typeof e&&null!==e&&e.auth&&e.auth.getAuthHeaderValueForFirstParty||B();t=new X(e,t.sessionIndex||"0",t.iamToken||null);break a;case "provider":t=t.client;break a;default:throw new Q(j.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type");
}else t=new z;this._authCredentials=t}}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){const e=ma.get(this);e&&(O("ComponentProvider","Removing Datastore"),ma.delete(this),e.terminate());return Promise.resolve()}}class va{constructor(t,e,n){this.converter=
e;this._key=n;this.type="document";this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Sa(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new va(this.firestore,t,this._key)}}exports.DocumentReference=va;class Va{constructor(t,e,n){this.converter=e;this._query=n;this.type="query";this.firestore=t}withConverter(t){return new Va(this.firestore,t,this._query)}}
exports.Query=Va;class Sa extends Va{constructor(t,e,n){super(t,e,new me(n));this._path=n;this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new va(this.firestore,null,new Dt(t))}withConverter(t){return new Sa(this.firestore,t,this._path)}}exports.CollectionReference=Sa;class $a{constructor(){this.mc=Promise.resolve();this.gc=[];this.yc=!1;this.Tc=[];this.Ec=null;
this.Ac=this.Ic=!1;this.Rc=[];this.ur=new no(this,"async_queue_retry");this.bc=()=>{const t=to();t&&O("AsyncQueue","Visibility state changed to "+t.visibilityState);this.ur.er()};const t$jscomp$0=to();t$jscomp$0&&"function"==typeof t$jscomp$0.addEventListener&&t$jscomp$0.addEventListener("visibilitychange",this.bc)}get isShuttingDown(){return this.yc}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.Pc();this.vc(t)}enterRestrictedMode(t){this.yc||(this.yc=!0,this.Ac=
t||!1,(t=to())&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.bc))}enqueue(t){if(this.Pc(),this.yc)return new Promise(()=>{});const e=new W;return this.vc(()=>this.yc&&this.Ac?Promise.resolve():(t().then(e.resolve,e.reject),e.promise)).then(()=>e.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.gc.push(t),this.Vc()))}Vc(){const $jscomp$async$this=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){if(0!==$jscomp$async$this.gc.length){try{yield $jscomp$async$this.gc[0](),
$jscomp$async$this.gc.shift(),$jscomp$async$this.ur.reset()}catch(t){if(!Zs(t))throw t;O("AsyncQueue","Operation failed with retryable error: "+t)}0<$jscomp$async$this.gc.length&&$jscomp$async$this.ur.Zi(()=>$jscomp$async$this.Vc())}})}vc(t$jscomp$0){const e$jscomp$0=this.mc.then(()=>(this.Ic=!0,t$jscomp$0().catch(t=>{this.Ec=t;this.Ic=!1;let e=t.message||"";t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack);throw M("INTERNAL UNHANDLED ERROR: ",e),t;}).then(t=>(this.Ic=!1,t))));
return this.mc=e$jscomp$0,e$jscomp$0}enqueueAfterDelay(t$jscomp$0,e,n){this.Pc();-1<this.Rc.indexOf(t$jscomp$0)&&(e=0);t$jscomp$0=Fo.createAndSchedule(this,t$jscomp$0,e,n,t=>this.Sc(t));return this.Tc.push(t$jscomp$0),t$jscomp$0}Pc(){this.Ec&&B()}verifyOperationInProgress(){}Dc(){const $jscomp$async$this=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){let t;do t=$jscomp$async$this.mc,yield t;while(t!==$jscomp$async$this.mc)})}Cc(t){for(const e of this.Tc)if(e.timerId===t)return!0;
return!1}Nc(t$jscomp$0){return this.Dc().then(()=>{this.Tc.sort((t,e)=>t.targetTimeMs-e.targetTimeMs);for(const e of this.Tc)if(e.skipDelay(),"all"!==t$jscomp$0&&e.timerId===t$jscomp$0)break;return this.Dc()})}kc(t){this.Rc.push(t)}Sc(t){t=this.Tc.indexOf(t);this.Tc.splice(t,1)}}class Ma{constructor(){this._progressObserver={};this._taskCompletionResolver=new W;this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(t,e,n){this._progressObserver=
{next:t,error:e,complete:n}}catch(t){return this._taskCompletionResolver.promise.catch(t)}then(t,e){return this._taskCompletionResolver.promise.then(t,e)}_completeWith(t){this._updateProgress(t);this._progressObserver.complete&&this._progressObserver.complete();this._taskCompletionResolver.resolve(t)}_failWith(t){this._lastProgress.taskState="Error";this._progressObserver.next&&this._progressObserver.next(this._lastProgress);this._progressObserver.error&&this._progressObserver.error(t);this._taskCompletionResolver.reject(t)}_updateProgress(t){this._lastProgress=
t;this._progressObserver.next&&this._progressObserver.next(t)}}exports.LoadBundleTask=Ma;exports.CACHE_SIZE_UNLIMITED=-1;class La extends ba{constructor(t,e,n){super(t,e,n);this.type="firestore";this._queue=new $a;this._persistenceKey="name"in t?t.name:"[DEFAULT]"}_terminate(){return this._firestoreClient||Ka(this),this._firestoreClient.terminate()}}exports.Firestore=La;class eu{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new Q(j.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");
this._internalPath=new mt(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}exports.FieldPath=eu;class su{constructor(t){this._byteString=t}static fromBase64String(t$jscomp$0){try{return new su(pt.fromBase64String(t$jscomp$0))}catch(t){throw new Q(j.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t);}}static fromUint8Array(t){return new su(pt.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+
this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}exports.Bytes=su;class iu{constructor(t){this._methodName=t}}exports.FieldValue=iu;class ru{constructor(t,e){if(!isFinite(t)||-90>t||90<t)throw new Q(j.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||-180>e||180<e)throw new Q(j.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t;this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===
t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return rt(this._lat,t._lat)||rt(this._long,t._long)}}exports.GeoPoint=ru;const ou=/^__.*__$/;class cu{constructor(t,e,n){this.data=t;this.fieldMask=e;this.fieldTransforms=n}toMutation(t,e){return null!==this.fieldMask?new cn(t,this.data,this.fieldMask,e,this.fieldTransforms):new on(t,this.data,e,this.fieldTransforms)}}class au{constructor(t,e,n){this.data=t;this.fieldMask=e;this.fieldTransforms=n}toMutation(t,
e){return new cn(t,this.data,this.fieldMask,e,this.fieldTransforms)}}class hu{constructor(t,e,n,s,i,r){this.settings=t;this.databaseId=e;this.k=n;this.ignoreUndefinedProperties=s;void 0===i&&this.xc();this.fieldTransforms=i||[];this.fieldMask=r||[]}get path(){return this.settings.path}get $c(){return this.settings.$c}Oc(t){return new hu(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.k,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mc(t){var e;const n=null===
(e=this.path)||void 0===e?void 0:e.child(t);e=this.Oc({path:n,Fc:!1});return e.Lc(t),e}Bc(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t);t=this.Oc({path:n,Fc:!1});return t.xc(),t}Uc(t){return this.Oc({path:void 0,Fc:!0})}qc(t){return Du(t,this.settings.methodName,this.settings.Kc||!1,this.path,this.settings.jc)}contains(t){return void 0!==this.fieldMask.find(e=>t.isPrefixOf(e))||void 0!==this.fieldTransforms.find(e=>t.isPrefixOf(e.field))}xc(){if(this.path)for(let t=0;t<this.path.length;t++)this.Lc(this.path.get(t))}Lc(t){if(0===
t.length)throw this.qc("Document fields must not be empty");if(uu(this.$c)&&ou.test(t))throw this.qc('Document fields cannot begin and end with "__"');}}class lu{constructor(t,e,n){this.databaseId=t;this.ignoreUndefinedProperties=e;this.k=n||new jn(t,!0)}Qc(t,e,n,s=!1){return new hu({$c:t,methodName:e,jc:n,path:mt.emptyPath(),Fc:!1,Kc:s},this.databaseId,this.k,this.ignoreUndefinedProperties)}}class wu extends iu{_toFieldTransform(t){if(2!==t.$c)throw 1===t.$c?t.qc(`${this._methodName}() can only appear at the top level of your update data`):
t.qc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof wu}}class mu extends iu{_toFieldTransform(t){return new ze(t.path,new Be)}isEqual(t){return t instanceof mu}}class gu extends iu{constructor(t,e){super(t);this.Wc=e}_toFieldTransform(t$jscomp$0){const e=_u(this,t$jscomp$0,!0);var n=this.Wc.map(t=>Au(t,e));n=new Ue(n);return new ze(t$jscomp$0.path,n)}isEqual(t){return this===t}}class yu extends iu{constructor(t,
e){super(t);this.Wc=e}_toFieldTransform(t$jscomp$0){const e=_u(this,t$jscomp$0,!0);var n=this.Wc.map(t=>Au(t,e));n=new Ke(n);return new ze(t$jscomp$0.path,n)}isEqual(t){return this===t}}class pu extends iu{constructor(t,e){super(t);this.Gc=e}_toFieldTransform(t){const e=new Qe(t.k,$e(t.k,this.Gc));return new ze(t.path,e)}isEqual(t){return this===t}}const Vu=RegExp("[~\\*/\\[\\]]");class Nu{constructor(t,e,n,s,i){this._firestore=t;this._userDataWriter=e;this._key=n;this._document=s;this._converter=
i}get id(){return this._key.path.lastSegment()}get ref(){return new va(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const t=new ku(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document&&(t=this._document.data.field(xu("DocumentSnapshot.get",t)),null!==t))return this._userDataWriter.convertValue(t)}}
class ku extends Nu{data(){return super.data()}}class $u{constructor(t,e){this.hasPendingWrites=t;this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}exports.SnapshotMetadata=$u;class Ou extends Nu{constructor(t,e,n,s,i,r){super(t,e,n,s,r);this._firestoreImpl=this._firestore=t;this.metadata=i}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new Mu(this._firestore,this._userDataWriter,this._key,this._document,
this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document&&(t=this._document.data.field(xu("DocumentSnapshot.get",t)),null!==t))return this._userDataWriter.convertValue(t,e.serverTimestamps)}}exports.DocumentSnapshot=Ou;class Mu extends Ou{data(t={}){return super.data(t)}}exports.QueryDocumentSnapshot=Mu;class Fu{constructor(t,e,n,s){this._firestore=t;this._userDataWriter=e;this._snapshot=
s;this.metadata=new $u(s.hasPendingWrites,s.fromCache);this.query=n}get docs(){const t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,e){this._snapshot.docs.forEach(n=>{t.call(e,new Mu(this._firestore,this._userDataWriter,n.key,n,new $u(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(t$jscomp$1={}){if((t$jscomp$1=!!t$jscomp$1.includeMetadataChanges)&&this._snapshot.excludesMetadataChanges)throw new Q(j.INVALID_ARGUMENT,
"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t$jscomp$1||(this._cachedChanges=function(t$jscomp$0,e$jscomp$0){if(t$jscomp$0._snapshot.oldDocs.isEmpty()){let e=0;return t$jscomp$0._snapshot.docChanges.map(n=>({type:"added",doc:new Mu(t$jscomp$0._firestore,t$jscomp$0._userDataWriter,n.doc.key,n.doc,new $u(t$jscomp$0._snapshot.mutatedKeys.has(n.doc.key),
t$jscomp$0._snapshot.fromCache),t$jscomp$0.query.converter),oldIndex:-1,newIndex:e++}))}let n$jscomp$0=t$jscomp$0._snapshot.oldDocs;return t$jscomp$0._snapshot.docChanges.filter(t=>e$jscomp$0||3!==t.type).map(e=>{const s=new Mu(t$jscomp$0._firestore,t$jscomp$0._userDataWriter,e.doc.key,e.doc,new $u(t$jscomp$0._snapshot.mutatedKeys.has(e.doc.key),t$jscomp$0._snapshot.fromCache),t$jscomp$0.query.converter);let i=-1,r=-1;return 0!==e.type&&(i=n$jscomp$0.indexOf(e.doc.key),n$jscomp$0=n$jscomp$0.delete(e.doc.key)),
1!==e.type&&(n$jscomp$0=n$jscomp$0.add(e.doc),r=n$jscomp$0.indexOf(e.doc.key)),{type:Lu(e.type),doc:s,oldIndex:i,newIndex:r}})}(this,t$jscomp$1),this._cachedChangesIncludeMetadataChanges=t$jscomp$1),this._cachedChanges}}exports.QuerySnapshot=Fu;class qu{}exports.QueryConstraint=qu;class ju extends qu{constructor(t,e,n){super();this.zc=t;this.Hc=e;this.Jc=n;this.type="where"}_apply(t$jscomp$2){var e$jscomp$2=fu(t$jscomp$2.firestore);e$jscomp$2=function(t$jscomp$1,e$jscomp$1,n$jscomp$1,s,i,r,o){if(i.isKeyField()){if("array-contains"===
r||"array-contains-any"===r)throw new Q(j.INVALID_ARGUMENT,`Invalid Query. You can't perform '${r}' queries on documentId().`);if("in"===r||"not-in"===r){rh(o,r);e$jscomp$1=[];for(const n of o)e$jscomp$1.push(ih(s,t$jscomp$1,n));s={arrayValue:{values:e$jscomp$1}}}else s=ih(s,t$jscomp$1,o)}else"in"!==r&&"not-in"!==r&&"array-contains-any"!==r||rh(o,r),s=Iu(n$jscomp$1,e$jscomp$1,o,"in"===r||"not-in"===r);i=te.create(i,r,s);return function(t$jscomp$0,e$jscomp$0){if(e$jscomp$0.V()){var n$jscomp$0=Ie(t$jscomp$0);
if(null!==n$jscomp$0&&!n$jscomp$0.isEqual(e$jscomp$0.field))throw new Q(j.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${n$jscomp$0.toString()}' and '${e$jscomp$0.field.toString()}'`);n$jscomp$0=Ee(t$jscomp$0);null!==n$jscomp$0&&oh(t$jscomp$0,e$jscomp$0.field,n$jscomp$0)}t$jscomp$0=function(t,e){for(const n of t.filters)if(0<=e.indexOf(n.op))return n.op;return null}(t$jscomp$0,function(t){switch(t){case "!\x3d":return["!\x3d",
"not-in"];case "array-contains":return["array-contains","array-contains-any","not-in"];case "in":return["array-contains-any","in","not-in"];case "array-contains-any":return["array-contains","array-contains-any","in","not-in"];case "not-in":return["array-contains","array-contains-any","in","not-in","!\x3d"];default:return[]}}(e$jscomp$0.op));if(null!==t$jscomp$0)throw t$jscomp$0===e$jscomp$0.op?new Q(j.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e$jscomp$0.op.toString()}' filter.`):
new Q(j.INVALID_ARGUMENT,`Invalid query. You cannot use '${e$jscomp$0.op.toString()}' filters with '${t$jscomp$0.toString()}' filters.`);}(t$jscomp$1,i),i}(t$jscomp$2._query,"where",e$jscomp$2,t$jscomp$2.firestore._databaseId,this.zc,this.Hc,this.Jc);return new Va(t$jscomp$2.firestore,t$jscomp$2.converter,function(t,e){e=t.filters.concat([e]);return new me(t.path,t.collectionGroup,t.explicitOrderBy.slice(),e,t.limit,t.limitType,t.startAt,t.endAt)}(t$jscomp$2._query,e$jscomp$2))}}class Wu extends qu{constructor(t,
e){super();this.zc=t;this.Yc=e;this.type="orderBy"}_apply(t$jscomp$0){const e$jscomp$0=function(t,e,n){if(null!==t.startAt)throw new Q(j.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new Q(j.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");e=new fe(e,n);null===Ee(t)&&(n=Ie(t),null!==n&&oh(t,n,e.field));return e}(t$jscomp$0._query,this.zc,this.Yc);return new Va(t$jscomp$0.firestore,
t$jscomp$0.converter,function(t,e){e=t.explicitOrderBy.concat([e]);return new me(t.path,t.collectionGroup,e,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t$jscomp$0._query,e$jscomp$0))}}class zu extends qu{constructor(t,e,n){super();this.type=t;this.Xc=e;this.Zc=n}_apply(t){return new Va(t.firestore,t.converter,Pe(t._query,this.Xc,this.Zc))}}class Yu extends qu{constructor(t,e,n){super();this.type=t;this.ta=e;this.ea=n}_apply(t){var e=sh(t,this.type,this.ta,this.ea),JSCompiler_temp_const=
t.firestore,JSCompiler_temp_const$jscomp$0=t.converter;t=t._query;e=new me(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt);return new Va(JSCompiler_temp_const,JSCompiler_temp_const$jscomp$0,e)}}class th extends qu{constructor(t,e,n){super();this.type=t;this.ta=e;this.ea=n}_apply(t){var e=sh(t,this.type,this.ta,this.ea),JSCompiler_temp_const=t.firestore,JSCompiler_temp_const$jscomp$0=t.converter;t=t._query;e=new me(t.path,t.collectionGroup,t.explicitOrderBy.slice(),
t.filters.slice(),t.limit,t.limitType,t.startAt,e);return new Va(JSCompiler_temp_const,JSCompiler_temp_const$jscomp$0,e)}}class ch{convertValue(t,e="none"){switch(Ct(t)){case 0:return null;case 1:return t.booleanValue;case 2:return It(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(At(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);
case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw B();}}convertObject(t$jscomp$0,e){const n={};return lt(t$jscomp$0.fields,(t,s)=>{n[t]=this.convertValue(s,e)}),n}convertGeoPoint(t){return new ru(It(t.latitude),It(t.longitude))}convertArray(t$jscomp$0,e){return(t$jscomp$0.values||[]).map(t=>this.convertValue(t,e))}convertServerTimestamp(t,e){switch(e){case "previous":return t=bt(t),null==t?null:this.convertValue(t,e);case "estimate":return this.convertTimestamp(Pt(t));
default:return null}}convertTimestamp(t){t=Et(t);return new at(t.seconds,t.nanos)}convertDocumentKey(t,e){var n=wt.fromString(t);Rs(n)||B();t=new _a(n.get(1),n.get(3));n=new Dt(n.popFirst(5));return t.isEqual(e)||M(`Document ${n} contains a document reference within a different database (${t.projectId}/${t.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),n}}exports.AbstractUserDataWriter=ch;class uh extends ch{constructor(t){super();
this.firestore=t}convertBytes(t){return new su(t)}convertReference(t){t=this.convertDocumentKey(t,this.firestore._databaseId);return new va(this.firestore,null,t)}}class hh{constructor(t,e){this._firestore=t;this._commitHandler=e;this._mutations=[];this._committed=!1;this._dataReader=fu(t)}set(t,e,n){this._verifyNotCommitted();t=lh(t,this._firestore);e=ah(t.converter,e,n);n=du(this._dataReader,"WriteBatch.set",t._key,e,null!==t.converter,n);return this._mutations.push(n.toMutation(t._key,Ye.none())),
this}update(t,e,n,...s){this._verifyNotCommitted();t=lh(t,this._firestore);let r;return r="string"==typeof(e=(0,_util.getModularInstance)(e))||e instanceof eu?Eu(this._dataReader,"WriteBatch.update",t._key,e,n,s):Tu(this._dataReader,"WriteBatch.update",t._key,e),this._mutations.push(r.toMutation(t._key,Ye.exists(!0))),this}delete(t){this._verifyNotCommitted();t=lh(t,this._firestore);return this._mutations=this._mutations.concat(new ln(t._key,Ye.none())),this}commit(){return this._verifyNotCommitted(),
this._committed=!0,0<this._mutations.length?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new Q(j.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.");}}exports.WriteBatch=hh;class dh extends ch{constructor(t){super();this.firestore=t}convertBytes(t){return new su(t)}convertReference(t){t=this.convertDocumentKey(t,this.firestore._databaseId);return new va(this.firestore,null,t)}}class vh extends class{constructor(t,
e){this._firestore=t;this._transaction=e;this._dataReader=fu(t)}get(t$jscomp$0){const e=lh(t$jscomp$0,this._firestore),n=new uh(this._firestore);return this._transaction.lookup([e._key]).then(t=>{if(!t||1!==t.length)return B();t=t[0];if(t.isFoundDocument())return new Nu(this._firestore,n,t.key,t,e.converter);if(t.isNoDocument())return new Nu(this._firestore,n,e._key,null,e.converter);throw B();})}set(t,e,n){t=lh(t,this._firestore);e=ah(t.converter,e,n);n=du(this._dataReader,"Transaction.set",t._key,
e,null!==t.converter,n);return this._transaction.set(t._key,n),this}update(t,e,n,...s){t=lh(t,this._firestore);let r;return r="string"==typeof(e=(0,_util.getModularInstance)(e))||e instanceof eu?Eu(this._dataReader,"Transaction.update",t._key,e,n,s):Tu(this._dataReader,"Transaction.update",t._key,e),this._transaction.update(t._key,r),this}delete(t){t=lh(t,this._firestore);return this._transaction.delete(t._key),this}}{constructor(t,e){super(t,e);this._firestore=t}get(t$jscomp$0){const e=lh(t$jscomp$0,
this._firestore),n=new dh(this._firestore);return super.get(t$jscomp$0).then(t=>new Ou(this._firestore,n,e._key,t._document,new $u(!1,!1),e.converter))}}exports.Transaction=vh;class Oh{constructor(t,e){this.fieldPath=t;this.kind=e}}!function(t$jscomp$0,e=!0){N=_app.SDK_VERSION;!0;(0,_app._registerComponent)(new _component.Component("firestore",(t,{options:n})=>{const s=t.getProvider("app").getImmediate();t=new La(s,new J(t.getProvider("auth-internal")),new tt(t.getProvider("app-check-internal")));
return n=Object.assign({useFetchStreams:e},n),t._setSettings(n),t},"PUBLIC"));(0,_app.registerVersion)("@firebase/firestore","3.4.4",t$jscomp$0);(0,_app.registerVersion)("@firebase/firestore","3.4.4","esm2017")}()}
//# sourceMappingURL=module$node_modules$$firebase$firestore$dist$index_esm2017.js.map
