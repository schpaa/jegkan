{"version":3,"sources":["nrpk/spa.cljs"],"mappings":"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","names":["nrpk.spa/forced-scroll-lock","locked?","target","body","js/document","or__4253__auto__","js/module$node_modules$body_scroll_lock$lib$bodyScrollLock_min","nrpk.spa/dispatch-main","web-content","cljs.core/deref","s","re_frame.core.subscribe","expose-app-db","schpaa.state/listen","get-menuopen-fn","schpaa.debug/ppre-x","cljs.core.dissoc","re-frame.db/app-db","schpaa.modal/overlay-with","nrpk.fsm_helpers.send","schpaa.modal/render","schpaa.components.screen/render","re-frame.core/dispatch","nrpk.spa/app-wrapper","route-table","route-name","route-entry","user-screenmode","html","menu-open?","cljs.core._EQ_","and__4251__auto__","cljs.core/not","temp__5753__auto__","page","cljs.core.get","kee-frame.router/make-route-component"],"sourcesContent":["(ns nrpk.spa\n  (:require [re-frame.core :as rf] \n            [re-statecharts.core :as rs]\n            [\"body-scroll-lock\" :as body-scroll-lock]\n            [schpaa.modal :as modal]\n            [schpaa.components.screen :as components.screen]\n            [nrpk.fsm-helpers :as state :refer [send]]\n            [kee-frame.router :refer [make-route-component]]\n            [schpaa.debug :as l]))\n\n(defn- forced-scroll-lock\n  [locked? target]\n  (let [body (.getElementById js/document (or target \"body\"))]\n    (if locked?\n      (.disableBodyScroll body-scroll-lock body)\n      (do\n        (.enableBodyScroll body-scroll-lock body)\n        (.clearAllBodyScrollLocks body-scroll-lock)))))\n\n(defn dispatch-main [web-content]\n  (let [s (rf/subscribe [::rs/state-full :main-fsm])\n        expose-app-db @(schpaa.state/listen :app/expose-app-db)\n        get-menuopen-fn (rf/subscribe [:app/menu-open?])]\n    [:div.h-full\n     (when expose-app-db\n       [l/ppre-x (dissoc @re-frame.db/app-db :kee-frame/route :re-statecharts.core/fsm-state)])\n     [modal/overlay-with\n      {:short-timeout (:modal-short-timeout @s)             ;;todo When showing a popup with short-timeout (< 2 seconds auto-closes), just bypass the click to dismiss\n       :modal-dim     (:modal-dim @s)\n       :modal?        (or (:modal @s)\n                          (:modal-forced @s))\n       ;When forced, a click on the  background will noe dismiss the modal\n       ;the user must click on a button in the modal to dismiss it\n       :on-close      (when-not (or (:modal-dirty @s)\n                                    (:modal-forced @s))\n                        #(send :e.hide))}\n      ;;content\n      [modal/render\n       {:show?     (or (:modal @s) (:modal-forced @s))\n        :config-fn (:modal-config-fn @s)}]\n      [components.screen/render\n       {:user-auth             (fn [] @(rf/subscribe [:db.core/user-auth]))\n        :current-page          (fn [] @(rf/subscribe [:app/current-page]))\n        :toggle-menu-open      (fn [] (rf/dispatch [:toggle-menu-open]))\n        :navigate-to-home      (fn [] (rf/dispatch [:app/navigate-to @(rf/subscribe [:app/previous :active-front :r.forsiden])]))\n        :navigate-to-user      (fn [] (rf/dispatch [:app/navigate-to @(rf/subscribe [:app/previous :active-back :r.user])]))\n        :current-page-title    (fn [] @(rf/subscribe [:app/current-page-title]))\n        :current-page-subtitle (fn [] @(rf/subscribe [:app/current-page-subtitle]))\n        :get-menuopen-fn       (fn [] @(rf/subscribe [:app/menu-open?]))\n        :menu-direction        @(schpaa.state/listen :app/menu-direction) #_@(rf/subscribe [:app/menu-direction])}\n       web-content]]]))\n\n(defn app-wrapper [route-table]\n  (let [route-name (rf/subscribe [:route-name])\n        route-entry (rf/subscribe [:kee-frame/route])\n        user-screenmode (rf/subscribe [:app/user-screenmode])\n        html (aget (.getElementsByTagName js/document \"html\") 0)\n        body (aget (.getElementsByTagName js/document \"body\") 0)\n        menu-open? (rf/subscribe [:app/menu-open?])\n        s (rf/subscribe [::rs/state-full :main-fsm])]\n    (.setAttribute html \"class\" (if (= :dark @user-screenmode) \"dark\" \"\"))\n    (.setAttribute body \"class\" \"font-sans bg-gray-600 dark:bg-gray-800 \") ;fixme \"min-h-screen overflow-x-hidden\"\n    (forced-scroll-lock (or @menu-open?\n                            (and (or (:modal @s)\n                                     (:modal-forced @s))\n                                 (not (:modal-short-timeout @s)))) \"maint\")\n    [dispatch-main\n     (when-let [page (get route-table @route-name)]\n       (make-route-component page @route-entry))]))\n"]}